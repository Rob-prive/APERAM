# Aanvragen Rimses - Project Documentation

## üìã Project Overzicht

**Aanvragen Rimses** is een webapplicatie voor het beheren van vergrendelpunten en aanvragen binnen installaties. De applicatie biedt een intu√Øtieve interface met vier dynamisch aanpasbare tabellen en een centrale slider voor layout-aanpassing.

> üìñ **Voor eindgebruikers**: Bekijk de [Gebruikershandleiding (Handleiding.html)](Handleiding.html) voor stap-voor-stap instructies over hoe de applicatie te gebruiken.
>
> üîß **Voor developers en IT**: Deze Readme bevat technische documentatie, architectuur en ontwikkelingsgeschiedenis.

### Versie Informatie
- **JavaScript Versie**: 2.40.1-LOGIN-VERSION-DISPLAY
- **CSS Versie**: 1.3.1
- **Framework**: React (via Babel transpiler in browser)
- **Backend**: Google Apps Script + Firebase (4 databases)

---

## üèóÔ∏è Architectuur

### Frontend Stack
- **React 18** - UI Framework (CDN: unpkg.com)
- **Babel Standalone** - JSX transpiler (CDN: unpkg.com)
- **Custom CSS** - Vanilla CSS met moderne features

### Backend Integration
- **Google Apps Script** - Server-side logic, authentication & email verzending
- **Google Sheets** - Installaties data (DATA sheet, kolom A)
- **Firebase Realtime Database #1** - Vergrendelpunten data (`aanvragen-a3d22`)
- **Firebase Realtime Database #2** - Aanvragen data (`aanvragen-groepen`)
- **Firebase Realtime Database #3** - Gebruikers/Autorisators data (`users-6e913`)
- **Firebase Realtime Database #4** - Criticaliteit data (`criticality-32c16`)

---

## üìÅ Project Structuur

```
aanvragen-rimses/
‚îú‚îÄ‚îÄ Readme.html                  # Technische documentatie (dit bestand)
‚îú‚îÄ‚îÄ Handleiding.html             # Gebruikershandleiding (nieuw!)
‚îú‚îÄ‚îÄ Index.html                   # Main HTML bestand
‚îú‚îÄ‚îÄ JavaScript.html              # React applicatie code (v2.40.1)
‚îú‚îÄ‚îÄ Stylesheet.html              # CSS styles (v1.3.1)
‚îú‚îÄ‚îÄ debug.html                   # Debug & test panel (alleen voor Super Users)
‚îî‚îÄ‚îÄ Code.js                      # Google Apps Script backend (v2.40.1)
```

**Belangrijke Bestanden:**
- **Readme.html**: Technische documentatie voor developers en IT
- **Handleiding.html**: Gebruiksvriendelijke handleiding voor eindgebruikers
- **JavaScript.html**: Volledige React applicatie met alle functionaliteit
- **Stylesheet.html**: Alle CSS styling en animaties
- **Code.js**: Backend logica (Google Apps Script)

---

## üéØ Hoofdfunctionaliteiten

### 1. **Authenticatie**
- Login systeem met gebruikersnaam en wachtwoord
- Validatie via Google Apps Script
- Sessie beheer
- **Background Prefetch**: Data wordt geladen tijdens het login scherm voor instant load na login

### 2. **Installatie Selectie** ‚ö†Ô∏è VERWIJDERD IN v2.8.0
- ~~Dropdown menu met beschikbare installaties~~
- **NIEUW**: Direct naar hoofdpagina na login
- Alle vergrendelpunten worden direct getoond (geen installatie filter)
- Gebruik kolom filters om te filteren op specifieke installaties via Code kolom

### 3. **Vergrendelpunten Beheer (Tabel 1 - Linksboven)**
- **Locatie**: Grid positie (1,1)
- **Functionaliteit**:
  - Weergave van **ALLE** vergrendelpunten (geen installatie filter meer)
  - Live zoeken/filteren op: Code, Type, Sleutelbox, Naam, Geografische naam
  - Paginatie (15 rijen per pagina)
  - Rij selectie met ‚úì knop
  - Rij deselectie met ‚úï knop
  - **In-memory filtering**: Filters werken lokaal in browser (geen server calls)
- **Kolommen**: Code, Geografische locatie, Naam, Naam geografische locatie, Sleutelbox, Type
- **Data bron**: Firebase Realtime Database

### 4. **Geselecteerde Vergrendelpunten (Tabel 2 - Rechtsboven)**
- **Locatie**: Grid positie (2,1)
- **Functionaliteit**:
  - Toont geselecteerde rijen uit Tabel 1
  - "Aanvragen" knop om modal te openen
  - Individuele verwijder knoppen per rij
  - Real-time update bij selecties
- **State**: Blijft behouden tijdens sessie

### 5. **Aanvragen Overzicht (Tabel 3 - Linksonder)**
- **Locatie**: Grid positie (1,2)
- **Functionaliteit**:
  - Lijst van alle ingediende aanvragen
  - Kolommen: Aanvraag tekst, Installatie, Aanvrager, Datum, Status
  - Status badges: Pending (geel), Approved (groen), Rejected (rood)
  - Actieknoppen:
    - üëÅ Bekijken (opent detail modal)
    - ‚úï Verwijderen (opent bevestigings modal)
- **Data bron**: Firebase real-time database

### 6. **Placeholder Tabel (Tabel 4 - Rechtsonder)**
- **Locatie**: Grid positie (2,2)
- **Status**: Beschikbaar voor toekomstige uitbreidingen
- **Suggesties**: Analytics, Statistieken, Notificaties

---

## üé® Centrale Slider Functionaliteit

### Concept
Een **centrale paarse cirkel** op het kruispunt van alle 4 tabellen die beide dimensies tegelijk aanpast.

### Eigenschappen
- **Positie**: Dynamisch op basis van `columnSplit` en `rowSplit` percentages
- **Default waarden**: 
  - `columnSplit`: 50% (verticale verdeling)
  - `rowSplit`: 60% (horizontale verdeling)
- **Beperkingen**: 20%-80% voor beide dimensies
- **Visueel**:
  - Paarse cirkel (40x40px) met witte rand
  - 9 witte dots in 3x3 grid
  - Pulse animatie wanneer niet actief
  - Hulplijnen tijdens slepen

### Gebruik
1. Klik en houd de paarse cirkel vast
2. Sleep in alle richtingen
3. Laat los om de layout vast te zetten
4. Klik "‚ü≤ Reset Layout" om standaard positie te herstellen

### Implementatie Details
```javascript
// State management
const [columnSplit, setColumnSplit] = React.useState(50);
const [rowSplit, setRowSplit] = React.useState(60);
const [isDragging, setIsDragging] = React.useState(false);

// Grid layout
gridTemplateColumns: `${columnSplit}% ${100 - columnSplit}%`
gridTemplateRows: `${rowSplit}% ${100 - rowSplit}%`

// Slider positie
left: `${columnSplit}%`
top: `${rowSplit}%`
transform: 'translate(-50%, -50%)'
```

---

## üîÑ State Management

### Belangrijkste State Variabelen

```javascript
// Authenticatie
const [isLoggedIn, setIsLoggedIn] = React.useState(false);
const [username, setUsername] = React.useState('');
const [userName, setUserName] = React.useState(''); // Display naam

// Installatie
const [installations, setInstallations] = React.useState([]);
const [selectedInstallation, setSelectedInstallation] = React.useState('');
const [hasSelectedInstallation, setHasSelectedInstallation] = React.useState(false);

// Tabel data
const [tableData, setTableData] = React.useState({ headers: [], data: [] });
const [filteredTableData, setFilteredTableData] = React.useState([]);

// Filters
const [filters, setFilters] = React.useState({
  code: '',
  type: '',
  sleutelbox: '',
  naam: '',
  naamGeografisch: ''
});

// Selecties
const [selectedRows, setSelectedRows] = React.useState([]);

// Layout
const [columnSplit, setColumnSplit] = React.useState(50);
const [rowSplit, setRowSplit] = React.useState(60);

// Paginatie
const [currentPage, setCurrentPage] = React.useState(1);
const rowsPerPage = 15;

// Aanvragen
const [aanvragen, setAanvragen] = React.useState([]);

// Modals
const [isModalOpen, setIsModalOpen] = React.useState(false);
const [isDetailModalOpen, setIsDetailModalOpen] = React.useState(false);
const [isDeleteModalOpen, setIsDeleteModalOpen] = React.useState(false);
const [isSuccessModalOpen, setIsSuccessModalOpen] = React.useState(false);
```

---

## üîå Google Apps Script Integratie

### Beschikbare Functies

```javascript
// Authenticatie
google.script.run.validateUser(username, password)
google.script.run.getUserName()

// Data ophalen
google.script.run.getInstallations() // ‚úÖ Haalt installaties uit Google Sheets
google.script.run.getFilteredSheetBData(installation) // ‚úÖ Gebruik null voor alle data
google.script.run.getAanvragen() // ‚úÖ Haalt aanvragen uit Firebase
google.script.run.getAutorisators() // ‚úÖ Haalt autorisators uit Firebase Users database (v2.10.0+)

// Data operaties
google.script.run.submitAanvraag(formData, selectedRows, userName) // ‚úÖ Stuurt ook email naar autorisator (v2.10.0+)
google.script.run.deleteAanvraag(firebaseKey)

// Email functies (NEW in v2.10.0)
google.script.run.sendAuthorizerNotification(aanvraagData, formData, selectedRows, userName) // ‚úÖ Stuurt notificatie email
google.script.run.sendTestEmail() // üîß Debug: test email functionaliteit
google.script.run.testAanvraagEmail() // üîß Debug: test aanvraag notification email

// Performance optimalisatie - DEPRECATED
// google.script.run.prefetchInstallations() // Niet meer gebruikt
// google.script.run.prefetchAllData() // Niet meer gebruikt
// google.script.run.getAllData() // Niet meer gebruikt
```

### API Response Structuur

```javascript
// getFilteredSheetBData(installation) response
// NIEUW in v2.8.0: Gebruik null/empty voor alle data
{
  headers: ["Code", "Geografische locatie", "Naam", ...],
  data: [
    ["APL3-0001", "APL3-10-0Y", "NO kraan..."],
    ["BAL1-0001", "BAL1-20-0X", "NC kraan..."],  // Alle installaties!
    ...
  ]
}

// Voorbeelden:
getFilteredSheetBData('APL3')  // Alleen APL3 data (LEGACY gebruik)
getFilteredSheetBData(null)    // ALLE data (NIEUW in v2.8.0)
getFilteredSheetBData('')      // ALLE data (NIEUW in v2.8.0)

// getAanvragen response
[
  {
    firebaseKey: "unique-firebase-key",
    "Form Data": '{"naam":"Test","installatie":"APL3",...}',
    "Requester Email": "user@example.com",
    "Approver Email": "approver@example.com",
    "Timestamp": "2024-10-07T09:09:00.000Z",
    "Status": "Pending",
    "Verzamelmandje Data": ["row1", "row2", ...]
  },
  ...
]

// getAutorisators() response (NEW in v2.10.0 - uit Firebase Users)
[
  "jan.janssen@example.com",
  "marie.pieters@example.com",
  "rob.oversteyns@gmail.com",
  ...
]
// Haalt USER_NAME uit Firebase users database (/fire-data)
// Filtert alleen actieve gebruikers (ACTIVE === 1)
// Gesorteerd alfabetisch, duplicaten verwijderd
```

---

## üé≠ Modals Systeem

### 1. Aanvraag Modal
**Trigger**: Klik op "üìã Aanvragen" knop in Tabel 2

**Velden**:
- **Naam*** (required, max 66 karakters) - Beschrijving aanvraag
- **Installatie** (disabled, auto-filled) - Huidige installatie
- **Interne opmerking** (optioneel) - Niet zichtbaar op printout
- **Externe opmerking** (optioneel) - Wordt mee afgedrukt
- **Opmerkingen aanvrager** (optioneel) - Extra notities
- **Autorisator*** (required, dropdown) - Wie moet goedkeuren

**Validatie**:
- Naam moet ingevuld zijn
- Autorisator moet geselecteerd zijn
- Minimaal 1 vergrendelpunt geselecteerd

**Acties**:
- Submit ‚Üí `submitAanvraag()` ‚Üí Success Modal
- Annuleren ‚Üí Sluit modal en reset form

### 2. Success Modal
**Trigger**: Na succesvolle aanvraag submit

**Info getoond**:
- ‚úì Bevestiging bericht
- Aanvraag nummer (formaat: YYYY-MM-DD-HH-MM-SS)
- Firebase key (technische ID)
- Email notificatie bevestiging

**Styling**: Groen gradient header met checkmark animatie

### 3. Detail Modal
**Trigger**: Klik op üëÅ knop in Tabel 3

**Secties**:
1. **Status badge** - Kleur-gecodeerde status met datum
2. **Aanvraag Informatie** - 2x2 grid met:
   - Aanvraag tekst
   - Installatie
   - Aanvrager (naam + email)
   - Autorisator (naam + email)
3. **Opmerkingen** - Alle 3 opmerking types (indien aanwezig)
4. **Geselecteerde Vergrendelpunten** - Tabel met alle data

**Styling**: Paars gradient header

### 4. Delete Confirmation Modal
**Trigger**: Klik op ‚úï knop in Tabel 3

**Elementen**:
- ‚ö† Warning icon met shake animatie
- Rood gradient header
- Aanvraag details in geel warning box
- Prominente waarschuwing over permanent verwijderen
- Twee knoppen:
  - "Annuleren" (grijs)
  - "Ja, Verwijderen" (rood) met loading state

**Loading state**: Spinner icon + disabled buttons tijdens delete

### 5. Delete Success Modal
**Trigger**: Na succesvolle verwijdering

**Bericht**: Bevestiging dat aanvraag permanent verwijderd is

**Styling**: Groen gradient (zelfde als Success Modal)

---

## üé® Styling Systeem

### CSS Architectuur
- **Layout**: CSS Grid voor tabellen, Flexbox voor componenten
- **Responsiveness**: Viewport-based units (vh, vw)
- **Theming**: Consistent kleurenpalet
- **Animations**: Keyframe animaties voor modals en slider

### Kleurenpalet

```css
/* Primair */
--primary-blue: #1a237e;
--primary-purple: #673ab7;

/* Status kleuren */
--success-green: #4caf50;
--warning-yellow: #ffc107;
--error-red: #f44336;
--info-blue: #2196f3;

/* Pending status */
--pending-bg: #fff3cd;
--pending-text: #856404;

/* Approved status */
--approved-bg: #d4edda;
--approved-text: #155724;

/* Rejected status */
--rejected-bg: #f8d7da;
--rejected-text: #721c24;

/* Neutrals */
--gray-50: #fafafa;
--gray-100: #f5f5f5;
--gray-200: #e0e0e0;
--gray-300: #bdbdbd;
```

### Key CSS Classes

```css
.table-container        /* Container voor elke tabel */
.main-table            /* Tabel 1 (linksboven) */
.side-table            /* Tabel 2 (rechtsboven) */
.bottom-left-table     /* Tabel 3 (linksonder) */
.bottom-right-table    /* Tabel 4 (rechtsonder) */

.filter-input          /* Search inputs in table headers */
.filter-input.active   /* Actieve filter met data */

.btn-select            /* ‚úì knop in Code kolom */
.btn-delete            /* ‚úï knop in Code kolom */
.btn-delete-small      /* ‚úï knop in Tabel 2 */
.btn-aanvragen         /* üìã Aanvragen knop */

.modal-overlay         /* Modal backdrop (rgba(0,0,0,0.6)) */
.modal-container       /* Modal content box */

.pagination            /* Paginatie container */
.pagination-btn        /* Pagina nummer knoppen */
.pagination-btn.active /* Actieve pagina (blauw) */
```

---

## üîÑ Data Flow

### 0. Background Prefetch Flow (NEW in v2.8.1)
```
App Mounts (Login Screen) ‚Üí useEffect triggers ‚Üí
  getFilteredSheetBData(null) ‚Üí Firebase call ‚Üí
  setPrefetchedData() + setDataPreloaded(true) ‚Üí
  Data cached in React state (ready for instant load)
```

### 1. Login Flow
```
User Input ‚Üí validateUser() ‚Üí
  ‚úì Success:
    - setIsLoggedIn(true)
    - loadAllTableData() ‚Üí Check if prefetchedData exists:
      ‚ö° YES: Instant load from cache (no server call)
      üì° NO: Fetch from Firebase
  ‚úó Failure: Show error message
```

### 2. Installatie Selectie Flow ‚ö†Ô∏è VERWIJDERD IN v2.8.0
```
~~Select Installatie ‚Üí handleInstallationSelect() ‚Üí~~
~~getFilteredSheetBData(installation) ‚Üí~~
~~setTableData() + setFilteredTableData() ‚Üí~~
~~Render Tabel 1~~

NIEUWE FLOW: Direct naar hoofdpagina met alle data
```

### 3. Filter Flow (In-Memory, geen server calls)
```
User types in filter ‚Üí handleFilterChange() ‚Üí
  Update filters state ‚Üí applyFilters() ‚Üí
  Filter tableData.data (IN MEMORY) ‚Üí setFilteredTableData() ‚Üí
  Re-render Tabel 1 (page 1)

NOTE: Geen Firebase calls - alles gebeurt lokaal in browser
```

### 4. Selectie Flow
```
Click ‚úì in Tabel 1 ‚Üí handleSelectRow(row, index) ‚Üí
  Generate unique rowId ‚Üí Add to selectedRows[] ‚Üí
  Re-render Tabel 1 (highlight row) + Tabel 2 (show row)
```

### 5. Aanvraag Submit Flow (v2.10.0 met Email)
```
Fill form + Click Verzenden ‚Üí handleFormSubmit() ‚Üí
  Validate inputs ‚Üí submitAanvraag() ‚Üí
    Write to Firebase Aanvragen database ‚Üí
    ‚úì Success:
      - sendAuthorizerNotification() ‚Üí Email naar autorisator (NEW in v2.10.0)
        ‚Ü≥ HTML email met aanvraag details en vergrendelpunten tabel
        ‚Ü≥ Van: reliabilitycmms@gmail.com
        ‚Ü≥ Naar: geselecteerde autorisator email
      - Clear selectedRows
      - Show Success Modal (met email bevestiging)
      - Refresh aanvragen (Tabel 3)
    ‚úó Failure: Show error alert

NOTE: Aanvraag wordt opgeslagen zelfs als email faalt (email failure wordt gelogd)
```

### 6. Delete Flow
```
Click ‚úï in Tabel 3 ‚Üí handleOpenDeleteModal() ‚Üí
  Show Delete Confirmation Modal ‚Üí
  Click "Ja, Verwijderen" ‚Üí handleConfirmDelete() ‚Üí
    deleteAanvraag(firebaseKey) ‚Üí
      ‚úì Success:
        - Close Delete Modal
        - Show Delete Success Modal
        - Refresh aanvragen (Tabel 3)
      ‚úó Failure: Show error alert
```

---

## üìß Email Systeem (NEW in v2.10.0)

### Autorisator Notificatie Email

**Wanneer**: Automatisch verzonden na succesvolle aanvraag submit

**Functie**: `sendAuthorizerNotification(aanvraagData, formData, selectedRows, userName)`

**Email Details**:
- **Van**: `reliabilitycmms@gmail.com` (via GmailApp alias)
- **Naar**: Geselecteerde autorisator email uit dropdown
- **Onderwerp**: `Nieuwe Aanvraag Vergrendelgroep - [Request ID]`
- **Formaat**: HTML email met plain text fallback

**Email Inhoud**:
1. **Header**: Gradient header met titel "Nieuwe Aanvraag Vergrendelgroep"
2. **Aanvraag Details** (groen panel):
   - Aanvraag Nummer (UUID)
   - Ingediend op (datum/tijd)
   - Aanvrager naam
   - Aanvrager email
3. **Formulier Gegevens** (blauw panel):
   - Installatie
   - Naam aanvraag
   - Interne opmerking
   - Externe opmerking
   - Algemene opmerkingen
4. **Vergrendelpunten Tabel**:
   - Volledig geformatteerde HTML tabel
   - Kolommen: #, Code, Type, Sleutelbox, Naam, Locatie
   - Alle geselecteerde vergrendelpunten
5. **Call to Action** (oranje panel):
   - Melding dat actie vereist is
   - Instructie om in te loggen op applicatie
6. **Footer**: Automatische email disclaimer

**Error Handling**:
```javascript
// Email failure stopt NIET de aanvraag
if (emailResult.success) {
  console.log('‚úì Notification email sent successfully');
} else {
  console.warn('‚ö† Failed to send notification email:', emailResult.message);
  // Continue anyway - aanvraag was saved successfully
}
```

**Return Object**:
```javascript
{
  success: true,
  requestId: "5a2e681f-b775-4f99-...",
  aanvraagNr: "5a2e681f",
  firebaseKey: "firebase-generated-key",
  emailSent: true,              // NEW in v2.10.0
  emailMessage: "Notification..."  // NEW in v2.10.0
}
```

### Debug Email Functies

**1. sendTestEmail()** üîß
- Stuurt test email naar `rob.oversteyns@gmail.com`
- Controleert GmailApp alias configuratie
- Returns: `{success: boolean, message: string, timestamp: string}`

**2. testAanvraagEmail()** üîß
- Stuurt aanvraag notification email met dummy data
- Test volledige email template en formatting
- Gebruikt echte `sendAuthorizerNotification()` functie
- Returns: `{success: boolean, message: string, testData: {...}}`

**3. debugLoadUsersFirebase()** üîß
- Test Firebase Users database connectie
- Controleert verschillende paths (/, /users, /fire-data)
- Returns gedetailleerde debug info over database structuur

### GmailApp Configuratie

**Vereisten**:
- Google Apps Script moet toegang hebben tot Gmail
- `reliabilitycmms@gmail.com` moet als alias ingesteld zijn
- OAuth scopes: `https://www.googleapis.com/auth/gmail.send`

**Code**:
```javascript
GmailApp.sendEmail(
  authorizerEmail,
  subject,
  plainTextBody,
  {
    from: 'reliabilitycmms@gmail.com',
    name: 'Reliability CMMS',
    htmlBody: htmlBody
  }
);
```

---

## üöÄ Performance Optimalisaties

### 1. Background Prefetch (NEW in v2.8.1) ‚ö°
```javascript
// Zodra App mount (login scherm verschijnt)
React.useEffect(() => {
  if (!isLoggedIn && !isPrefetching && !prefetchedData) {
    // Start Firebase data laden op achtergrond
    google.script.run
      .withSuccessHandler((data) => {
        setPrefetchedData(data); // Cache in React state
      })
      .getFilteredSheetBData(null); // Alle data
  }
}, [isLoggedIn, isPrefetching, prefetchedData]);

// Bij login: instant load indien data al klaar is
if (prefetchedData && dataPreloaded) {
  setTableData(prefetchedData); // Geen server call!
}
```

**Voordelen:**
- ‚ö° Meestal instant load na login
- üìâ Minder perceived loading time
- üéØ Betere user experience

### 2. In-Memory Filtering
```javascript
// Filters werken LOKAAL (geen server calls)
const applyFilters = React.useCallback(() => {
  let filtered = [...tableData.data]; // Data al in browser
  // Filter logica in JavaScript
  if (filters.code) {
    filtered = filtered.filter(row => row[codeIndex].includes(filters.code));
  }
  // etc...
}, [tableData.data, filters]);
```

**Voordelen:**
- üöÄ Instant filter resultaten (geen netwerk latency)
- üí∞ Minder Firebase reads (goedkoper)
- üì∂ Werkt offline na eerste load

### 3. Memoization
```javascript
// Gebruik React.useCallback voor stable functions
const getColumnIndex = React.useCallback((headerName) => {...}, [tableData.headers]);
const getUniqueValues = React.useCallback((columnName) => {...}, [...dependencies]);
```

### 4. Lazy Loading
- Paginatie (15 rijen per keer in UI)
- On-demand modal content rendering
- Conditional table rendering

### 5. React Batch Updates
Filters triggeren `applyFilters()` on every keystroke, maar React batch updates automatisch voor optimale performance.

---

## üèõÔ∏è Architecture Decisions

### Data Buffering Strategy (v2.8.0+)

**Beslissing**: In-memory buffering in de browser (React state) in plaats van server-side caching.

**Waarom:**
- ‚úÖ **Snelle filters**: Geen netwerk latency bij filteren
- ‚úÖ **Goedkoper**: Minder Firebase reads (1x bij login vs. meerdere keren bij filteren)
- ‚úÖ **Offline capable**: Werkt na eerste load zonder internet
- ‚úÖ **Betere UX**: Instant feedback bij interactie

**Trade-offs:**
- ‚ùå **Memory footprint**: Grote datasets kunnen browser memory vullen
- ‚ùå **Niet real-time**: Updates in Firebase worden niet automatisch getoond
- ‚ùå **Langere eerste load**: Alle data moet geladen worden

**Mitigatie:**
- Background prefetch (v2.8.1) verkort perceived load time
- Paginatie beperkt aantal gerenderde rijen
- Logout cleared alle cached data

### No Installation Selection (v2.8.0)

**Beslissing**: Verwijderen van installatie selectie scherm en dropdown.

**Waarom:**
- ‚úÖ **Snellere workflow**: 1 scherm minder
- ‚úÖ **Betere zoekervaring**: Doorzoek alle installaties tegelijk
- ‚úÖ **Simpeler codebase**: Minder state management
- ‚úÖ **Gebruikers kunnen nog steeds filteren**: Via Code kolom filter

**Migration path:**
Gebruik de Code kolom filter om te zoeken naar specifieke installaties (bijv. typ "APL3" in Code filter).

### Firebase vs Google Sheets

**Beslissing**: Firebase Realtime Database voor alle runtime data, Sheets alleen voor installaties lijst.

**Data Bronnen (v2.10.0):**
- ‚úÖ **Firebase #1** (`aanvragen-a3d22`): Vergrendelpunten data
- ‚úÖ **Firebase #2** (`aanvragen-groepen`): Aanvragen data
- ‚úÖ **Firebase #3** (`users-6e913`): Autorisators/Gebruikers data (NEW in v2.10.0)
- ‚úÖ **Google Sheets**: Alleen installaties lijst (DATA sheet, kolom A)

**Waarom Firebase voor Autorisators? (v2.10.0 wijziging):**
- ‚úÖ **Centrale user management**: Gebruikers beheer in √©√©n systeem
- ‚úÖ **Betere integratie**: Alle runtime data uit Firebase
- ‚úÖ **Sneller**: Geen Sheets API calls nodig
- ‚úÖ **Actieve gebruikers filter**: `ACTIVE === 1` flag support
- ‚úÖ **Schaalbaarheid**: Beter voor groeiend aantal gebruikers

---

## üêõ Known Issues & Limitations

### Browser Compatibility
- **Vereist moderne browser** met ES6+ support
- **Geen IE11 support** (gebruikt arrow functions, const/let, etc.)
- **Babel Standalone 6**: Geen optional chaining (`?.`) support
- **Geteste browsers**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

### Performance
- Bij >1000 rijen kan **in-memory filtering** traag worden (JavaScript loop)
- Veel geselecteerde rijen (>50) kunnen UI vertragen
- **Prefetch kan falen** bij zeer trage connecties - fallback werkt wel
- Paginatie helpt, maar rendering van zeer grote datasets is suboptimaal

### localStorage Restriction
**KRITIEK**: Artifacts in Claude.ai ondersteunen GEEN browser storage APIs
```javascript
// ‚ùå WERKT NIET in Claude.ai artifacts
localStorage.setItem('data', value);
sessionStorage.setItem('data', value);

// ‚úÖ GEBRUIK IN PLAATS DAARVAN
const [data, setData] = React.useState(value); // In-memory state
```

### Known Bugs
1. **Rare edge case**: Bij snel wisselen van installatie kunnen oude filters blijven hangen
   - **Workaround**: Filters worden gereset bij `handleInstallationChange()`

2. **Slider**: Bij zeer kleine schermen (<768px) kan slider moeilijk te gebruiken zijn
   - **Workaround**: Reset Layout knop herstelt naar defaults

3. **Modal z-index**: Bij meerdere modals kan volgorde soms fout zijn
   - **Workaround**: Modals worden nooit tegelijk geopend (exclusief)

---

## üîê Security Considerations

### Frontend
- **Geen gevoelige data** in frontend code
- **Email validation** op autorisator veld
- **XSS preventie**: React escapet automatisch output
- **CSRF**: Niet van toepassing (geen cookies gebruikt)

### Backend (Google Apps Script)
- **Authenticatie** via server-side validatie
- **Authorization checks** voor data toegang
- **Input sanitization** op alle form inputs
- **Rate limiting** op API calls (100/hour via web_fetch_rate_limit)

### Data Privacy
- **Geen PII** in localStorage (geen localStorage gebruikt)
- **Email addresses** alleen zichtbaar voor geauthenticeerde users
- **Aanvragen** alleen zichtbaar binnen eigen organisatie

---

## üß™ Testing

### Manual Testing Checklist

#### Login
- [ ] Correcte credentials ‚Üí Success
- [ ] Foute credentials ‚Üí Error message
- [ ] Empty fields ‚Üí Validation error

#### Installatie Selectie
- [ ] Dropdown toont alle installaties
- [ ] Selecteer installatie ‚Üí Laadt data
- [ ] Wissel van installatie ‚Üí Reset filters + selecties

#### Tabel 1 - Vergrendelpunten
- [ ] Data wordt correct getoond
- [ ] Filters werken per kolom
- [ ] Meerdere filters combineren werkt
- [ ] Clear filters button reset alles
- [ ] Paginatie werkt (prev/next/numbers)
- [ ] Selecteer rij ‚Üí Verschijnt in Tabel 2
- [ ] Deselecteer rij ‚Üí Verdwijnt uit Tabel 2

#### Tabel 2 - Geselecteerde Vergrendelpunten
- [ ] Toont geselecteerde rijen correct
- [ ] Aanvragen knop enabled bij selecties
- [ ] Verwijder knop werkt per rij
- [ ] Data blijft behouden bij page change Tabel 1

#### Tabel 3 - Aanvragen
- [ ] Laadt alle aanvragen
- [ ] Status badges correct gekleurd
- [ ] Bekijk knop opent detail modal
- [ ] Verwijder knop opent bevestiging
- [ ] Data refresh na nieuwe aanvraag

#### Centrale Slider
- [ ] Slider beweegt in alle richtingen
- [ ] Min/max beperkingen werken (20%-80%)
- [ ] Hulplijnen tonen tijdens slepen
- [ ] Reset button herstelt defaults
- [ ] Layout blijft behouden na resize

#### Aanvraag Modal
- [ ] Form validatie werkt (required fields)
- [ ] Character counter Naam field (66 max)
- [ ] Autorisator dropdown laadt correct
- [ ] Submit met geldige data ‚Üí Success
- [ ] Cancel button reset form

#### Modals (Algemeen)
- [ ] ESC key sluit modal (niet ge√Ømplementeerd, feature request)
- [ ] Click outside modal sluit modal
- [ ] Multiple modals niet tegelijk mogelijk
- [ ] Animaties smooth en zonder glitches

---

## üì¶ Version History & Breaking Changes

### üéØ Sessie Overzicht: November 25, 2025 (Deel 2)

Deze ontwikkelsessie (v2.35.1 ‚Üí v2.40.1) bevatte de volledige implementatie van het **Criticaliteit Management Systeem** en **Login Logging**:

**Nieuwe Features:**
- ‚úÖ **Rol T (Technisch Beheerder)** - Toegang tot alleen Criticaliteit menu
- ‚úÖ **Criticaliteit Menu** - Warning triangle icon, zichtbaar voor rollen C, D, T
- ‚úÖ **Firebase Criticality Database** - Integratie met 4e Firebase database
- ‚úÖ **Color-coded Badges** - QS0 (light blue), QS2 (dark blue), QS3 (orange)
- ‚úÖ **Detail Modal** - Eye icon voor volledige record weergave
- ‚úÖ **Date Formatting** - Human-readable datum (DD MMM YYYY)
- ‚úÖ **Sticky Headers** - Proper positioning zonder overlap
- ‚úÖ **Pagination** - 20 items per pagina met navigation controls
- ‚úÖ **Add Button** - '+' knop voor nieuwe criticaliteit ingave (voorbereid)

**Technical Improvements:**
- üîß **Sticky Header Fix** - Per-cell positioning i.p.v. thead-level
- üîß **Date Helper Function** - `formatCriticalityDate()` voor consistente formatting
- üîß **Pagination Logic** - `.slice()` based page filtering
- üîß **Color-coding System** - Consistent badge styling voor alle categorie√´n

**Database Structure:**
- üìä Firebase Criticality path: `/SpareParts` (root level)
- üìä 10 records met ID, Naam, RemaxNummer, Categorie, Machine Crit, Risico, Status, etc.

---

### üéØ Sessie Overzicht: November 25, 2025 (Deel 1)

Deze ontwikkelsessie (v2.34.0 ‚Üí v2.34.3) bevatte belangrijke updates:

**Nieuwe Features:**
- ‚úÖ **Super User Rol (D)** toegevoegd met exclusieve toegang tot Debug & Test
- ‚úÖ **Admin Menu Gear Icon** voor betere visuele herkenning
- ‚úÖ **Gebruikershandleiding** (Handleiding.html) gemaakt voor eindgebruikers

**Bug Fixes:**
- ‚úÖ **Lege gebruikersrijen** gefilterd (verwijderde Firebase keys)
- ‚úÖ **Babel syntax error** opgelost (optional chaining vervangen)

**Security Improvements:**
- üîê **Rol D privilege escalation** voorkomen (niet meer selecteerbaar in Add/Edit User)
- üîê **Menu segregation** - Debug & Test alleen voor Super Users

**Documentatie:**
- üìñ **Handleiding.html** - Volledige gebruikershandleiding (9 hoofdstukken)
- üìñ **Readme.html** - Bijgewerkt met project structuur en referenties

---

### v2.40.1-LOGIN-VERSION-DISPLAY (Current)
**Release Date**: November 28, 2025

**Feature: Login Scherm Versie Display Verbetering üé®**
- ‚úÖ **Numeric version only** - Login scherm toont alleen versienummer (2.40.1) i.p.v. volledige string
- üì¶ **versionNumber constant** - Nieuwe const die alleen het numerieke deel extraheert via `.split('-')[0]`
- üéØ **Cleaner UI** - Versie info sectie onder "Inloggen" knop is nu overzichtelijker

**Implementatie:**
- [JavaScript.html:157](JavaScript.html#L157) - Added `versionNumber` constant
- [JavaScript.html:3391](JavaScript.html#L3391) - Changed `{version}` to `{versionNumber}` in login screen display

---

### v2.40.0-LOGIN-LOGGING
**Release Date**: November 28, 2025

**Feature: Automatische Login Logging naar Firebase üîê**
- ‚úÖ **Login tracking** - Elke succesvolle login wordt gelogd naar Firebase
- üóÑÔ∏è **Aparte database** - Dedicated Firebase database voor login logs
- ‚ö° **Non-blocking** - Login logging faalt niet de login flow
- üìä **Audit trail** - ID, LoginTime (formatted), Username

---

### v2.38.1-CRITICALITEIT-ADD-BUTTON
**Release Date**: November 25, 2025

**Feature: Add Button voor Nieuwe Criticaliteit ‚ûï**
- ‚úÖ **'+' Knop toegevoegd** naast totaal tekst in Criticaliteit tabel header
- üé® **Oranje accent** (#ff9800) consistent met Criticaliteit branding
- üñ±Ô∏è **Hover effect** - Border verandert naar oranje
- üìù **Tooltip**: "Nieuwe criticaliteit toevoegen"
- üîÆ **Voorbereid**: onClick handler met TODO comment voor modal implementatie

**Implementatie Details** ([JavaScript.html:3979-4010](JavaScript.html#L3979-L4010)):
- 28x28px knop met witte achtergrond
- SVG '+' icon in oranje
- Dezelfde styling als Users '+' knop maar met oranje i.p.v. geel
- Smooth transitions (0.2s)

---

### v2.38.0-CRITICALITEIT-PAGINATION
**Release Date**: November 25, 2025

**Feature: Pagination voor Criticaliteit Tabel üìÑ**
- ‚úÖ **20 items per pagina** - Verbeterde performance en overzicht
- ‚úÖ **Pagination controls** - Eerste, Vorige, Volgende, Laatste knoppen
- ‚úÖ **Page indicator** - "Pagina X van Y" in centrum
- ‚úÖ **Vergroot container** - Van 85% naar 92% hoogte
- ‚úÖ **Smart filtering** - `.slice()` based page data filtering

**Pagination Features**:
- Disabled state voor eerste/laatste pagina (grijs met not-allowed cursor)
- Totaal items counter met pagina info: "Totaal: 10 items (Pagina 1 van 1)"
- Navigation: ¬´ Eerste | ‚Äπ Vorige | Pagina X van Y | Volgende ‚Ä∫ | Laatste ¬ª

**Implementation** ([JavaScript.html:34-35](JavaScript.html#L34-L35), [JavaScript.html:4196-4276](JavaScript.html#L4196-L4276)):
```javascript
const [criticalityCurrentPage, setCriticalityCurrentPage] = React.useState(1);
const criticalityItemsPerPage = 20;
```

---

### v2.37.2-CRITICALITEIT-STICKY-HEADER-FIX
**Release Date**: November 25, 2025

**Bug Fix: Sticky Header Overlap Opgelost üîß**
- ‚úÖ **Per-cell sticky positioning** - Verplaatst van `<thead>` naar elke `<th>`
- ‚úÖ **Geen overlap meer** - Headers blijven correct boven tbody rijen
- ‚úÖ **Betere spacing** - Padding verhoogd van 8px naar 10px
- ‚úÖ **Consistent met Aanvragen** - Volgt zelfde pattern als Aanvragen tabel

**Het Probleem:**
- Sticky positioning op `<thead>` niveau veroorzaakte overlap met eerste data rij
- Headers leken "door" de eerste tbody rij heen te schemeren

**De Oplossing** ([JavaScript.html:3988-4099](JavaScript.html#L3988-L4099)):
- Elke `<th>` krijgt eigen sticky properties:
  - `position: 'sticky'`
  - `top: 0`
  - `zIndex: 10`
  - `backgroundColor: '#f5f5f5'`

---

### v2.37.1-CRITICALITEIT-DATE-FORMAT-TABLE-HEADERS
**Release Date**: November 25, 2025

**Feature: Verbeterde Datum Formatting & Headers üìÖ**
- ‚úÖ **Human-readable dates** - "29 okt 2025" i.p.v. ISO timestamp
- ‚úÖ **Nederlandse maanden** - jan, feb, mrt, apr, mei, jun, jul, aug, sep, okt, nov, dec
- ‚úÖ **Verkorte headers** - "Remax Nr" ‚Üí "Remax", "Categorie" ‚Üí "Cat.", "Machine Crit" ‚Üí "Mach. Crit"
- ‚úÖ **Kleinere font** - Headers van 14px naar 12px

**Nieuwe Helper Function** ([JavaScript.html:182-195](JavaScript.html#L182-L195)):
```javascript
const formatCriticalityDate = (isoString) => {
  const date = new Date(isoString);
  const months = ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'];
  const day = date.getDate();
  const month = months[date.getMonth()];
  const year = date.getFullYear();
  return `${day} ${month} ${year}`;
};
```

**Gebruikt in:**
- Tabel datum kolom ([JavaScript.html:4091](JavaScript.html#L4091))
- Detail modal datum veld ([JavaScript.html:6751](JavaScript.html#L6751))

---

### v2.37.0-CRITICALITEIT-DETAIL-MODAL
**Release Date**: November 25, 2025

**Feature: Detail Modal met Eye Icon üëÅÔ∏è**
- ‚úÖ **Blue eye icon** in ID kolom voor elke record
- ‚úÖ **Comprehensive modal** - Toont alle record velden (ook verborgen kolommen)
- ‚úÖ **Orange gradient header** - `linear-gradient(135deg, #ff9800 0%, #f57c00 100%)`
- ‚úÖ **Organized sections** - Main Info, Aanvullende Info, Status & Metadata
- ‚úÖ **Color-coded badges** - Consistent met tabel styling

**Modal Structure** ([JavaScript.html:6467-6755](JavaScript.html#L6467-L6755)):
1. **Header**: Orange gradient met titel en sluit knop (‚úï)
2. **Main Info Grid**: ID & Naam (full width), Remax Nr, Categorie (2 cols)
3. **Color-coded Badges**: Categorie, Machine Crit, Risico
4. **Aanvullende Informatie**: 6 verborgen velden in 2-column grid
   - Falen Frequentie, Falen Severity
   - Functie Criticiteit, Levertijd
   - Kosten, Aankoop Factor
5. **Status & Metadata Footer**: Status, Datum, User (3 cols)

**Eye Icon Implementation** ([JavaScript.html:3997-4026](JavaScript.html#L3997-L4026)):
- Blue button (#2196f3) met eye SVG icon
- Flexbox layout met 8px gap tussen icon en ID
- onClick handler: `handleOpenCriticalityDetail(item)`

---

### v2.36.2-CRITICALITEIT-SIMPLIFIED-COLUMNS
**Release Date**: November 25, 2025

**Feature: Simplified Table Columns üìä**
- ‚úÖ **6 kolommen verwijderd** uit tabel view:
  - Falen Freq, Falen Severity, Functie Crit
  - Levertijd, Kosten, Aankoop Factor
- ‚úÖ **Date-only formatting** - Tijd verwijderd uit Datum kolom
- ‚úÖ **9 zichtbare kolommen** - ID, Naam, Remax Nr, Categorie, Machine Crit, Risico, Status, Datum, User
- ‚úÖ **Alle data behouden** - Verborgen kolommen beschikbaar in detail modal

**Simplification Rationale:**
- Verbeterde leesbaarheid en overzicht
- Focus op meest relevante velden
- Behoud van volledige data in detail view

---

### v2.36.1-CRITICALITEIT-COLOR-CODING
**Release Date**: November 25, 2025

**Feature: Color-coded Category Badges üé®**
- ‚úÖ **Categorie badges**:
  - QS0: Light blue (#bbdefb) met dark blue text (#0d47a1)
  - QS2: Dark blue (#1976d2) met white text
  - QS3: Orange (#ff9800) met white text
- ‚úÖ **Machine Crit badges**:
  - AA: Green (#c8e6c9) met dark green text (#2e7d32)
  - A: Yellow (#fff3cd) met dark yellow text (#856404)
  - Other: Red (#f8d7da) met dark red text (#721c24)
- ‚úÖ **Risico badges**: A (green), B (yellow), C (red)
- ‚úÖ **Status badges**: Voltooid (green), In behandeling (yellow)

**Badge Styling** ([JavaScript.html:4028-4039](JavaScript.html#L4028-L4039)):
```javascript
backgroundColor: item.Categorie === 'QS0' ? '#bbdefb' :
                 item.Categorie === 'QS2' ? '#1976d2' :
                 item.Categorie === 'QS3' ? '#ff9800' : '#e0e0e0',
color: item.Categorie === 'QS0' ? '#0d47a1' :
       item.Categorie === 'QS2' ? '#ffffff' :
       item.Categorie === 'QS3' ? '#ffffff' : '#666'
```

---

### v2.36.0-CRITICALITEIT-FIREBASE-INTEGRATION
**Release Date**: November 25, 2025

**Feature: Firebase Criticality Database Integration üî•**
- ‚úÖ **4e Firebase database** toegevoegd aan applicatie
- ‚úÖ **getCriticalityData()** functie in Google Apps Script
- ‚úÖ **Data path discovery** - `/SpareParts` key op root level
- ‚úÖ **10 criticaliteit items** geladen en getoond in tabel
- ‚úÖ **Extensive debugging** - Console logging voor data structure analysis

**Firebase Configuration** ([Code.js:21-23](Code.js#L21-L23)):
```javascript
const FIREBASE_CRITICALITY_URL = 'https://criticality-32c16-default-rtdb.europe-west1.firebasedatabase.app';
const FIREBASE_CRITICALITY_SECRET = 'uU8khW9s4Zg4mAcPSjwuXhNfBNAtxLrV4tBHtftP';
```

**Data Structure Discovery**:
- Root path fetch: `/.json` i.p.v. `/criticality.json`
- Data onder `SpareParts` key op root level
- Fallback logic voor toekomstige structuur wijzigingen

**Debug Process** ([Code.js:2643-2702](Code.js#L2643-L2702)):
1. Fetch root path om structuur te ontdekken
2. Log alle root keys
3. Check voor `SpareParts` key
4. Convert Firebase object naar array met `firebaseKey`
5. Return data array voor frontend

---

### v2.35.1-CRITICALITEIT-MENU-ROLE-T
**Release Date**: November 25, 2025

**Feature: Criticaliteit Menu & Rol T üõë**
- ‚úÖ **Nieuwe Rol T** (Technisch Beheerder) - Selecteerbaar bij nieuwe gebruikers
- ‚úÖ **Criticaliteit menu item** - Warning triangle SVG icon
- ‚úÖ **Role-based visibility** - Menu zichtbaar voor rollen C, D, en T
- ‚úÖ **Restricted access** - Rol T ziet alleen Criticaliteit menu (geen Vergrendelpunten/Aanvragen)
- ‚úÖ **Single centered table** - 90% width, 80% height placeholder voor tabel

**Menu Icon** ([JavaScript.html:3756-3774](JavaScript.html#L3756-L3774)):
```javascript
<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
  <path fill="currentColor" d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Z..."/>
</svg>
```

**Login Logic for Role T** ([JavaScript.html:608-613](JavaScript.html#L608-L613)):
```javascript
if (role === 'T') {
  setActiveCriticaliteitView(true);
  setShowTable(true);
  fetchCriticalityData();
} else {
  loadAllTableData();
}
```

---

### v2.34.3-FIX-BABEL-SYNTAX
**Release Date**: November 25, 2025

**Bug Fix: Babel Standalone 6 Syntax Error üîß**
- ‚úÖ **Probleem opgelost**: App startte niet door optional chaining operator
- üîÑ **Syntax fix**: `data?.length` vervangen door `(data && data.length)`
- ‚úÖ **Compatibiliteit**: Code werkt nu met Babel Standalone 6

**Het Probleem:**
- Babel Standalone 6 ondersteunt GEEN optional chaining operator (`?.`)
- Console.log gebruikte `data?.length` syntax
- Resultaat: `SyntaxError: Unexpected token` op regel 708

**Error:**
```
Uncaught SyntaxError: Inline Babel script: Unexpected token (708:83)
> 708 | console.log('‚úì Users loaded:', validUsers.length, '(filtered from', data?.length || 0, 'total)');
                                                                                    ^
```

**De Oplossing** ([JavaScript.html:708](JavaScript.html#L708)):
```javascript
// VOOR (niet compatibel):
console.log('‚úì Users loaded:', validUsers.length, '(filtered from', data?.length || 0, 'total)');

// NA (Babel 6 compatibel):
console.log('‚úì Users loaded:', validUsers.length, '(filtered from', (data && data.length) || 0, 'total)');
```

**Babel 6 Beperkingen:**
- ‚ùå Optional chaining: `obj?.prop`
- ‚ùå Nullish coalescing: `value ?? default`
- ‚úÖ Logical AND: `obj && obj.prop`
- ‚úÖ Logical OR: `value || default`

**Bestanden Gewijzigd**:
- [JavaScript.html:2](JavaScript.html#L2) - Version naar 2.34.3
- [JavaScript.html:134](JavaScript.html#L134) - Version constant update
- [JavaScript.html:708](JavaScript.html#L708) - Optional chaining verwijderd
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.34.2-FILTER-EMPTY-USERS
**Release Date**: November 25, 2025

**Bug Fix: Lege Gebruikersrijen Gefilterd üîç**
- ‚úÖ **Probleem opgelost**: Lege rijen in gebruikerstabel door verwijderde gebruikers
- üßπ **Data filtering**: Ongeldige gebruikers worden nu uitgefilterd
- üìä **Schonere tabel**: Alleen geldige gebruikers met USER_NAME worden getoond

**Het Probleem:**
- Firebase gebruikt numerieke keys (30, 31, 32, 33, etc.)
- Wanneer gebruiker 31 wordt verwijderd, blijft er een "gat" in de nummering
- Backend retourneert lege objecten voor verwijderde keys
- Resultaat: Lege rij tussen twee geldige gebruikers

**Voorbeeld Database:**
```
30: { USER_NAME: "Test2", ROLE: "D", ... }
31: (deleted - no data)
32: { USER_NAME: "rob.oversteyns@gmail.com", ROLE: "C", ... }
```

**Oude Weergave:**
```
Test2          | Super User
-              | Gebruiker  <- Lege rij van #31
rob.oversteyns | Admin
```

**Nieuwe Weergave:**
```
Test2          | Super User
rob.oversteyns | Admin
```

**De Oplossing** ([JavaScript.html:703-708](JavaScript.html#L703-L708)):
```javascript
// Filter out empty/invalid users
const validUsers = (data || []).filter(user =>
  user && user.USER_NAME && user.USER_NAME.trim() !== ''
);
setUsers(validUsers);
```

**Filter Logica:**
- Controleert of `user` object bestaat
- Controleert of `USER_NAME` veld bestaat
- Controleert of `USER_NAME` niet leeg is (na trimmen)
- Alleen geldige gebruikers worden getoond in tabel

**Bestanden Gewijzigd**:
- [JavaScript.html:2](JavaScript.html#L2) - Version naar 2.34.2
- [JavaScript.html:134](JavaScript.html#L134) - Version constant update
- [JavaScript.html:703-708](JavaScript.html#L703-L708) - User filtering logic
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.34.1-ADMIN-GEAR-ICON
**Release Date**: November 25, 2025

**UI Enhancement: Admin Menu Gear Icon ‚öôÔ∏è**
- ‚úÖ **Visual verbetering**: Tandwiel/gear icon toegevoegd aan Admin menu
- üé® **Betere UX**: Direct herkenbaar admin menu icoon
- üìê **Consistent design**: Icoon past bij andere menu items

**Wijzigingen:**

**1. Admin Menu Button** ([JavaScript.html:3733-3738](JavaScript.html#L3733-L3738)):
- SVG gear/cog icon toegevoegd voor "Admin" menu item
- Icon gebruikt modern settings/tandwiel design
- Consistent met andere menu iconen (home icon voor Vergrendelpunten)

**2. Security Updates** ([JavaScript.html:1948-1950, 2284-2285](JavaScript.html#L1948-L1950)):
- **Add User Modal**: Rol D (Super User) verwijderd uit dropdown
  - Voorkomt dat admins zichzelf upgraden naar Super User
  - Super User rol kan alleen via database toegekend worden
- **Edit User Modal**: Rol D alleen zichtbaar als gebruiker al rol D heeft
  - Voorkomt privilege escalation
  - Toont "Super User (D) - Alleen Database" label

**Bestanden Gewijzigd**:
- [JavaScript.html:2](JavaScript.html#L2) - Version naar 2.34.1
- [JavaScript.html:134](JavaScript.html#L134) - Version constant update
- [JavaScript.html:1948-1950](JavaScript.html#L1948-L1950) - Edit User modal security
- [JavaScript.html:2284-2285](JavaScript.html#L2284-L2285) - Add User modal security
- [JavaScript.html:3733-3738](JavaScript.html#L3733-L3738) - Admin menu gear icon
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.34.0-SUPER-USER-ROLE
**Release Date**: November 25, 2025

**Feature: Nieuwe Super User Rol (D) üë§**
- ‚úÖ **Nieuwe rol toegevoegd**: Rol D = Super User
- ‚úÖ **Admin rechten**: Alle rechten van rol C (Administrator)
- ‚úÖ **Exclusieve toegang**: Alleen Super Users zien "Debug & Test" menu
- üîê **Verbeterde controle**: Betere scheiding van admin en super user rechten

**Wat is Nieuw:**

**1. Rol Definitie** ([JavaScript.html:17](JavaScript.html#L17)):
- Rol D toegevoegd aan het systeem
- Comment bijgewerkt: `A = user, B = authorizer, C = admin, D = super user`

**2. Menu Toegang** ([JavaScript.html:3707-3768](JavaScript.html#L3707-L3768)):
- **Admin Menu**: Zichtbaar voor rol C √©n D
- **Submenu "Gebruikers"**: Zichtbaar voor rol C √©n D
- **Submenu "Debug & Test"**: ALLEEN zichtbaar voor rol D (super user)

**3. Rechten & Permissies**:
- **Aanvragen bekijken** ([JavaScript.html:463](JavaScript.html#L463)): Rol C √©n D zien alle aanvragen
- **Goedkeuren/Afkeuren** ([JavaScript.html:5801](JavaScript.html#L5801)): Rol B, C √©n D kunnen beslissingen nemen
- **Gebruikersbeheer**: Rol C √©n D hebben volledige CRUD rechten

**4. UI Updates** ([JavaScript.html:4685-4694](JavaScript.html#L4685-L4694)):
- **Badge kleur**: Groen voor Super User (#c8e6c9 achtergrond, #2e7d32 tekst)
- **Badge tekst**: "Super User" label
- **Dropdowns**: Rol D optie in Edit/Add User modals

**Rol Vergelijking:**

| Functie | A (User) | B (Authorizer) | C (Admin) | D (Super User) |
|---------|----------|----------------|-----------|----------------|
| Admin Menu | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Gebruikersbeheer | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Debug & Test | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| Alle Aanvragen | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Goedkeuren | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |

**Bestanden Gewijzigd**:
- [JavaScript.html:2](JavaScript.html#L2) - Version naar 2.34.0
- [JavaScript.html:17](JavaScript.html#L17) - Role comment update
- [JavaScript.html:134](JavaScript.html#L134) - Version constant update
- [JavaScript.html:463](JavaScript.html#L463) - Aanvragen filter logic
- [JavaScript.html:1945](JavaScript.html#L1945) - Edit User modal dropdown
- [JavaScript.html:2284](JavaScript.html#L2284) - Add User modal dropdown
- [JavaScript.html:3707](JavaScript.html#L3707) - Admin menu visibility
- [JavaScript.html:3756](JavaScript.html#L3756) - Debug & Test conditional rendering
- [JavaScript.html:4685-4694](JavaScript.html#L4685-L4694) - Role badge display
- [JavaScript.html:5801](JavaScript.html#L5801) - Approve/Reject button access
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.33.2-EMAIL-LOCKED-POINTS
**Release Date**: November 23, 2025

**Bug Fix: Vergrendelpunten Tabel in Beslissing Email üìß**
- ‚úÖ **Probleem opgelost**: Vergrendelpunten tabel was leeg in goedkeurings/afkeurings emails
- ‚úÖ **Gestructureerde data**: Vergrendelpunten worden nu als JSON objecten opgeslagen
- ‚úÖ **Volledige email**: Beslissing emails bevatten nu alle informatie

**Het Probleem**:
- Vergrendelpunten werden opgeslagen als simpele comma-separated strings
- Email code zocht naar gestructureerde data in `"Locked Points"` veld
- Resultaat: Lege tabel in email

**De Oplossing**:
1. **Gestructureerde opslag** ([Code.js:410-421](Code.js#L410-L421)):
   ```javascript
   const lockedPoints = selectedRows.map(row => ({
     code: rowData[0],
     type: rowData[1],
     sleutelbox: rowData[2],
     naam: rowData[3],
     geografisch: rowData[4]
   }));
   ```

2. **Firebase veld toegevoegd** ([Code.js:438](Code.js#L438)):
   - `"Locked Points": JSON.stringify(lockedPoints)`
   - Backwards compatible: `"Verzamelmandje Data"` behouden

3. **Debug logging** ([Code.js:1613-1615](Code.js#L1613-L1615)):
   - Console logs voor troubleshooting

**Bestanden Gewijzigd**:
- [Code.js:2](Code.js#L2) - Version naar 2.33.2
- [Code.js:410-424](Code.js#L410-L424) - Gestructureerde vergrendelpunten data
- [Code.js:438](Code.js#L438) - Locked Points veld toegevoegd
- [Code.js:1613-1615](Code.js#L1613-L1615) - Debug logging
- [JavaScript.html:2+134](JavaScript.html#L2) - Version updates

---

### v2.33.1-EMAIL-FORMDATA-FIX
**Release Date**: November 23, 2025

**Bug Fix: Formulier Data in Beslissing Email üìß**
- ‚úÖ **Probleem opgelost**: Formulier gegevens waren leeg in goedkeurings/afkeurings emails
- ‚úÖ **Data parsing**: Form Data JSON string wordt nu correct geparsed
- ‚úÖ **Volledige info**: Alle formulier velden tonen nu in beslissing email

**Het Probleem**:
- Form Data wordt opgeslagen als JSON string in Firebase
- Email template probeerde niet-bestaande velden te lezen (`aanvraagData['Installation']`)
- Resultaat: Lege formulier sectie in email

**De Oplossing**:
1. **Parse Form Data** ([Code.js:1587-1601](Code.js#L1587-L1601)):
   ```javascript
   let formData = {};
   try {
     formData = JSON.parse(aanvraagData['Form Data'] || '{}');
   } catch (e) {
     // Fallback naar N/A waarden
   }
   ```

2. **Gebruik correcte velden** ([Code.js:1639-1759](Code.js#L1639-L1759)):
   - `formData.installatie`
   - `formData.naam`
   - `formData.interneOpmerking`
   - `formData.externeOpmerking`
   - `formData.opmerkingen`

**Bestanden Gewijzigd**:
- [Code.js:2](Code.js#L2) - Version naar 2.33.1
- [Code.js:1587-1601](Code.js#L1587-L1601) - Form Data parsing
- [Code.js:1639-1759](Code.js#L1639-L1759) - Formulier velden in email
- [JavaScript.html:2+134](JavaScript.html#L2) - Version updates

---

### v2.33.0-EMAIL-NOTIFICATIONS
**Release Date**: November 23, 2025

**Feature: Complete Email Notificatie Systeem üìß**
- ‚úÖ **Bevestiging voor aanvrager**: Email bij nieuwe aanvraag
- ‚úÖ **Beslissing notificatie**: Email bij goedkeuring/afkeuring
- üìß **Professioneel design**: HTML emails met gradient headers
- üé® **Kleur-gecodeerd**: Blauw voor bevestiging, groen/rood voor beslissing

**Nieuwe Email Functionaliteit**:

**1. Bevestigingsemail voor Aanvrager** ([Code.js:1296-1537](Code.js#L1296-L1537)):
- **Functie**: `sendRequesterConfirmation()`
- **Wanneer**: Direct na indienen nieuwe aanvraag
- **Inhoud**:
  - Aanvraag nummer en tijdstip
  - Autorisator naam
  - Alle formulier gegevens
  - Tabel met geselecteerde vergrendelpunten
  - Info dat aanvraag wordt beoordeeld

**2. Beslissingsemail voor Aanvrager** ([Code.js:1547-1800](Code.js#L1547-L1800)):
- **Functie**: `sendDecisionNotification()`
- **Wanneer**: Na goedkeuring of afkeuring door autorisator
- **Inhoud**:
  - Status (Goedgekeurd ‚úì of Afgekeurd ‚úó)
  - Beslissing datum
  - Autorisator naam en opmerking
  - Alle aanvraag details
  - Tabel met vergrendelpunten

**Integraties**:

**Bij nieuwe aanvraag** ([Code.js:445-465](Code.js#L445-L465)):
1. Email naar autorisator (bestaand)
2. **NIEUW**: Email naar aanvrager (bevestiging)

**Bij beslissing** ([Code.js:936-962](Code.js#L936-L962)):
1. Update status in Firebase
2. **NIEUW**: Haal complete aanvraag data op
3. **NIEUW**: Email naar aanvrager (beslissing)

**Email Design**:
- Professionele HTML emails met gradient headers
- Kleur-gecodeerd:
  - Blauw (#1976d2) voor bevestiging
  - Groen (#4caf50) voor goedkeuring
  - Rood (#f44336) voor afkeuring
- Responsive design (750px breed)
- Plain text fallback
- Verzonden via `reliabilitycmms@gmail.com`

**Bestanden Gewijzigd**:
- [Code.js:2](Code.js#L2) - Version naar 2.33.0
- [Code.js:1296-1537](Code.js#L1296-L1537) - sendRequesterConfirmation()
- [Code.js:1547-1800](Code.js#L1547-L1800) - sendDecisionNotification()
- [Code.js:456-465](Code.js#L456-L465) - Bevestiging email call
- [Code.js:936-962](Code.js#L936-L962) - Beslissing email call
- [JavaScript.html:2+134](JavaScript.html#L2) - Version updates

---

### v2.32.0-NUMERIC-USER-KEYS
**Release Date**: November 23, 2025

**Feature: Numerieke User Keys + Verbeterde Duplicate Check üî¢**
- ‚úÖ **Consistente keys**: Nieuwe users krijgen numerieke keys (31, 32, 33, ...)
- ‚úÖ **Betere duplicate check**: Controleert USER_NAME in plaats van encoded email
- ‚úÖ **Auto-increment**: Vindt automatisch hoogste nummer en verhoogt
- üîß **Backwards compatible**: Bestaande users blijven werken

**Het Probleem**:
- Nieuwe users kregen encoded email als key (`Test4_AT_t_DOT_be`)
- Bestaande users hebben numerieke keys (29, 30)
- Inconsistentie kan problemen veroorzaken

**De Oplossing**:

**1. Numerieke Key Generatie** ([Code.js:780-796](Code.js#L780-L796)):
```javascript
// Find highest numeric key
let nextKey = 0;
Object.keys(allUsersData).forEach(key => {
  const numKey = parseInt(key);
  if (!isNaN(numKey) && numKey > nextKey) {
    nextKey = numKey;
  }
});
nextKey = nextKey + 1; // Use next number
```

**2. Verbeterde Duplicate Check** ([Code.js:751-776](Code.js#L751-L776)):
- Controleert nu `USER_NAME` in alle users
- Case-insensitive vergelijking
- Eenvoudiger en betrouwbaarder

**3. Optimalisatie**:
- Hergebruikt data voor duplicate check √©n key-generatie
- Voorkomt dubbele Firebase calls

**Bestanden Gewijzigd**:
- [Code.js:2](Code.js#L2) - Version naar 2.32.0
- [Code.js:751-776](Code.js#L751-L776) - Nieuwe duplicate check
- [Code.js:780-796](Code.js#L780-L796) - Numerieke key generatie
- [JavaScript.html:2+134](JavaScript.html#L2) - Version updates

---

### v2.31.4-AUTORISATOR-OBJECT-FIX
**Release Date**: November 23, 2025

**Bug Fix: Autorisatoren Lijst Leeg üîß**
- ‚úÖ **Probleem opgelost**: Autorisatoren dropdown was leeg in aanvraag formulier
- ‚úÖ **Object ‚Üí Array**: Firebase data wordt nu correct geconverteerd
- üîç **Debug logging**: Toegevoegd voor troubleshooting

**Het Probleem**:
- `getAutorisators()` verwachtte een array van Firebase
- Firebase retourneert een **object**, geen array
- Code stopte bij `!Array.isArray(data)` check
- Resultaat: Lege autorisatoren lijst

**De Oplossing** ([Code.js:1923-1927](Code.js#L1923-L1927)):
```javascript
// Convert Firebase object to array (same as getUsers function)
const users = Object.keys(data).map(key => ({
  firebaseKey: key,
  ...data[key]
}));
```

**Gebruik zelfde aanpak als werkende `getUsers()` functie**:
- Converteer object naar array met `Object.keys().map()`
- Filter op `ROLE === 'B' || ROLE === 'C'`
- Alleen actieve users (`ACTIVE === 1`)

**Bestanden Gewijzigd**:
- [Code.js:2](Code.js#L2) - Version naar 2.31.4
- [Code.js:1923-1927](Code.js#L1923-L1927) - Object to Array conversie
- [Code.js:1929](Code.js#L1929) - Debug logging
- [JavaScript.html:2+134](JavaScript.html#L2) - Version updates

---

### v2.31.0-BLUE-LAVENDER-GRADIENTS
**Release Date**: November 2025

**Feature: Blue Lavender Gradients üíôüíú**
- ‚úÖ **Peachy ‚Üí Blue Lavender**: Alle gradients nu gebaseerd op menu balk kleuren
- ‚úÖ **Consistente styling**: Alle lege states hebben dezelfde gradient
- üé® **Nieuwe kleuren**: `#c7d2fe` ‚Üí `#ddd6fe` (licht lavendel)

**Gradient Kleuren**:
- Menu balk: `linear-gradient(135deg, #667eea 0%, #764ba2 100%)`
- Lege states: `linear-gradient(135deg, #c7d2fe 0%, #ddd6fe 100%)`
- Tekst kleur: `#5b21b6` (diep paars voor contrast)

**Toegepast op**:
- Tabel 2: Geselecteerde Vergrendelpunten (leeg)
- Tabel 3: Aanvragen "Geen aanvragen gevonden"
- Tabel 4: Gebruikers "Geen gebruikers gevonden"
- Tabel 4: Fallback state (geen admin view)

**Bestanden Gewijzigd**:
- [Code.js:2](Code.js#L2) - Version naar 2.31.0
- [JavaScript.html:2+134](JavaScript.html#L2) - Version updates
- [JavaScript.html:4084](JavaScript.html#L4084) - Tabel 2 gradient
- [JavaScript.html:4485+4493](JavaScript.html#L4485) - Tabel 3 gradient + text
- [JavaScript.html:4765+4775](JavaScript.html#L4765) - Tabel 4 gradient + text
- [JavaScript.html:4786](JavaScript.html#L4786) - Tabel 4 fallback gradient

---

### v2.30.1-GRADIENT-FIX-MENU-CLEANUP
**Release Date**: November 2025

**Bug Fixes & UI Improvements üé®**
- ‚úÖ **Gradient fix**: Tabel 2 gradient werkt nu correct
- ‚úÖ **Tandwiel weg**: Admin menu icoon verwijderd
- ‚úÖ **Betere spacing**: Inklap pijl heeft meer ruimte

**De Fixes**:

**1. Gradient Tabel 2 Fix**:
- Container: `position: relative`
- Gradient div: `position: absolute` + `width: 100%`
- Nu vult gradient de hele container

**2. Admin Menu Cleanup**:
- Verwijderd: ‚öôÔ∏è tandwiel icoon
- Toegevoegd: `marginLeft: '12px'` voor ‚Ä∫ pijl

**Bestanden Gewijzigd**:
- [Code.js:2](Code.js#L2) - Version naar 2.30.1
- [JavaScript.html:3994-4002](JavaScript.html#L3994-L4002) - Container position fix
- [JavaScript.html:4082-4090](JavaScript.html#L4082-L4090) - Gradient absolute positioning
- [JavaScript.html:3725](JavaScript.html#L3725) - Tandwiel verwijderd
- [JavaScript.html:3730](JavaScript.html#L3730) - Pijl spacing

---

### v2.30.0-ADMIN-MENU-IMPROVEMENTS
**Release Date**: November 2025

**Feature: Admin Menu Improvements üéØ**
- ‚úÖ **Icon cleanup**: Submenu iconen verwijderd
- ‚úÖ **Auto-close**: Admin views sluiten bij menu collapse
- ‚úÖ **Gradient placeholders**: Peachy gradients voor lege states

**Admin Menu**:
- Verwijderd: üë• en üîß iconen uit submenu items
- Toegevoegd: Reset `activeAdminView` bij menu collapse

**Gradients**:
- Tabel 2: Peachy gradient voor lege selecties
- Tabel 3: Peachy gradient "Geen aanvragen"
- Tabel 4: Peachy gradient voor users

**Bestanden Gewijzigd**:
- [JavaScript.html:3710-3717](JavaScript.html#L3710-L3717) - Admin collapse reset
- [JavaScript.html:3746+3757](JavaScript.html#L3746) - Iconen verwijderd
- [JavaScript.html:4072-4076](JavaScript.html#L4072-L4076) - Tabel 2 gradient

---

### v2.29.2-UNIFIED-PEACHY-GRADIENTS
**Release Date**: November 2025

**Feature: Unified Peachy Gradients üçë**
- ‚úÖ **Consistente kleuren**: Alle gradients nu peachy oranje
- ‚úÖ **Purple ‚Üí Peachy**: Tabel 4 gradients aangepast

**Gradient**: `linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)`
**Tekst**: `#8b5a3c` (warme bruine tint)

---

### v2.29.1-CLEAN-GRADIENTS
**Release Date**: November 2025

**Feature: Clean Gradients without Text üé®**
- ‚úÖ **Tabel 2**: Gradient zonder placeholder tekst
- ‚úÖ **Tabel 4**: Gradient zonder "Beschikbaar voor toekomstige data"

---

### v2.29.0-GRADIENT-EMPTY-STATES
**Release Date**: November 2025

**Feature: Gradient Backgrounds voor Lege States üé®**
- ‚úÖ **Peachy gradient**: `#ffecd2` ‚Üí `#fcb69f`
- ‚úÖ **Purple gradient**: `#d299c2` ‚Üí `#fef9d7`

---

### v2.28.2-LOGOUT-ADMINVIEW-RESET
**Release Date**: November 2025

**Security Fix: Admin View Reset bij Logout üîí**
- ‚úÖ **activeAdminView reset**: Admin views sluiten bij logout
- ‚úÖ **Users list cleared**: Gebruikers data gewist bij logout

**Het Probleem**:
Admin logt uit ‚Üí gewone user logt in ‚Üí ziet nog steeds Gebruikers header + '+' knop

**De Oplossing**:
```javascript
const handleLogout = () => {
  setActiveAdminView(null); // Close admin views
  setUsers([]); // Clear users list
  // ... rest
};
```

---

### v2.28.1-LOGOUT-ROLE-RESET
**Release Date**: November 2025

**Security Fix: User Role Reset bij Logout üîí**
- ‚úÖ **userRole reset**: Naar 'A' (meest restrictief)
- ‚úÖ **Default role**: 'A' i.p.v. 'C' voor betere security
- ‚úÖ **Users cleared**: Users lijst gewist bij logout

**Het Probleem**:
Admin logt in ‚Üí ziet Gebruikers tabel ‚Üí logt uit ‚Üí gewone user logt in ‚Üí ziet NOG STEEDS Gebruikers tabel!

**De Oplossing**:
```javascript
const handleLogout = () => {
  setUserRole('A'); // Reset to most restrictive role
  setUsers([]); // Clear users list
  // ...
};
```

**Security Improvements**:
- Initial state: `useState('A')` i.p.v. `'C'`
- Login fallback: `result.role || 'A'`
- Legacy login: `setUserRole('A')`

---

### v2.28.0-FIREBASE-SAFE-ENCODING
**Release Date**: November 2025

**Feature: Firebase-Safe Email Encoding üîß**
- ‚úÖ **Encoding fix**: `test@example.com` ‚Üí `test_AT_example_DOT_com`
- ‚úÖ **No more errors**: Geen "Invalid path: Invalid token in path"
- ‚úÖ **Backwards compatible**: 3-staps fallback voor legacy users

**Het Probleem**:
Firebase error: `"Invalid path: Invalid token in path"` omdat `%40` (encoded `@`) niet toegestaan is in Firebase paths.

**De Oplossing**:
```javascript
function encodeEmailForFirebase(email) {
  return email
    .replace(/\./g, '_DOT_')
    .replace(/@/g, '_AT_')
    .replace(/\$/g, '_DOLLAR_')
    .replace(/\[/g, '_LBRACKET_')
    .replace(/\]/g, '_RBRACKET_')
    .replace(/\//g, '_SLASH_');
}
```

**Helper Functions**:
- `encodeEmailForFirebase()` - Email naar Firebase key
- `decodeEmailFromFirebase()` - Key terug naar email

**Login Fallback**:
1. Try Firebase-safe encoded email
2. Try plain email (legacy)
3. Search by USER_NAME field

---

### v2.27.3-NULL-SAFETY-DEBUG
**Release Date**: November 2025

**Bug Fix: Null Safety + Debug Logging üêõ**
- ‚úÖ **Null safety**: Check voor valid object in Strategy 3
- ‚úÖ **Debug logging**: Uitgebreide logs voor troubleshooting
- ‚úÖ **Plain email skip**: Skip check als email Firebase-invalid chars bevat

**Fixes**:
```javascript
// Strategy 3: Null safety
const currentUser = data[key];
if (currentUser && typeof currentUser === 'object' && currentUser.USER_NAME === username) {
  // ...
}

// Skip plain email check if invalid chars
const hasInvalidChars = /@|\.|\$|#|\[|\]|\//.test(userData.email);
```

---

### v2.27.2-LOGIN-FALLBACK-FIX
**Release Date**: November 2025

**Critical Bug Fix: Login Broken for All Users üö®**
- ‚úÖ **Fixed login**: Alle gebruikers kunnen nu weer inloggen
- üîß **3-staps fallback strategie**: Ondersteunt multiple Firebase key formaten
- üõ°Ô∏è **Backwards compatible**: Werkt met zowel nieuwe als legacy users

**Het Probleem:**
Na v2.27.1 kon **niemand** meer inloggen, zelfs niet met correcte credentials:
- Error: "Gebruiker niet gevonden"
- ‚ùå v2.27.1 zocht alleen naar `encodedEmail` als Firebase key
- ‚ùå Bestaande users in database hadden verschillende key formaten (plain email, andere keys)
- ‚ùå Te restrictieve implementatie zonder fallback voor legacy data

**De Oplossing - 3-Staps Fallback Strategie:**
```javascript
// Strategy 1: Try encoded email as key (nieuwe users via createUser)
const encodedUsername = encodeURIComponent(username);
if (data[encodedUsername]) {
  user = data[encodedUsername];
  userKey = encodedUsername;
}

// Strategy 2: Try plain email as key (legacy users)
if (!user && data[username]) {
  user = data[username];
  userKey = username;
}

// Strategy 3: Search by USER_NAME field (oude users waar key != email)
if (!user) {
  for (const key in data) {
    if (data[key].USER_NAME === username) {
      user = data[key];
      userKey = key;
      break;
    }
  }
}
```

**Technische Details:**
1. **Fallback strategie** ([Code.js:1604-1638](Code.js#L1604-L1638)):
   - Eerst: Direct lookup met encoded email (snelst, voor nieuwe users)
   - Dan: Direct lookup met plain email (voor sommige legacy users)
   - Laatste: Loop door alle users op USER_NAME match (voor oude users)

2. **Correct userKey gebruik** ([Code.js:1655](Code.js#L1655)):
   - `updateUserPassword()` gebruikt nu de gevonden `userKey` i.p.v. altijd `encodedUsername`
   - Voorkomt dat password updates falen voor legacy users

3. **Debug logging** ([Code.js:1725-1726](Code.js#L1725-L1726)):
   - Bij login failure worden alle beschikbare keys gelogd
   - Helpt bij troubleshooting van toekomstige key format issues

**Impact voor Gebruikers:**
- ‚úÖ **Alle users kunnen weer inloggen**: Nieuwe √©n legacy users
- ‚úÖ **Geen data migratie nodig**: Ondersteunt multiple key formaten tegelijk
- ‚úÖ **Backwards compatible**: Oude users blijven werken
- ‚úÖ **Forward compatible**: Nieuwe users (via createUser) gebruiken encoded email

**Bestanden Gewijzigd:**
- [Code.js:2](Code.js#L2) - Version naar 2.27.2-LOGIN-FALLBACK-FIX
- [Code.js:1604-1638](Code.js#L1604-L1638) - 3-staps fallback strategie
- [Code.js:1655](Code.js#L1655) - Gebruik userKey i.p.v. encodedUsername
- [Code.js:1725-1726](Code.js#L1725-L1726) - Debug logging voor not found
- [JavaScript.html:2](JavaScript.html#L2) - Version comment naar 2.27.2
- [JavaScript.html:134](JavaScript.html#L134) - Version constant naar 2.27.2
- [Readme.html:8](Readme.html#L8) - Version info naar 2.27.2

---

### v2.27.1-LOGIN-CREATE-FIX
**Release Date**: November 2025

**Bug Fixes: Login Validation & User Creation üêõ**
- ‚úÖ **Fixed login validation**: Users kunnen nu correct inloggen ongeacht USER_NAME waarde
- ‚úÖ **Fixed duplicate check**: Nieuwe gebruikers kunnen nu correct aangemaakt worden
- üîß **Performance improvement**: Direct key lookup i.p.v. loop iteratie

**Het Probleem:**

**Bug 1 - Login Validation Failure:**
- Sommige gebruikers konden niet inloggen, bijvoorbeeld een user met `USER_NAME: "Test2"`
- Error: "Cannot read properties of null (reading 'USER_NAME')"
- ‚ùå `validateUser()` gebruikte een loop om `USER_NAME` te vergelijken met login username
- ‚ùå Firebase gebruikt het email adres als firebaseKey, niet het USER_NAME veld
- ‚ùå Ineffici√´nte loop door alle gebruikers

**Bug 2 - Create User False Positive:**
- Nieuwe gebruikers konden niet aangemaakt worden met unieke email adressen
- Error: "Gebruiker met dit email adres bestaat al"
- ‚ùå Firebase retourneert `null` (valid JSON) voor niet-bestaande paths
- ‚ùå Check `existingUser !== null` behandelde null incorrectly als bestaande gebruiker

**De Oplossing:**

**Fix 1 - Direct Key Lookup:**
```javascript
// OLD (BROKEN): Loop met USER_NAME vergelijking
for (const key in data) {
  const user = data[key];
  if (user.USER_NAME === username) { /* ... */ }
}

// NEW (FIXED): Direct lookup met email als key
const encodedUsername = encodeURIComponent(username);
const user = data[encodedUsername];
if (user) {
  // Validate password en return role
}
```

**Fix 2 - Proper Null Handling:**
```javascript
// Firebase returns null when path doesn't exist
const responseText = checkResponse.getContentText();
const existingUser = responseText ? JSON.parse(responseText) : null;

// Only block if actual user object exists
if (existingUser && typeof existingUser === 'object' && Object.keys(existingUser).length > 0) {
  return { success: false, message: 'Gebruiker met dit email adres bestaat al' };
}
```

**Technische Details:**
1. **validateUser() refactor** ([Code.js:1600-1687](Code.js#L1600-L1687)):
   - Verwijderd: `for (const key in data)` loop
   - Toegevoegd: `const user = data[encodedUsername]` direct lookup
   - Performance: O(n) ‚Üí O(1) complexity
   - Correctheid: Email is de single source of truth voor user identificatie

2. **createUser() null handling** ([Code.js:696-774](Code.js#L696-L774)):
   - Toegevoegd: Proper JSON parsing met fallback naar null
   - Toegevoegd: Object type en keys check
   - Firebase null response wordt correct ge√Ønterpreteerd als "user bestaat niet"

**Impact voor Gebruikers:**
- ‚úÖ Alle gebruikers kunnen nu correct inloggen (ongeacht USER_NAME waarde)
- ‚úÖ Nieuwe gebruikers kunnen aangemaakt worden met unieke email adressen
- ‚úÖ Snellere login validatie door direct key lookup
- ‚úÖ Correcte error messages bij ongeldige credentials

**Bestanden Gewijzigd:**
- [Code.js:2](Code.js#L2) - Version naar 2.27.1-LOGIN-CREATE-FIX
- [Code.js:696-774](Code.js#L696-L774) - createUser() null handling fix
- [Code.js:1600-1687](Code.js#L1600-L1687) - validateUser() direct lookup refactor
- [JavaScript.html:2](JavaScript.html#L2) - Version comment naar 2.27.1
- [Readme.html:8](Readme.html#L8) - Version info naar 2.27.1

---

### v2.27.0-USERS-CREATE
**Release Date**: November 2025

**Feature: CREATE Functionality voor Gebruikers - CRUD Complete! ‚úÖ**
- ‚úÖ **Add User button**: Witte knop met geel '+' SVG symbool naast "Gebruikers" header
- ‚úÖ **AddUserModal**: Volledig formulier voor nieuwe gebruikers aanmaken
- ‚úÖ **createUser()**: Backend functie met duplicate email check
- üéâ **CRUD Complete**: CREATE, READ, UPDATE, DELETE volledig ge√Ømplementeerd!

**Het Probleem:**
Users tabel had READ, UPDATE en DELETE functionaliteit, maar CREATE ontbrak nog:
- ‚ùå Geen mogelijkheid om nieuwe gebruikers toe te voegen via de UI
- ‚ùå CRUD operaties waren niet compleet
- ‚ùå Admin moest direct in Firebase database werken om users aan te maken

**De Oplossing:**

**1. Add User Button in Tabel Header:**
```javascript
<button
  onClick={() => setIsAddUserModalOpen(true)}
  title="Nieuwe gebruiker toevoegen"
  style={{
    width: '28px',
    height: '28px',
    backgroundColor: 'white',
    border: '2px solid #e0e0e0',
    borderRadius: '6px',
    cursor: 'pointer',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    transition: 'all 0.2s',
    padding: 0
  }}
>
  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
    <path d="M8 3V13M3 8H13" stroke="#FFC107" strokeWidth="2.5" strokeLinecap="round"/>
  </svg>
</button>
```

**2. AddUserModal Component:**
- **Header**: Groene gradient (consistent met andere success modals)
- **Formulier velden**:
  - Email (verplicht, text input)
  - Rol (dropdown: A/B/C, default 'A')
  - Departement (text input, optioneel)
  - Titel (text input, optioneel)
  - Actief (dropdown: Ja/Nee, default Ja)
  - Wachtwoord (verplicht, password input)
- **Knoppen**: "Annuleren" (grijs) en "Aanmaken" (groen)

**3. Backend createUser() Functie:**
```javascript
function createUser(userData) {
  // Validate required fields
  if (!userData.email || !userData.PASSWORD) {
    return { success: false, message: 'Email en wachtwoord zijn verplicht' };
  }

  // Check for duplicate email
  const encodedEmail = encodeURIComponent(userData.email);
  const checkUrl = `${FIREBASE_USERS_URL}/fire-data/${encodedEmail}.json`;
  const existingUser = /* ... Firebase GET check ... */;

  if (existingUser !== null) {
    return { success: false, message: 'Gebruiker met dit email adres bestaat al' };
  }

  // Create new user with PUT request
  const newUserData = {
    ROLE: userData.ROLE || 'A',
    DEPARTEMENT: userData.DEPARTEMENT || '',
    TITEL: userData.TITEL || '',
    ACTIVE: userData.ACTIVE !== undefined ? userData.ACTIVE : 1,
    USER_NAME: userData.USER_NAME || userData.email,
    PASSWORD: userData.PASSWORD
  };

  const createUrl = `${FIREBASE_USERS_URL}/fire-data/${encodedEmail}.json`;
  // PUT request to create user...
}
```

**Technische Details:**
1. **Frontend state** ([JavaScript.html:38](JavaScript.html#L38)):
   - Nieuw state: `const [isAddUserModalOpen, setIsAddUserModalOpen] = React.useState(false)`

2. **Add button** ([JavaScript.html:4133-4168](JavaScript.html#L4133-L4168)):
   - Witte achtergrond met gele '+' SVG icon
   - Geplaatst naast "Gebruikers" header met 10px margin-left
   - Hover effect met shadow en scale transform

3. **Handlers** ([JavaScript.html:788-818](JavaScript.html#L788-L818)):
   - `handleOpenAddUserModal()`: Opens de modal
   - `handleCloseAddUserModal()`: Sluit de modal
   - `handleCreateUser(newUserData)`: Roept backend aan, toont success/error modal, refresht users lijst

4. **AddUserModal component** ([JavaScript.html:2121-2437](JavaScript.html#L2121-L2437)):
   - Groene gradient header: `linear-gradient(135deg, #43a047 0%, #66bb6a 100%)`
   - Form validatie in component
   - Controlled inputs met lokale state
   - Success/error handling via parent callbacks

5. **Backend createUser()** ([Code.js:696-774](Code.js#L696-L774)):
   - Duplicate check met Firebase GET request
   - URL encoding voor special characters in email
   - PUT request naar `/fire-data/{encodedEmail}.json`
   - Comprehensive error handling

**Impact voor Gebruikers:**
- ‚úÖ **CRUD Complete**: Volledige gebruikersbeheer functionaliteit
- ‚úÖ **Intu√Øtieve UI**: Duidelijke '+' knop in tabel header
- ‚úÖ **Validatie**: Duplicate email check voorkomt conflicten
- ‚úÖ **Consistency**: Formulier stijl matched andere modals (EditUserModal, DeleteUserConfirmationModal)

**Bestanden Gewijzigd:**
- [Code.js:2](Code.js#L2) - Version naar 2.27.0-USERS-CREATE
- [Code.js:696-774](Code.js#L696-L774) - createUser() function toegevoegd
- [JavaScript.html:2](JavaScript.html#L2) - Version comment naar 2.27.0
- [JavaScript.html:38](JavaScript.html#L38) - isAddUserModalOpen state
- [JavaScript.html:788-818](JavaScript.html#L788-L818) - Create user handlers
- [JavaScript.html:2121-2437](JavaScript.html#L2121-L2437) - AddUserModal component
- [JavaScript.html:4133-4168](JavaScript.html#L4133-L4168) - Add button in header
- [JavaScript.html:5186](JavaScript.html#L5186) - AddUserModal rendered
- [Readme.html:8](Readme.html#L8) - Version info naar 2.27.0

**CRUD Overzicht:**
- ‚úÖ **CREATE**: AddUserModal + createUser() (v2.27.0)
- ‚úÖ **READ**: Users tabel + getUsers() (v2.23.0)
- ‚úÖ **UPDATE**: EditUserModal + updateUser() (v2.24.0)
- ‚úÖ **DELETE**: DeleteUserConfirmationModal + deleteUser() (v2.26.0)

---

### v2.14.0-ROLE-BASED-FILTERING
**Release Date**: November 2025

**Feature: Role-Based Aanvragen Filtering üîê**
- ‚úÖ **Role A (Standard User)**: Ziet alleen eigen aanvragen (Requester Email = login username)
- ‚úÖ **Role B (Authorizer)**: Ziet alleen aanvragen die hij moet goedkeuren (Approver Email = login username)
- ‚úÖ **Role C (Administrator)**: Ziet alle aanvragen (huidige standaard gedrag)
- üöÄ **Performance**: Filtering met React.useMemo voor optimale snelheid

**Het Probleem:**
Voorheen zagen alle gebruikers alle aanvragen in de "Aanvragen" tabel. Dit was niet wenselijk omdat:
- ‚ùå Standaard users (Role A) zagen aanvragen van anderen
- ‚ùå Autorisatoren (Role B) zagen aanvragen die ze niet hoefden goed te keuren
- ‚ùå Geen privacy/security filtering op basis van rol

**De Oplossing:**
Aanvragen worden nu gefilterd op basis van de gebruikersrol uit de Firebase database:

```javascript
// Backend (Code.js) - validateUser retourneert nu role:
function validateUser(username, inputPassword) {
  const userRole = user.ROLE || 'A'; // Default to 'A' if not set
  return {
    success: true,
    role: userRole,  // ‚Üê Role wordt meegegeven naar frontend
    message: 'Login succesvol'
  };
}

// Frontend (JavaScript.html) - Role wordt opgeslagen bij login:
if (result.success) {
  setIsLoggedIn(true);
  setUserName(username);
  setUserRole(result.role || 'C'); // ‚Üê Role wordt opgeslagen in state
  loadAllTableData();
}

// Frontend - Filtering logica met React.useMemo:
const filteredAanvragen = React.useMemo(() => {
  if (userRole === 'C') {
    // Admin sees all
    return aanvragen;
  } else if (userRole === 'B') {
    // Authorizer sees only requests they need to approve
    return aanvragen.filter(aanvraag =>
      aanvraag['Approver Email'] === username
    );
  } else if (userRole === 'A') {
    // Standard user sees only their own requests
    return aanvragen.filter(aanvraag =>
      aanvraag['Requester Email'] === username
    );
  }
  return []; // Default: no access
}, [aanvragen, userRole, username]);
```

**Technische Details:**
1. **Backend wijziging** ([Code.js:1321-1330](Code.js#L1321-L1330)):
   - `validateUser()` retourneert nu ook `role` in response object
   - Role wordt opgehaald uit Firebase `user.ROLE` veld

2. **Frontend state** ([JavaScript.html:17](JavaScript.html#L17)):
   - Nieuw state veld: `const [userRole, setUserRole] = React.useState('C')`
   - Default naar 'C' (admin) voor backwards compatibility

3. **Login handler** ([JavaScript.html:457-458](JavaScript.html#L457-L458)):
   - Opgeslagen role bij succesvolle login: `setUserRole(result.role || 'C')`
   - Ook voor legacy format (backwards compatible)

4. **Filtering logica** ([JavaScript.html:384-404](JavaScript.html#L384-L404)):
   - `React.useMemo` voor effici√´nte filtering
   - Dependencies: `[aanvragen, userRole, username]`
   - Herberekent alleen wanneer deze waarden wijzigen

5. **UI updates** ([JavaScript.html:2391-2492](JavaScript.html#L2391-L2492)):
   - `aanvragen` vervangen door `filteredAanvragen` in render
   - Teller toont correct aantal zichtbare aanvragen
   - Tabel gebruikt gefilterde data

**Impact voor Gebruikers:**
- ‚úÖ **Privacy**: Users zien alleen relevante aanvragen
- ‚úÖ **Security**: Role-based access control ge√Ømplementeerd
- ‚úÖ **Usability**: Minder ruis in de aanvragen tabel
- ‚úÖ **Performance**: Effici√´nte filtering met useMemo

**Bestanden Gewijzigd:**
- [Code.js:2](Code.js#L2) - Version naar 2.14.0
- [Code.js:1321-1330](Code.js#L1321-L1330) - validateUser retourneert role
- [JavaScript.html:2](JavaScript.html#L2) - Version comment naar 2.14.0
- [JavaScript.html:17](JavaScript.html#L17) - userRole state toegevoegd
- [JavaScript.html:98](JavaScript.html#L98) - const version naar 2.14.0
- [JavaScript.html:457-458](JavaScript.html#L457-L458) - setUserRole bij login
- [JavaScript.html:472](JavaScript.html#L472) - setUserRole voor legacy format
- [JavaScript.html:384-404](JavaScript.html#L384-L404) - filteredAanvragen useMemo
- [JavaScript.html:2391](JavaScript.html#L2391) - Teller gebruikt filteredAanvragen
- [JavaScript.html:2400](JavaScript.html#L2400) - Conditie gebruikt filteredAanvragen
- [JavaScript.html:2407](JavaScript.html#L2407) - Table key gebruikt filteredAanvragen.length
- [JavaScript.html:2492](JavaScript.html#L2492) - Map gebruikt filteredAanvragen
- [Readme.html:8](Readme.html#L8) - Version info naar 2.14.0

**Voor Nieuwe Ontwikkelaars:**
De `ROLE` velden in de Firebase 'users' database bepalen wat elke gebruiker ziet:
- `ROLE: 'A'` = Standaard user (ziet alleen eigen aanvragen)
- `ROLE: 'B'` = Autorisator (ziet alleen aanvragen om goed te keuren)
- `ROLE: 'C'` = Administrator (ziet alle aanvragen)

Als er geen ROLE veld is, defaultt de app naar 'A' (meest restrictieve optie).

---

### v2.13.2-REQUESTER-EMAIL-FIX
**Release Date**: November 2025

**Bug Fix: Requester Email bij "Execute as: Me" Deployment üìß**
- ‚úÖ **Correcte requester email**: Aanvragen tonen nu de email van de daadwerkelijke gebruiker
- üßπ **Opgeschoonde email**: "Email" veld verwijderd uit autorisator notification (was redundant)
- üîß **Deploy-agnostic**: Werkt correct met "Execute as: Me" deployment

**Het Probleem:**
Wanneer de app gepubliceerd wordt met **"Execute as: Me"**:
- `getUserEmail()` in `submitAanvraag()` gebruikte `Session.getActiveUser()`
- Dit gaf ALTIJD de publisher's email (rob.oversteyns@gmail.com)
- ‚ùå Alle aanvragen hadden rob.oversteyns@gmail.com als requester
- ‚ùå Autorisator zag altijd dezelfde afzender, ongeacht wie de aanvraag deed

**De Oplossing:**
Requester email wordt nu meegegeven vanuit de frontend (login username):
```javascript
// Frontend (JavaScript.html):
.submitAanvraag(formData, selectedRows, userName, username);
//                                                   ^^^^^^^^
//                                    Login username (email)

// Backend (Code.js):
function submitAanvraag(formData, selectedRows, userName, requesterEmail) {
  // requesterEmail komt nu van login, niet van Session.getActiveUser()
  const aanvraagData = {
    "Requester Email": requesterEmail,  // Correcte email!
    ...
  };
}
```

**Email Template Verbetering:**
Voorheen had de notification email twee aparte velden:
```
Aanvrager: Jan Smit
Email: jan.smit@bedrijf.com
```

Nu gecombineerd in √©√©n regel:
```
Aanvrager: Jan Smit (jan.smit@bedrijf.com)
```

**Technical Changes:**
- **Updated**: `submitAanvraag()` function signature - nieuwe parameter `requesterEmail` (Code.js:349)
- **Updated**: `submitAanvraag()` call - stuurt nu `username` mee (JavaScript.html:747)
- **Removed**: `getUserEmail()` call in `submitAanvraag()` (Code.js:361)
- **Updated**: Email template - gecombineerd aanvrager + email in √©√©n veld (Code.js:741-742)
- **Added**: Console logging van requester email voor debugging (Code.js:354)

**Impact voor Gebruikers:**
- ‚úÖ Autorisators zien nu WIE daadwerkelijk de aanvraag heeft gedaan
- ‚úÖ Audit trail is correct - requester email matched de werkelijke gebruiker
- ‚úÖ Emails zijn overzichtelijker (√©√©n regel i.p.v. twee)

**Voor Deployment:**
Deze fix is essentieel voor correcte werking met **"Execute as: Me"** deployment:
- Alle aanvragen krijgen nu de juiste requester email
- Session.getActiveUser() wordt niet meer gebruikt voor requester identificatie
- Login username is de single source of truth voor gebruikersidentificatie

**Files Modified:**
- [JavaScript.html:2](JavaScript.html#L2) - Version bump
- [JavaScript.html:747](JavaScript.html#L747) - Pass username to submitAanvraag
- [Code.js:2](Code.js#L2) - Version bump
- [Code.js:349](Code.js#L349) - Updated function signature
- [Code.js:354](Code.js#L354) - Added requester email logging
- [Code.js:361-362](Code.js#L361-L362) - Removed getUserEmail() call
- [Code.js:741-743](Code.js#L741-L743) - Combined aanvrager + email in HTML template
- [Readme.html:8](Readme.html#L8) - Version info & changelog

### v2.13.1-USERNAME-FIX
**Release Date**: November 2025

**Bug Fix: Username Display met "Execute as: Me" Deployment üë§**
- ‚úÖ **Correcte username weergave**: Gebruikers zien nu hun eigen naam i.p.v. de publisher's naam
- üîß **Deploy-agnostic**: Werkt correct ongeacht "Execute as" setting
- üöÄ **Eenvoudiger**: Geen server call meer nodig voor username ophalen

**Het Probleem:**
Wanneer de app gepubliceerd wordt met **"Execute as: Me"** (aanbevolen voor email functionaliteit):
- `Session.getActiveUser().getEmail()` geeft ALTIJD de publisher's email (rob.oversteyns@gmail.com)
- `getUserName()` functie gebruikte `Session.getActiveUser()` ‚Üí Iedereen zag "Rob Oversteyns"
- ‚ùå Gebruikers zagen niet hun eigen naam in het welkom bericht

**De Oplossing:**
Username wordt nu direct uit het login formulier gehaald i.p.v. via server call:
```javascript
// Voorheen (na login):
google.script.run.withSuccessHandler(setUserName).getUserName();
// ‚Üí Bij "Execute as: Me" geeft dit altijd publisher's naam

// Nu (bij login success):
setUserName(username);
// ‚Üí Gebruikt de username waarmee gebruiker inlogt (hun email)
```

**Technical Changes:**
- **Verwijderd**: `getUserName()` useEffect call na login (JavaScript.html ~391-398)
- **Updated**: `handleLogin()` success handler zet nu direct `setUserName(username)` (JavaScript.html ~454-455, 468)
- **Verwijderd**: `getUserName()` functie uit Code.js (regel ~619-630)
- **Toegevoegd**: Uitgebreide deployment documentatie in README

**Deployment Settings Impact:**

| Setting | Email Functionaliteit | Username Display | Aanbeveling |
|---------|----------------------|------------------|-------------|
| **Execute as: Me** | ‚úÖ Werkt voor iedereen | ‚úÖ Nu correct! | ‚úÖ **AANBEVOLEN** |
| **Execute as: User** | ‚ùå Werkt alleen met alias setup | ‚úÖ Werkt | ‚ùå Niet aanbevolen |

**Waarom "Execute as: Me" Aanbevolen Is:**
1. ‚úÖ Email quota: Publisher's quota (1500/dag Workspace, 100/dag Consumer)
2. ‚úÖ Consistente afzender: Alle emails komen van √©√©n account
3. ‚úÖ Firebase toegang: Scripts kunnen Firebase aanroepen met publisher's credentials
4. ‚úÖ Geen auth problemen: Gebruikers hoeven geen extra permissies te geven
5. ‚ö†Ô∏è **Let op**: Alle acties gebeuren in naam van publisher (daarom logging belangrijk!)

**Security & Best Practices bij "Execute as: Me":**
1. **Quota Monitoring**:
   - Consumer Gmail: Max 100 emails/dag
   - Google Workspace: Max 1500 emails/dag
   - Implementeer quota check: `MailApp.getRemainingDailyQuota()`

2. **Toegangscontrole**:
   - ‚úÖ Publish met: "Who has access: Anyone with [bedrijf.com]" (Workspace domain)
   - ‚ùå NIET: "Anyone on the internet" (publiek toegankelijk)

3. **Audit Trail**:
   - Log welke gebruiker welke actie uitvoert in Firebase
   - Scripts draaien met publisher's rechten, maar track de echte gebruiker

4. **Email Quota Voorbeeld:**
   ```
   20 gebruikers √ó 5 aanvragen/dag = 100 emails/dag
   ‚Üí Consumer Gmail quota bereikt!
   ‚Üí Gebruik Google Workspace account (1500/dag limit)
   ```

**Session.getActiveUser() Behavior:**

```javascript
// Deployment: "Execute as: Me"
Session.getActiveUser().getEmail()
// ‚Üí ALTIJD: rob.oversteyns@gmail.com (publisher)

// Deployment: "Execute as: User accessing the web app"
Session.getActiveUser().getEmail()
// ‚Üí EMAIL van ingelogde gebruiker (maar emails werken niet!)
```

**Voor Nieuwe Ontwikkelaars:**
Als je dit project voortzet en twijfelt over deployment settings:
- **Voor productie**: Gebruik "Execute as: Me" + "Anyone with [domain.com]"
- **Voor testing**: Beide settings werken nu correct voor username display
- **Let op**: Email functionaliteit vereist ALTIJD "Execute as: Me"

**Files Modified:**
- [JavaScript.html:2](JavaScript.html#L2) - Version bump
- [JavaScript.html:390](JavaScript.html#L390) - Removed getUserName() useEffect
- [JavaScript.html:454-455](JavaScript.html#L454-L455) - Set username from login (new format)
- [JavaScript.html:468](JavaScript.html#L468) - Set username from login (legacy format)
- [Code.js:2](Code.js#L2) - Version bump
- [Code.js:617-621](Code.js#L617-L621) - Removed getUserName(), added deployment warning
- [Readme.html:8](Readme.html#L8) - Version info & comprehensive deployment documentation

### v2.13.0-SLIDER-PERFORMANCE
**Release Date**: November 2025

**Performance Optimization: Slider Throttling met RequestAnimationFrame! üöÄ**
- ‚ö° **Vloeiende slider beweging**: Centrale slider verplaatsing is nu veel soepeler en responsiever
- üéØ **RequestAnimationFrame throttling**: State updates beperkt tot max 60fps i.p.v. 100+ updates per seconde
- üîÑ **Geen lag meer**: React re-renders worden nu gecontroleerd uitgevoerd tijdens drag
- üíæ **Backup gemaakt**: Originele slider code opgeslagen in `JavaScript_OLD_SLIDER` en `Stylesheet_OLD_SLIDER`

**Technical Implementation:**
- **Nieuwe ref**: `sliderAnimationFrame` - Houdt animation frame ID bij voor cancellation
- **Updated**: `handleCentralDrag()` - Gebruikt nu `requestAnimationFrame()` om updates te throttlen
- **Updated**: `handleCentralDragEnd()` - Cancelt pending animation frames bij drag end
- **Probleem opgelost**: Elke mouse move triggerde voorheen direct `setColumnSplit()` en `setRowSplit()`, wat resulteerde in 100+ re-renders per seconde van alle 4 tabellen

**How It Works:**
1. Mouse movement tijdens drag wordt gedetecteerd
2. Eventuele pending animation frame wordt gecanceld met `cancelAnimationFrame()`
3. Nieuwe animation frame wordt gescheduled met `requestAnimationFrame()`
4. Browser voert update uit op volgende frame (max 60fps)
5. React re-rendert alleen op animation frames, niet op elke mouse movement
6. Resultaat: Vloeiende slider met minimale CPU usage

**Rollback Instructions:**
Indien de nieuwe implementatie problemen veroorzaakt:
1. Open [JavaScript_OLD_SLIDER](JavaScript_OLD_SLIDER) voor originele handler code
2. Open [Stylesheet_OLD_SLIDER](Stylesheet_OLD_SLIDER) voor originele CSS (geen wijzigingen)
3. Verwijder `sliderAnimationFrame` ref (regel ~91)
4. Vervang `handleCentralDrag()` met originele code (zonder requestAnimationFrame)
5. Vervang `handleCentralDragEnd()` met originele code (zonder cancelAnimationFrame)
6. Update versie terug naar 2.12.1-CLEANUP

**Files Modified:**
- [JavaScript.html:91](JavaScript.html#L91) - Added `sliderAnimationFrame` ref
- [JavaScript.html:294-321](JavaScript.html#L294-L321) - Optimized `handleCentralDrag()` with RAF throttling
- [JavaScript.html:323-332](JavaScript.html#L323-L332) - Updated `handleCentralDragEnd()` with cleanup
- [Code.js:2](Code.js#L2) - Version bump
- [Readme.html:8](Readme.html#L8) - Version info & changelog

### v2.12.1-CLEANUP
**Release Date**: November 2025

**UI/UX Improvements:**
- üßπ **Modal opgeschoond**: Groene kader met checkmarks verwijderd uit "Eerste Login" modal
- üìß **Email zonder emoji's**: Alle emoji's verwijderd uit welcome email (was: "üîê Welkom...", nu: "Welkom...")
- ‚ú® **Cleaner look**: Eenvoudigere, professionelere weergave

**Modal Changes:**
- Verwijderd: Groen kader met "‚úì Wachtwoord aangemaakt / ‚úì Opgeslagen / ‚úì Gemaild"
- Toegevoegd: Directe tekst met username inline: "...gemaild naar **username**"
- Resultaat: Korter, duidelijker bericht

**Email Changes:**
- Header: "üîê Welkom bij..." ‚Üí "Welkom bij..."
- BELANGRIJK label: "‚ö†Ô∏è Belangrijk:" ‚Üí "BELANGRIJK:"
- Footer: "ü§ñ Generated with..." ‚Üí "Generated with..."
- Alle emoji's verwijderd voor betere email compatibiliteit

### v2.12.0-AUTO-PASSWORD
**Release Date**: November 2025

**Major Feature: Automatische Wachtwoord Generatie! üéâ**
- üîê **Auto-genereer wachtwoord bij eerste login**: Systeem maakt automatisch een random 8-karakter wachtwoord aan
- üíæ **Opslaan in Firebase**: Wachtwoord wordt direct in database opgeslagen
- üìß **Email met wachtwoord**: Gebruiker krijgt professionele HTML email met login credentials
- ‚ú® **Nieuwe modal**: "Eerste Login" modal met success bericht

**Email Template:**
- Mooie HTML email met purple gradient header
- Duidelijk wachtwoord display met monospace font
- Stap-voor-stap login instructies
- Warning box met belangrijke informatie
- Plain text fallback voor email clients zonder HTML support

**Backend Changes:**
- **Nieuwe functie**: `generateRandomPassword(length)` - Genereert random wachtwoord met letters, cijfers en speciale karakters
- **Nieuwe functie**: `updateUserPassword(firebaseKey, newPassword)` - Update wachtwoord in Firebase via PATCH
- **Nieuwe functie**: `sendWelcomePasswordEmail(userEmail, userName, password)` - Stuurt welcome email via GmailApp
- **Updated**: `validateUser()` detecteert leeg wachtwoord en triggert auto-generatie flow
- **Return object**: Nieuw `firstLogin` field om eerste login te identificeren

**Frontend Changes:**
- Modal header: Orange ‚Üí Purple gradient (success kleuren)
- Modal emoji: ‚ö†Ô∏è ‚Üí üîê (security icon)
- Modal titel: "Wachtwoord Niet Ingesteld" ‚Üí "Eerste Login"
- Modal content: Nieuwe tekst met success checklist
- Button kleur: Orange ‚Üí Purple (consistent met header)
- Modal toont gebruikersnaam waarnaar email verzonden is

**Security:**
- Wachtwoord bevat: lowercase, uppercase, cijfers, speciale karakters (!@#$%)
- 8 karakters lang (configureerbaar)
- Cryptographically random via Math.random()

**Error Handling:**
- Als Firebase update faalt ‚Üí Error modal
- Als email faalt ‚Üí Wachtwoord blijft opgeslagen, waarschuwing in logs
- Graceful degradation: Wachtwoord opslaan heeft prioriteit boven email

### v2.11.2-MODAL-FIX
**Release Date**: November 2025

**Bug Fix:**
- üêõ **Modal nu zichtbaar op login scherm**: EmptyPasswordModal wordt nu ook gerenderd in login state
- ‚úÖ Modal verschijnt direct bij gebruikers met leeg database wachtwoord (niet pas na login)

**Technical Changes:**
- Login screen return statement gebruikt nu `React.Fragment` om zowel login form als modal te renderen
- `<EmptyPasswordModal />` toegevoegd aan login screen render
- Modal component blijft ook beschikbaar in ingelogde state (beide schermen)

### v2.11.1-EMPTY-PASSWORD-LOGIC
**Release Date**: November 2025

**Improved UX:**
- üîì **Wachtwoord veld niet meer verplicht**: Gebruikers kunnen nu zonder wachtwoord proberen in te loggen
- üß† **Slimme validatie logica**: Systeem controleert eerst database wachtwoord, dan user input

**Login Flow (nieuwe logica):**
1. **Gebruiker probeert in te loggen** (wachtwoord veld kan leeg zijn)
2. **Systeem checkt database wachtwoord voor deze gebruiker**
3. **Scenario A - DB wachtwoord is leeg:**
   - ‚ö†Ô∏è Toont modal: "Uw wachtwoord is nog niet ingesteld"
   - (Ongeacht wat gebruiker heeft ingetypt)
4. **Scenario B - DB wachtwoord bestaat, maar user typte niets:**
   - ‚ùå Error in login scherm: "Voer uw wachtwoord in"
5. **Scenario C - DB wachtwoord bestaat, user typte verkeerd wachtwoord:**
   - ‚ùå Error in login scherm: "Onjuist wachtwoord"
6. **Scenario D - DB wachtwoord bestaat en matched:**
   - ‚úÖ Login succesvol

**Backend Changes:**
- `validateUser()` uitgebreide logica met 3 scenario's
- Controleert eerst `dbPasswordIsEmpty`, dan `inputPassword`
- Nieuwe error messages: "Voer uw wachtwoord in" vs "Onjuist wachtwoord"
- Uitgebreide code commentaar met flow uitleg

**Frontend Changes:**
- Password veld: `required` attribuut verwijderd
- Placeholder gewijzigd naar: "Wachtwoord (optioneel)"
- Username validatie toegevoegd in `handleLogin()`
- Alle error messages worden getoond in login scherm (behalve empty DB password ‚Üí modal)

### v2.11.0-EMPTY-PASSWORD-CHECK
**Release Date**: November 2025

**New Features:**
- üîê **Wachtwoord Validatie**: Login controleert nu of wachtwoord ingesteld is in Firebase users database
- ‚ö†Ô∏è **Empty Password Modal**: Gebruikers met leeg wachtwoord krijgen duidelijke melding
- üîÑ **Firebase Authentication**: Volledig overschakeling van Google Sheets naar Firebase voor user validatie

**Backend Changes:**
- `validateUser()` functie herschreven om Firebase users database te gebruiken
- Return waarde gewijzigd van `boolean` naar `object` met details:
  - `success`: boolean - Login geslaagd
  - `emptyPassword`: boolean - Wachtwoord niet ingesteld
  - `message`: string - Foutmelding of succesbericht
- Controleert `PASSWORD` field in Firebase `/fire-data` path
- Alleen gebruiker 'Test' heeft wachtwoord ingesteld (voor testing)

**Frontend Changes:**
- `handleLogin()` aangepast om nieuwe response structuur te verwerken
- Nieuwe modal component: `EmptyPasswordModal`
- Orange warning gradient styling consistent met andere modals
- Backward compatible met oude boolean response (legacy support)

### v2.10.2-SYNC-UPDATE
**Release Date**: November 2025

**Changes:**
- üîÑ Version bump voor GitHub synchronisatie
- Alle versienummers ge√ºpdatet voor consistentie

### v2.10.0-DEBUG-AANVRAAG-EMAIL
**Release Date**: November 2025

**New Features:**
- üìß **Email Notificaties**: Automatische email naar autorisator bij nieuwe aanvraag
- üî• **Firebase Users Database**: Autorisators worden nu uit Firebase gelezen (was Google Sheets)
- üì® **HTML Email Template**: Professionele email met volledige aanvraag details
- üîß **Debug Panel**: Nieuwe debug functies voor email testing

**Email Functionaliteit:**
- `sendAuthorizerNotification()` - Stuurt HTML email naar gekozen autorisator
- Email bevat: Aanvraag details, formulier gegevens, vergrendelpunten tabel
- Van: `reliabilitycmms@gmail.com` (GmailApp alias)
- Graceful degradation: Aanvraag wordt opgeslagen zelfs als email faalt

**Backend Changes:**
- Nieuwe Firebase database: `FIREBASE_USERS_URL` (users-6e913)
- `getAutorisators()` haalt nu data uit Firebase `/fire-data` path
- Filtert op actieve gebruikers (`ACTIVE === 1`)
- `submitAanvraag()` roept automatisch `sendAuthorizerNotification()` aan
- Return object bevat nu: `emailSent` en `emailMessage` velden

**Debug Functies:**
- `sendTestEmail()` - Test email functionaliteit
- `testAanvraagEmail()` - Test aanvraag notification email met dummy data
- `debugLoadUsersFirebase()` - Debug Firebase users database connectie

**Technical Details:**
- GmailApp OAuth scopes vereist: `gmail.send`
- Email alias moet ingesteld zijn in Google Workspace
- HTML email met plain text fallback voor compatibiliteit

### v2.8.1-BACKGROUND-PREFETCH
**Release Date**: November 2025

**New Features:**
- ‚ö° Background prefetch: Data laadt tijdens login scherm
- üìä Smart caching: Instant load bij login als prefetch klaar is
- üéØ Graceful degradation: Fallback naar normale load als prefetch niet klaar

**Performance Improvements:**
- Meestal instant load na login (geen wachttijd)
- Betere perceived performance
- Minder server load door slim gebruik van cache

**Technical Changes:**
- Nieuwe React state: `prefetchedData`
- Nieuwe useEffect hook voor background loading
- Updated `loadAllTableData()` om prefetched data te gebruiken
- Removed oude `prefetchAllDataInBackground()` functie

### v2.8.0-NO-INSTALLATION-SELECTION
**Release Date**: November 2025

**Breaking Changes:**
- ‚ùå **VERWIJDERD**: Installatie selectie scherm
- ‚ùå **VERWIJDERD**: Installatie dropdown in sidebar
- ‚ùå **VERWIJDERD**: Filter per installatie functionaliteit

**New Features:**
- ‚úÖ Direct naar hoofdpagina na login
- ‚úÖ Alle vergrendelpunten worden direct getoond
- ‚úÖ In-memory filtering (sneller, geen server calls)
- ‚úÖ Backend ondersteunt nu `null` parameter voor alle data

**Migration Guide:**
```
VOOR v2.8.0:
Login ‚Üí Selecteer Installatie ‚Üí Klik Doorgaan ‚Üí Hoofdpagina (gefilterde data)

NA v2.8.0:
Login ‚Üí Hoofdpagina (alle data) ‚Üí Filter met Code kolom indien nodig
```

**Backend Changes:**
- `getFilteredSheetBData(null)` retourneert nu ALLE data
- Nieuwe functie: `getAllFirebaseDataFormatted()`
- Updated documentatie in Code.js

### v2.7.3-CENTRAL-SLIDER (Legacy)
**Features:**
- Centrale paarse slider voor layout aanpassing
- 4 tabellen grid systeem
- Installatie selectie workflow

---

## üìù Development Notes

### Code Conventions

#### Naming
- **Components**: PascalCase (`SuccessModal`)
- **Functions**: camelCase (`handleSubmit`)
- **Constants**: camelCase (`rowsPerPage`)
- **CSS Classes**: kebab-case (`table-container`)

#### React Patterns
```javascript
// State updaters
setData(newValue)                    // Direct value
setData(prev => [...prev, newItem])  // Functional update (voor arrays/objects)

// Conditional rendering
{condition && <Component />}         // Voor single element
{condition ? <A /> : <B />}         // Voor if-else

// Event handlers
onClick={handleClick}                // Zonder parameters
onClick={() => handleClick(param)}   // Met parameters
```

#### Error Handling
```javascript
google.script.run
  .withSuccessHandler((result) => {
    // Happy path
  })
  .withFailureHandler((error) => {
    console.error('Error:', error);
    alert(`Er is een fout opgetreden: ${error.message}`);
  })
  .functionName(params);
```

---

## üîÆ Future Enhancements

### Prioriteit Hoog
1. **Tabel 4 implementeren** - Analytics dashboard met:
   - Aantal aanvragen per status
   - Meest aangevraagde vergrendelpunten
   - Autorisator response times
   - Trends over tijd

2. **Export functionaliteit**:
   - Export geselecteerde rijen naar Excel
   - Export aanvragen naar PDF
   - Email aanvraag direct vanuit app

3. **Advanced filters**:
   - Datum range picker voor Tabel 3
   - Multi-select filters
   - Saved filter presets

### Prioriteit Middel
4. **Bulk operaties**:
   - Select all checkbox in Tabel 1
   - Bulk delete in Tabel 2
   - Bulk approve/reject in Tabel 3

5. **Notification systeem**:
   - In-app notifications voor nieuwe aanvragen
   - Browser notifications (opt-in)
   - Email digest (daily summary)

6. **User preferences**:
   - Save layout preferences (columnSplit/rowSplit)
   - Remember last selected installatie
   - Dark mode toggle

### Prioriteit Laag
7. **Mobile responsiveness**:
   - Touch-friendly slider
   - Responsive grid layout
   - Mobile-optimized tables

8. **Keyboard shortcuts**:
   - ESC to close modals
   - Arrow keys for pagination
   - / to focus search

9. **Accessibility (A11y)**:
   - ARIA labels
   - Screen reader support
   - Keyboard navigation
   - Focus indicators

---

## üÜò Troubleshooting

### Probleem: "Geen installaties gevonden"
**Oorzaak**: Backend call failed of geen data in spreadsheet  
**Oplossing**:
1. Check Google Apps Script logs
2. Verify spreadsheet data
3. Check `getInstallations()` function

### Probleem: Filters werken niet
**Oorzaak**: Column headers niet gevonden  
**Oplossing**:
1. Verify `tableData.headers` bevat correcte namen
2. Check `getColumnIndex()` functie
3. Inspect console voor errors

### Probleem: Slider beweegt niet
**Oorzaak**: Event listeners niet attached  
**Oplossing**:
1. Check `isDragging` state
2. Verify `handleCentralDrag` is called
3. Check for JavaScript errors in console

### Probleem: Modal sluit niet
**Oorzaak**: onClick handlers niet correct  
**Oplossing**:
1. Verify `e.stopPropagation()` in modal content
2. Check `handleCloseModal` is called
3. Clear modal state manually in console

### Probleem: Data laadt niet na login
**Oorzaak**: Prefetch failed of authentication issue  
**Oplossing**:
1. Check network tab voor failed requests
2. Verify `isLoggedIn` state is true
3. Manually call `fetchInstallations()`

---

## üìö Additional Resources

### React Documentation
- [React Hooks](https://react.dev/reference/react)
- [useCallback](https://react.dev/reference/react/useCallback)
- [useState](https://react.dev/reference/react/useState)

### Google Apps Script
- [HTML Service](https://developers.google.com/apps-script/guides/html)
- [Spreadsheet Service](https://developers.google.com/apps-script/reference/spreadsheet)
- [Base Service](https://developers.google.com/apps-script/guides/services/authorization)

### CSS Grid
- [CSS Grid Guide](https://css-tricks.com/snippets/css/complete-guide-grid/)
- [Grid by Example](https://gridbyexample.com/)

---

## üë• Contact & Support

**Developer**: Claude (Anthropic AI Assistant)  
**Project Owner**: [Your Name]  
**Last Updated**: November 2025

Voor vragen of issues, raadpleeg de Google Apps Script logs of check de browser console voor error messages.

---

## üîÑ Laatste Updates & Context voor Volgende Sessie

### v2.26.1-USERS-DELETE-FIX (November 2025) - HUIDIGE VERSIE

**Bug Fix: Firebase Path voor Delete Operatie**
- üêõ **Probleem**: deleteUser() functie gebruikte verkeerd Firebase pad
- ‚úÖ **Oplossing**: Toegevoegd `/fire-data/` pad aan delete URL
- üîß **Fix**: URL aangepast van `/${encodedEmail}.json` naar `/fire-data/${encodedEmail}.json`

**Het probleem:**
- Gebruikers werden niet daadwerkelijk verwijderd uit Firebase
- Flow verliep correct maar database werd niet aangepast
- Firebase rules vereisen correct pad voor write/delete operaties

**De oplossing:**
- DeleteUser functie gebruikt nu `/fire-data/` pad (consistent met getUsers en updateUser)
- URL: `${FIREBASE_USERS_URL}/fire-data/${encodedEmail}.json?auth=${FIREBASE_USERS_SECRET}`

**Bestanden gewijzigd:**
- [Code.js:2](Code.js#L2) - Version bump naar 2.26.1
- [Code.js:658](Code.js#L658) - Firebase path fix in deleteUser()
- [JavaScript.html:2](JavaScript.html#L2) - Version update
- [JavaScript.html:133](JavaScript.html#L133) - const version update
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.26.0-USERS-DELETE (November 2025)

**Feature: User DELETE Functionaliteit**
- üóëÔ∏è **Verwijder knop**: Rode knop toegevoegd in EditUserModal naast opslaan knop
- ‚ö†Ô∏è **Confirmation modal**: Veiligheidscheck voordat gebruiker permanent verwijderd wordt
- üîí **Backend deleteUser()**: Firebase delete met volledige error handling
- ‚úÖ **Success/Error feedback**: Gebruikt bestaande UserSuccessModal en UserErrorModal
- üîÑ **Auto-refresh**: Gebruikerslijst wordt automatisch ververst na verwijderen

**Implementatie Details:**
- **Frontend - Verwijder Knop**: Rode gradient knop in EditUserModal footer
- **Frontend - DeleteUserConfirmationModal**:
  - Waarschuwing met gebruikersnaam
  - Geel waarschuwingsvak met "Let op" bericht
  - Disabled state tijdens verwijderen
  - Loading tekst: "Verwijderen..."
- **Backend - deleteUser(userEmail)**:
  - Firebase DELETE request naar users database
  - Email URL encoding voor veilige Firebase key
  - Returns `{success: boolean, message: string}`
  - Volledige error handling en logging

**State Management:**
- `isDeleteUserModalOpen` - Confirmation modal zichtbaarheid
- `isDeletingUser` - Loading state tijdens delete operatie

**Handler Functies:**
- `handleOpenDeleteUserModal()` - Opent confirmation modal
- `handleCloseDeleteUserModal()` - Sluit confirmation modal
- `handleDeleteUser()` - Verstuurt delete naar backend en verwerkt response

**Bestanden gewijzigd:**
- [JavaScript.html:2](JavaScript.html#L2) - Version update naar 2.26.0-USERS-DELETE
- [JavaScript.html:133](JavaScript.html#L133) - const version update
- [JavaScript.html:36-37](JavaScript.html#L36-L37) - Delete modal state
- [JavaScript.html:747-785](JavaScript.html#L747-L785) - Delete handlers
- [JavaScript.html:2047-2063](JavaScript.html#L2047-L2063) - Verwijder knop in EditUserModal
- [JavaScript.html:2287-2417](JavaScript.html#L2287-L2417) - DeleteUserConfirmationModal component
- [JavaScript.html:4803-4804](JavaScript.html#L4803-L4804) - Modal render in App
- [Code.js:2](Code.js#L2) - Version update
- [Code.js:640-689](Code.js#L640-L689) - deleteUser() functie
- [Readme.html:8](Readme.html#L8) - Version info update

**User Flow:**
1. Admin klikt op edit icoon bij gebruiker ‚Üí EditUserModal opent
2. Admin klikt op rode "Verwijderen" knop ‚Üí DeleteUserConfirmationModal opent
3. Waarschuwing toont gebruikersnaam en waarschuwing
4. Admin klikt "Ja, Verwijderen" ‚Üí Backend deleteUser() wordt aangeroepen
5. Firebase verwijdert gebruiker uit users database
6. Success modal toont bevestiging ‚Üí Gebruikerslijst wordt ververst

---

### v2.25.0-DRAGGABLE-MODAL (November 2025)

**Feature: Draggable Modal Test Component**
- ü™ü **Draggable venster**: Nieuwe modal component die vrij versleept kan worden op het scherm
- üéØ **Test knop**: Toegevoegd in Debug Panel onder "Quick Actions"
- üñ±Ô∏è **Drag & Drop**: Sleep de modal door de header vast te pakken
- üìä **Live positie**: Toont real-time X/Y co√∂rdinaten tijdens het slepen
- üí° **Prototype**: Kan toegepast worden op aanvraag detail modals voor betere gebruikservaring

**Technische Details:**
- React hooks voor positie state management (useState)
- Mouse event handlers (onMouseDown, onMouseMove, onMouseUp)
- useEffect voor global event listeners tijdens drag
- useCallback voor performance optimalisatie
- Cursor feedback (grab/grabbing)
- Box-shadow verandering tijdens slepen voor visuele feedback

**Bestanden gewijzigd:**
- [JavaScript.html:2](JavaScript.html#L2) - Version update naar 2.25.0-DRAGGABLE-MODAL
- [JavaScript.html:111](JavaScript.html#L111) - Nieuwe state: isDraggableTestOpen
- [JavaScript.html:2228-2460](JavaScript.html#L2228-L2460) - DraggableTestModal component
- [JavaScript.html:2818-2835](JavaScript.html#L2818-L2835) - Test knop in Debug Panel
- [JavaScript.html:5536](JavaScript.html#L5536) - Component render in App
- [Code.js:2](Code.js#L2) - Version update
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.24.3-AANVRAGEN-BESLISSING-DATUM (November 2025)

**Feature: Beslissing Datum in Aanvraag Detail**
- üìÖ **Goedkeur/Afkeur datum**: Toont beslissing datum wanneer aanvraag niet "In Behandeling" is
- üé® **Kleurcodering**: Groen voor goedkeur datum, rood voor afkeur datum
- üìä **Conditionele weergave**: Alleen zichtbaar bij status "Goedgekeurd" of "Afgekeurd"

**Implementatie:**
- Database veld: `Decision Timestamp` (bijv. "2025-11-20T14:30:00.000Z")
- Label: "GOEDKEUR DATUM" of "AFKEUR DATUM" (afhankelijk van status)
- Positie: Onder aanvraag datum in detail modal
- Gebruikt `formatDate()` voor consistente datum formatting

**Display logica:**
```javascript
if (beslissingDatum && status !== 'Pending') {
  // Toon beslissing datum met juiste label en kleur
}
```

**Bestanden Gewijzigd:**
- [JavaScript.html:2](JavaScript.html#L2) - Version bump naar 2.24.3
- [JavaScript.html:128](JavaScript.html#L128) - const version update
- [JavaScript.html:4834](JavaScript.html#L4834) - beslissingDatum constante toegevoegd
- [JavaScript.html:4883-4896](JavaScript.html#L4883-L4896) - Beslissing datum display logic
- [Code.js:2](Code.js#L2) - Version bump naar 2.24.3
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.24.2-AANVRAGEN-AUTORISATOR (November 2025)

**Feature: Autorisator Kolom in Aanvragen Tabel**
- üë§ **Nieuwe kolom**: Autorisator toegevoegd aan aanvragen tabel
- üîç **Filter functie**: Zoekfilter voor autorisator naam
- üìß **Naam extractie**: Gebruikt `getNameFromEmail()` voor Approver Email

**Database mapping:**
- Database veld: `Approver Email` (bijv. "kristof.vanspauwen@aperam.com")
- Weergave: Autorisator naam (bijv. "Kristof Vanspauwen")
- Positie: Tussen "Aanvrager" en "Aanvraag datum" kolommen

**Implementatie:**
- `_autorisatorNaam` computed property toegevoegd aan processedAanvragen
- Filter state: `aanvraagFilters.autorisator`
- Filter logica: Zoekt in `_autorisatorNaam.toLowerCase()`
- Gebruikt bestaande `getNameFromEmail()` helper functie

**Bestanden Gewijzigd:**
- [JavaScript.html:2](JavaScript.html#L2) - Version bump naar 2.24.2
- [JavaScript.html:128](JavaScript.html#L128) - const version update
- [JavaScript.html:47-53](JavaScript.html#L47-L53) - aanvraagFilters state (autorisator toegevoegd)
- [JavaScript.html:439](JavaScript.html#L439) - _autorisatorNaam computed property
- [JavaScript.html:497-502](JavaScript.html#L497-L502) - Autorisator filter logica
- [JavaScript.html:512](JavaScript.html#L512) - useMemo dependency array update
- [JavaScript.html:3338-3349](JavaScript.html#L3338-L3349) - Autorisator tabel header
- [JavaScript.html:3446-3468](JavaScript.html#L3446-L3468) - Autorisator filter input
- [JavaScript.html:3564-3568](JavaScript.html#L3564-L3568) - Autorisator tabel cell
- [Code.js:2](Code.js#L2) - Version bump naar 2.24.2
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.24.1-USERS-UPDATE-FIX (November 2025)

**Bug Fixes & UX Improvements:**
- üêõ **Email veld fix in Edit Modal**: Email veld toont nu USER_NAME i.p.v. firebaseKey (0-31)
- ‚ú® **Modals i.p.v. Alerts**: Alle lelijke browser alerts vervangen door professionele modals
- üé® **Success Modal**: Groene gradient met checkmark voor succesvolle updates
- üé® **Error Modal**: Rode gradient met waarschuwing voor errors

**Het probleem:**
- Edit gebruiker modal toonde firebaseKey (0-31) in email veld i.p.v. echte email
- Alle feedback (success/error) werd getoond via lelijke browser alerts
- Email vergelijking gebruikte verkeerde veld voor change detection

**De oplossing:**
- Email veld gebruikt nu `editingUser.USER_NAME` i.p.v. `editingUser.firebaseKey`
- Email change vergelijking: `formData.email !== editingUser.USER_NAME`
- Nieuwe modals: `UserSuccessModal` en `UserErrorModal`
- State toegevoegd: `isUserSuccessModalOpen`, `isUserErrorModalOpen`, `userModalMessage`
- Alle `alert()` calls vervangen door modal state updates

**Bestanden Gewijzigd:**
- [JavaScript.html:2](JavaScript.html#L2) - Version bump naar 2.24.1
- [JavaScript.html:127](JavaScript.html#L127) - const version update
- [JavaScript.html:33-35](JavaScript.html#L33-L35) - Nieuwe modal state
- [JavaScript.html:1703](JavaScript.html#L1703) - Email formData fix
- [JavaScript.html:1728](JavaScript.html#L1728) - Email vergelijking fix
- [JavaScript.html:710-731](JavaScript.html#L710-L731) - handleUpdateUser met modals
- [JavaScript.html:2017-2212](JavaScript.html#L2017-L2212) - UserSuccessModal en UserErrorModal components
- [JavaScript.html:4303-4307](JavaScript.html#L4303-L4307) - Modals gerenderd
- [Code.js:2](Code.js#L2) - Version bump naar 2.24.1
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.24.0-USERS-UPDATE (November 2025)

**Major Feature: User UPDATE Functionaliteit! ‚úèÔ∏è**
- ‚úÖ **Edit knop per gebruiker**: Paars SVG potlood icoon in Acties kolom
- ‚úÖ **Edit User Modal**: Volledig formulier met alle velden
- ‚úÖ **Backend updateUser()**: Ondersteunt email wijziging en field updates
- ‚úÖ **Wachtwoord optioneel**: Laat leeg om huidige wachtwoord te behouden

**Nieuwe Functionaliteit:**
1. **Frontend - EditUserModal Component**:
   - Formulier met: Email, Rol, Departement, Titel, Actief, Wachtwoord
   - Purple gradient header (consistent met app styling)
   - Email validatie (moet @ bevatten)
   - Wachtwoord veld optioneel (behoud huidig als leeg)
   - Vooraf ingevulde data uit geselecteerde gebruiker

2. **Frontend - Tabel Updates**:
   - Nieuwe "Acties" kolom toegevoegd aan gebruikerstabel
   - SVG edit icoon (potlood) per gebruiker
   - Paarse knop styling (consistent met theme)
   - Tooltip "Bewerken" bij hover

3. **Backend - updateUser() Functie**:
   - Ondersteunt email wijziging (verwijdert oude key, maakt nieuwe aan)
   - Behoudt wachtwoord automatisch als niet gewijzigd
   - Update velden: ROLE, DEPARTEMENT, TITEL, ACTIVE, USER_NAME, PASSWORD
   - Returns `{success: boolean, message: string}`
   - Uitgebreide error handling en logging

**State Management:**
- `isEditUserModalOpen` - Modal zichtbaarheid
- `editingUser` - Huidige gebruiker die bewerkt wordt

**Handler Functies:**
- `handleOpenEditUserModal(user)` - Opent modal met user data
- `handleCloseEditUserModal()` - Sluit modal en reset state
- `handleUpdateUser(updatedUserData)` - Verstuurt update naar backend

**Bestanden Gewijzigd:**
- [JavaScript.html:2](JavaScript.html#L2) - Version bump naar 2.24.0
- [JavaScript.html:124](JavaScript.html#L124) - const version update
- [JavaScript.html:31-32](JavaScript.html#L31-L32) - Edit modal state
- [JavaScript.html:697-726](JavaScript.html#L697-L726) - Edit handlers
- [JavaScript.html:1697-2015](JavaScript.html#L1697-L2015) - EditUserModal component
- [JavaScript.html:3528-3539](JavaScript.html#L3528-L3539) - Acties kolom header
- [JavaScript.html:3608-3638](JavaScript.html#L3608-L3638) - Edit knop per rij
- [JavaScript.html:4301](JavaScript.html#L4301) - EditUserModal render
- [Code.js:2](Code.js#L2) - Version bump naar 2.24.0
- [Code.js:530-638](Code.js#L530-L638) - updateUser() functie
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.23.2-USERS-TABLE-COLUMNS (November 2025)

**UI Improvement:**
- ‚úÖ Uitgebreide Gebruikers tabel met alle Firebase velden
- üîß Nieuwe kolommen toegevoegd: Departement, Titel, Actief, Wachtwoord

**Het probleem:**
- Tabel toonde alleen Email, Naam en Rol
- Database bevat meer velden: DEPARTEMENT, TITEL, ACTIVE, PASSWORD
- Gebruiker wilde alle beschikbare data kunnen zien

**De oplossing:**
Tabel uitgebreid met alle Firebase database velden:
- **Email**: `user.firebaseKey` (email is de key in Firebase)
- **Naam**: `user.USER_NAME`
- **Rol**: `user.ROLE` (A/B/C met kleur-gecodeerde badges)
- **Departement**: `user.DEPARTEMENT` (bijv. "REL")
- **Titel**: `user.TITEL` (bijv. "CMMS")
- **Actief**: `user.ACTIVE` (1 = Ja/groen, 0 = Nee/rood badge)
- **Wachtwoord**: `user.PASSWORD` (gemaskeerd als ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢)

**Visuele verbeteringen:**
- Actief kolom: Groen badge voor actieve gebruikers, rood voor inactieve
- Wachtwoord kolom: Gemaskeerd met bullets voor security, monospace font
- Centered alignment voor Actief en Wachtwoord kolommen
- Consistente styling met andere tabellen

**Database structuur (Firebase users):**
```javascript
{
  "firebaseKey": "user@example.com",  // Email is de key
  "ACTIVE": 1,                         // 1 = actief, 0 = inactief
  "DEPARTEMENT": "REL",                // Afdeling
  "PASSWORD": "encrypted_password",    // Wachtwoord
  "ROLE": "A",                         // A/B/C (Gebruiker/Autorisator/Admin)
  "TITEL": "CMMS",                     // Functie titel
  "USER_NAME": "user@example.com"      // Volledige naam/email
}
```

**Bestanden Gewijzigd:**
- [JavaScript.html:2](JavaScript.html#L2) - Version bump naar 2.23.2
- [JavaScript.html:122](JavaScript.html#L122) - const version update
- [JavaScript.html:3107-3192](JavaScript.html#L3107-L3192) - Uitgebreide table headers
- [JavaScript.html:3194-3267](JavaScript.html#L3194-L3267) - Uitgebreide table body met alle velden
- [Code.js:2](Code.js#L2) - Version bump naar 2.23.2
- [Readme.html:8](Readme.html#L8) - Version info update

---

### v2.23.1-USERS-READ-FIX (November 2025)

**Bug Fix:**
- ‚úÖ Email en Naam kolommen tonen nu correcte data (was: koppeltekens)
- üîß Veldnamen aangepast om te matchen met Firebase database structuur

**Het probleem:**
- Email kolom: Gebruikte `user.EMAIL` maar dit veld bestaat niet in Firebase
- Naam kolom: Gebruikte `user.NAME` maar database gebruikt `USER_NAME`

**De fix:**
- Email kolom: `user.EMAIL` ‚Üí `user.firebaseKey` (email is de key in Firebase)
- Naam kolom: `user.NAME` ‚Üí `user.USER_NAME` (correcte veldnaam)

**Werkelijke Firebase users velden:**
- `ACTIVE` - Status van gebruiker
- `DEPARTEMENT` - Afdeling
- `PASSWORD` - Wachtwoord (encrypted)
- `ROLE` - A/B/C (Gebruiker/Autorisator/Administrator)
- `TITEL` - Functie titel
- `USER_NAME` - Volledige naam

**Git info:**
- Commit: `ced5068`
- Previous: `3dbd78e` (v2.23.0-USERS-READ)

---

### v2.23.0-USERS-READ (November 2025)

**Wat is er toegevoegd:**
- **Users READ functionaliteit**: Gebruikers kunnen nu bekeken worden in Tabel 4 (Admin only)
- **Nieuwe backend functie**: `getUsers()` in Code.js haalt gebruikers op van Firebase users database
- **Nieuwe frontend handler**: `fetchUsers()` laadt gebruikers data
- **Users tabel UI**: Tabel 4 toont gebruikers met kolommen: Email, Naam, Rol
- **Gebruikers menu**: Klikken op "Gebruikers" in Admin menu laadt users in Tabel 4

**Implementatie details:**
- Backend (`Code.js` lines 487-528): `getUsers()` functie volgt zelfde patroon als `getAanvragen()`
- Frontend handler (`JavaScript.html` lines 677-692): `fetchUsers()` met loading state
- Users state (`JavaScript.html` lines 28-30): `users`, `isLoadingUsers`, `activeAdminView`
- Users tabel UI (`JavaScript.html` lines 3063-3192): Volledige tabel met styling identiek aan Aanvragen
- Menu handler (`JavaScript.html` lines 2372-2375): Click handler roept `fetchUsers()` aan en zet `activeAdminView`

**Rol badges kleuren:**
- Role C (Administrator): Blauw (`#e3f2fd` background, `#1565c0` text)
- Role B (Autorisator): Geel (`#fff3cd` background, `#856404` text)
- Role A (Gebruiker): Paars (`#f3e5f5` background, `#6a1b9a` text)

**Database structuur (Firebase users):**
```javascript
{
  "firebaseKey": "auto-generated-key",
  "EMAIL": "user@example.com",
  "NAME": "Gebruiker Naam",
  "ROLE": "A|B|C",
  "PASSWORD": "encrypted"
}
```

**Wat nog NIET is ge√Ømplementeerd:**
- ‚úó CREATE: Nieuwe gebruiker toevoegen
- ‚úó UPDATE: Bestaande gebruiker bewerken
- ‚úó DELETE: Gebruiker verwijderen
- ‚úó Password reset functionaliteit
- ‚úó Role assignment UI

**Volgende stappen (voor volgende chat sessie):**
1. **Users CREATE**: Modal om nieuwe gebruiker toe te voegen (email, naam, rol, wachtwoord)
2. **Users UPDATE**: Bewerk knop per user row, modal om gegevens te wijzigen
3. **Users DELETE**: Verwijder knop per user row met confirmation modal
4. **Password management**: Reset wachtwoord functionaliteit
5. **Role assignment**: Dropdown voor role selectie bij create/update

**Git repository informatie:**
- Repository: `Rob-prive/APERAM` (GitHub)
- Current branch: `main`
- Remote: `https://github.com/Rob-prive/APERAM.git`
- Laatste commit v√≥√≥r v2.23.0: `9662750` (v2.22.0-ADMIN-MENU)

**Technische patronen gebruikt:**
- State management met React.useState hooks
- Google Apps Script backend calls met .withSuccessHandler/.withFailureHandler
- Firebase REST API calls voor data fetching
- Conditional rendering gebaseerd op `activeAdminView` state
- Role-based visibility (Admin menu alleen voor Role C)
- Consistente tabel styling met sticky headers en alternating row colors

**Belangrijke bestanden deze sessie:**
- `JavaScript.html`: Main React applicatie (4421 lines)
- `Code.js`: Google Apps Script backend (700+ lines)
- `Readme.html`: Deze documentatie (1543 lines)

**Browser compatibility:**
- Chrome: ‚úì Volledig ondersteund
- Firefox: ‚úì Volledig ondersteund
- Safari: ‚úì Volledig ondersteund
- Edge: ‚úì Volledig ondersteund

---

## üìÑ License

This project is proprietary and confidential. Unauthorized copying, distribution, or use is strictly prohibited.

---

## ‚úÖ Quick Start Checklist

Voor nieuwe developers:

1. [ ] Clone repository
2. [ ] Open `index.html` in browser
3. [ ] Verify Google Apps Script connection
4. [ ] Test login met test credentials
5. [ ] Explore all 4 tabellen
6. [ ] Test centrale slider
7. [ ] Submit test aanvraag
8. [ ] Read ARCHITECTURE.md voor deep dive
9. [ ] Check CHANGELOG.md voor version history

**Klaar om te beginnen? Happy coding! üöÄ**

---

### v2.40.0-LOGIN-LOGGING (November 2025)

**Wat is er toegevoegd:**
- **Login logging naar Firebase**: Elke succesvolle login wordt automatisch gelogd naar aparte Firebase database
- **Backend functie**: `logUserLogin(username)` in Code.js schrijft login events weg
- **Database structuur**: Logins worden opgeslagen met ID (timestamp), LoginTime (formatted), en Username
- **Non-blocking implementatie**: Login logging faalt niet de login flow - errors worden gelogd maar blokkeren login niet

**Implementatie details:**
- **Backend** ([Code.js:2807-2882](Code.js#L2807-L2882)): `logUserLogin()` functie met timestamp-based ID generatie
- **Firebase credentials** ([Code.js:26-28](Code.js#L26-L28)): `FIREBASE_LOGIN_LOG_URL` en `FIREBASE_LOGIN_LOG_SECRET`
- **Frontend integration** ([JavaScript.html:743-751](JavaScript.html#L743-L751)): Call naar `logUserLogin()` na succesvolle login (new format)
- **Legacy format support** ([JavaScript.html:775-783](JavaScript.html#L775-L783)): Ook logging voor legacy boolean login response
- **Error handling**: `withFailureHandler` logt warning maar blokkeert login flow niet

**Database structuur (Firebase Login Log):**
```javascript
{
  "ID": 1732804053000,  // timestamp
  "LoginTime": "2025-11-28 15:05:53",  // formatted string
  "Username": "user@aperam.com"
}
```

**Firebase URL:**
- Database: `https://userlogin-f7339-default-rtdb.europe-west1.firebasedatabase.app/`
- Path: `/logins`
- Auth: Secret key voor write access

**Console logging:**
- ‚úÖ Success: "Login logged: {logResult}"
- ‚ö†Ô∏è Failure: "Login logging failed (non-critical): {error}" (warning, niet error)

**Waarom non-blocking?**
De login logging feature is bedoeld voor audit/analytics doeleinden. Als de Firebase login database tijdelijk niet bereikbaar is, mag dat de gebruiker niet blokkeren om in te loggen. Daarom:
- Geen `throw` in catch block
- `withFailureHandler` gebruikt `console.warn` i.p.v. `alert`
- Return object met `success: false` i.p.v. error throw

**Versie updates:**
- [Code.js:2](Code.js#L2) - Version naar 2.40.0-LOGIN-LOGGING
- [JavaScript.html:2](JavaScript.html#L2) - Version comment naar 2.40.0-LOGIN-LOGGING
- [JavaScript.html:155](JavaScript.html#L155) - Version constant naar 2.40.0-LOGIN-LOGGING
- [Readme.html:12](Readme.html#L12) - JavaScript Versie naar 2.40.0-LOGIN-LOGGING
- [Readme.html:43](Readme.html#L43) - File version reference naar v2.40.0
- [Readme.html:46](Readme.html#L46) - File version reference naar v2.40.0

**Git info:**
- Commit: `972db85` (initial), update pending
- Previous: `352c534` (v2.38.1-CRITICALITEIT-README-UPDATE)

---