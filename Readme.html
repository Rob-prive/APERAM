# Aanvragen Rimses - Project Documentation

## üìã Project Overzicht

**Aanvragen Rimses** is een webapplicatie voor het beheren van vergrendelpunten en aanvragen binnen installaties. De applicatie biedt een intu√Øtieve interface met vier dynamisch aanpasbare tabellen en een centrale slider voor layout-aanpassing.

### Versie Informatie
- **JavaScript Versie**: 2.13.2-REQUESTER-EMAIL-FIX
- **CSS Versie**: 1.2.0
- **Framework**: React (via Babel transpiler in browser)
- **Backend**: Google Apps Script + Firebase (3 databases)

---

## üèóÔ∏è Architectuur

### Frontend Stack
- **React 18** - UI Framework (CDN: unpkg.com)
- **Babel Standalone** - JSX transpiler (CDN: unpkg.com)
- **Custom CSS** - Vanilla CSS met moderne features

### Backend Integration
- **Google Apps Script** - Server-side logic, authentication & email verzending
- **Google Sheets** - Installaties data (DATA sheet, kolom A)
- **Firebase Realtime Database #1** - Vergrendelpunten data (`aanvragen-a3d22`)
- **Firebase Realtime Database #2** - Aanvragen data (`aanvragen-groepen`)
- **Firebase Realtime Database #3** - Gebruikers/Autorisators data (`users-6e913`)

---

## üìÅ Project Structuur

```
aanvragen-rimses/
‚îú‚îÄ‚îÄ README.md                    # Dit bestand
‚îú‚îÄ‚îÄ index.html                   # Main HTML bestand
‚îú‚îÄ‚îÄ javascript/
‚îÇ   ‚îú‚îÄ‚îÄ JavaScript.html          # Werkende versie (v2.6.0)
‚îÇ   ‚îî‚îÄ‚îÄ Javascript_TEST.html     # Test versie met centrale slider (v2.7.3)
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ styles.css              # Stylesheet
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ CHANGELOG.md            # Versie geschiedenis
    ‚îî‚îÄ‚îÄ ARCHITECTURE.md         # Gedetailleerde architectuur
```

---

## üéØ Hoofdfunctionaliteiten

### 1. **Authenticatie**
- Login systeem met gebruikersnaam en wachtwoord
- Validatie via Google Apps Script
- Sessie beheer
- **Background Prefetch**: Data wordt geladen tijdens het login scherm voor instant load na login

### 2. **Installatie Selectie** ‚ö†Ô∏è VERWIJDERD IN v2.8.0
- ~~Dropdown menu met beschikbare installaties~~
- **NIEUW**: Direct naar hoofdpagina na login
- Alle vergrendelpunten worden direct getoond (geen installatie filter)
- Gebruik kolom filters om te filteren op specifieke installaties via Code kolom

### 3. **Vergrendelpunten Beheer (Tabel 1 - Linksboven)**
- **Locatie**: Grid positie (1,1)
- **Functionaliteit**:
  - Weergave van **ALLE** vergrendelpunten (geen installatie filter meer)
  - Live zoeken/filteren op: Code, Type, Sleutelbox, Naam, Geografische naam
  - Paginatie (15 rijen per pagina)
  - Rij selectie met ‚úì knop
  - Rij deselectie met ‚úï knop
  - **In-memory filtering**: Filters werken lokaal in browser (geen server calls)
- **Kolommen**: Code, Geografische locatie, Naam, Naam geografische locatie, Sleutelbox, Type
- **Data bron**: Firebase Realtime Database

### 4. **Geselecteerde Vergrendelpunten (Tabel 2 - Rechtsboven)**
- **Locatie**: Grid positie (2,1)
- **Functionaliteit**:
  - Toont geselecteerde rijen uit Tabel 1
  - "Aanvragen" knop om modal te openen
  - Individuele verwijder knoppen per rij
  - Real-time update bij selecties
- **State**: Blijft behouden tijdens sessie

### 5. **Aanvragen Overzicht (Tabel 3 - Linksonder)**
- **Locatie**: Grid positie (1,2)
- **Functionaliteit**:
  - Lijst van alle ingediende aanvragen
  - Kolommen: Aanvraag tekst, Installatie, Aanvrager, Datum, Status
  - Status badges: Pending (geel), Approved (groen), Rejected (rood)
  - Actieknoppen:
    - üëÅ Bekijken (opent detail modal)
    - ‚úï Verwijderen (opent bevestigings modal)
- **Data bron**: Firebase real-time database

### 6. **Placeholder Tabel (Tabel 4 - Rechtsonder)**
- **Locatie**: Grid positie (2,2)
- **Status**: Beschikbaar voor toekomstige uitbreidingen
- **Suggesties**: Analytics, Statistieken, Notificaties

---

## üé® Centrale Slider Functionaliteit

### Concept
Een **centrale paarse cirkel** op het kruispunt van alle 4 tabellen die beide dimensies tegelijk aanpast.

### Eigenschappen
- **Positie**: Dynamisch op basis van `columnSplit` en `rowSplit` percentages
- **Default waarden**: 
  - `columnSplit`: 50% (verticale verdeling)
  - `rowSplit`: 60% (horizontale verdeling)
- **Beperkingen**: 20%-80% voor beide dimensies
- **Visueel**:
  - Paarse cirkel (40x40px) met witte rand
  - 9 witte dots in 3x3 grid
  - Pulse animatie wanneer niet actief
  - Hulplijnen tijdens slepen

### Gebruik
1. Klik en houd de paarse cirkel vast
2. Sleep in alle richtingen
3. Laat los om de layout vast te zetten
4. Klik "‚ü≤ Reset Layout" om standaard positie te herstellen

### Implementatie Details
```javascript
// State management
const [columnSplit, setColumnSplit] = React.useState(50);
const [rowSplit, setRowSplit] = React.useState(60);
const [isDragging, setIsDragging] = React.useState(false);

// Grid layout
gridTemplateColumns: `${columnSplit}% ${100 - columnSplit}%`
gridTemplateRows: `${rowSplit}% ${100 - rowSplit}%`

// Slider positie
left: `${columnSplit}%`
top: `${rowSplit}%`
transform: 'translate(-50%, -50%)'
```

---

## üîÑ State Management

### Belangrijkste State Variabelen

```javascript
// Authenticatie
const [isLoggedIn, setIsLoggedIn] = React.useState(false);
const [username, setUsername] = React.useState('');
const [userName, setUserName] = React.useState(''); // Display naam

// Installatie
const [installations, setInstallations] = React.useState([]);
const [selectedInstallation, setSelectedInstallation] = React.useState('');
const [hasSelectedInstallation, setHasSelectedInstallation] = React.useState(false);

// Tabel data
const [tableData, setTableData] = React.useState({ headers: [], data: [] });
const [filteredTableData, setFilteredTableData] = React.useState([]);

// Filters
const [filters, setFilters] = React.useState({
  code: '',
  type: '',
  sleutelbox: '',
  naam: '',
  naamGeografisch: ''
});

// Selecties
const [selectedRows, setSelectedRows] = React.useState([]);

// Layout
const [columnSplit, setColumnSplit] = React.useState(50);
const [rowSplit, setRowSplit] = React.useState(60);

// Paginatie
const [currentPage, setCurrentPage] = React.useState(1);
const rowsPerPage = 15;

// Aanvragen
const [aanvragen, setAanvragen] = React.useState([]);

// Modals
const [isModalOpen, setIsModalOpen] = React.useState(false);
const [isDetailModalOpen, setIsDetailModalOpen] = React.useState(false);
const [isDeleteModalOpen, setIsDeleteModalOpen] = React.useState(false);
const [isSuccessModalOpen, setIsSuccessModalOpen] = React.useState(false);
```

---

## üîå Google Apps Script Integratie

### Beschikbare Functies

```javascript
// Authenticatie
google.script.run.validateUser(username, password)
google.script.run.getUserName()

// Data ophalen
google.script.run.getInstallations() // ‚úÖ Haalt installaties uit Google Sheets
google.script.run.getFilteredSheetBData(installation) // ‚úÖ Gebruik null voor alle data
google.script.run.getAanvragen() // ‚úÖ Haalt aanvragen uit Firebase
google.script.run.getAutorisators() // ‚úÖ Haalt autorisators uit Firebase Users database (v2.10.0+)

// Data operaties
google.script.run.submitAanvraag(formData, selectedRows, userName) // ‚úÖ Stuurt ook email naar autorisator (v2.10.0+)
google.script.run.deleteAanvraag(firebaseKey)

// Email functies (NEW in v2.10.0)
google.script.run.sendAuthorizerNotification(aanvraagData, formData, selectedRows, userName) // ‚úÖ Stuurt notificatie email
google.script.run.sendTestEmail() // üîß Debug: test email functionaliteit
google.script.run.testAanvraagEmail() // üîß Debug: test aanvraag notification email

// Performance optimalisatie - DEPRECATED
// google.script.run.prefetchInstallations() // Niet meer gebruikt
// google.script.run.prefetchAllData() // Niet meer gebruikt
// google.script.run.getAllData() // Niet meer gebruikt
```

### API Response Structuur

```javascript
// getFilteredSheetBData(installation) response
// NIEUW in v2.8.0: Gebruik null/empty voor alle data
{
  headers: ["Code", "Geografische locatie", "Naam", ...],
  data: [
    ["APL3-0001", "APL3-10-0Y", "NO kraan..."],
    ["BAL1-0001", "BAL1-20-0X", "NC kraan..."],  // Alle installaties!
    ...
  ]
}

// Voorbeelden:
getFilteredSheetBData('APL3')  // Alleen APL3 data (LEGACY gebruik)
getFilteredSheetBData(null)    // ALLE data (NIEUW in v2.8.0)
getFilteredSheetBData('')      // ALLE data (NIEUW in v2.8.0)

// getAanvragen response
[
  {
    firebaseKey: "unique-firebase-key",
    "Form Data": '{"naam":"Test","installatie":"APL3",...}',
    "Requester Email": "user@example.com",
    "Approver Email": "approver@example.com",
    "Timestamp": "2024-10-07T09:09:00.000Z",
    "Status": "Pending",
    "Verzamelmandje Data": ["row1", "row2", ...]
  },
  ...
]

// getAutorisators() response (NEW in v2.10.0 - uit Firebase Users)
[
  "jan.janssen@example.com",
  "marie.pieters@example.com",
  "rob.oversteyns@gmail.com",
  ...
]
// Haalt USER_NAME uit Firebase users database (/fire-data)
// Filtert alleen actieve gebruikers (ACTIVE === 1)
// Gesorteerd alfabetisch, duplicaten verwijderd
```

---

## üé≠ Modals Systeem

### 1. Aanvraag Modal
**Trigger**: Klik op "üìã Aanvragen" knop in Tabel 2

**Velden**:
- **Naam*** (required, max 66 karakters) - Beschrijving aanvraag
- **Installatie** (disabled, auto-filled) - Huidige installatie
- **Interne opmerking** (optioneel) - Niet zichtbaar op printout
- **Externe opmerking** (optioneel) - Wordt mee afgedrukt
- **Opmerkingen aanvrager** (optioneel) - Extra notities
- **Autorisator*** (required, dropdown) - Wie moet goedkeuren

**Validatie**:
- Naam moet ingevuld zijn
- Autorisator moet geselecteerd zijn
- Minimaal 1 vergrendelpunt geselecteerd

**Acties**:
- Submit ‚Üí `submitAanvraag()` ‚Üí Success Modal
- Annuleren ‚Üí Sluit modal en reset form

### 2. Success Modal
**Trigger**: Na succesvolle aanvraag submit

**Info getoond**:
- ‚úì Bevestiging bericht
- Aanvraag nummer (formaat: YYYY-MM-DD-HH-MM-SS)
- Firebase key (technische ID)
- Email notificatie bevestiging

**Styling**: Groen gradient header met checkmark animatie

### 3. Detail Modal
**Trigger**: Klik op üëÅ knop in Tabel 3

**Secties**:
1. **Status badge** - Kleur-gecodeerde status met datum
2. **Aanvraag Informatie** - 2x2 grid met:
   - Aanvraag tekst
   - Installatie
   - Aanvrager (naam + email)
   - Autorisator (naam + email)
3. **Opmerkingen** - Alle 3 opmerking types (indien aanwezig)
4. **Geselecteerde Vergrendelpunten** - Tabel met alle data

**Styling**: Paars gradient header

### 4. Delete Confirmation Modal
**Trigger**: Klik op ‚úï knop in Tabel 3

**Elementen**:
- ‚ö† Warning icon met shake animatie
- Rood gradient header
- Aanvraag details in geel warning box
- Prominente waarschuwing over permanent verwijderen
- Twee knoppen:
  - "Annuleren" (grijs)
  - "Ja, Verwijderen" (rood) met loading state

**Loading state**: Spinner icon + disabled buttons tijdens delete

### 5. Delete Success Modal
**Trigger**: Na succesvolle verwijdering

**Bericht**: Bevestiging dat aanvraag permanent verwijderd is

**Styling**: Groen gradient (zelfde als Success Modal)

---

## üé® Styling Systeem

### CSS Architectuur
- **Layout**: CSS Grid voor tabellen, Flexbox voor componenten
- **Responsiveness**: Viewport-based units (vh, vw)
- **Theming**: Consistent kleurenpalet
- **Animations**: Keyframe animaties voor modals en slider

### Kleurenpalet

```css
/* Primair */
--primary-blue: #1a237e;
--primary-purple: #673ab7;

/* Status kleuren */
--success-green: #4caf50;
--warning-yellow: #ffc107;
--error-red: #f44336;
--info-blue: #2196f3;

/* Pending status */
--pending-bg: #fff3cd;
--pending-text: #856404;

/* Approved status */
--approved-bg: #d4edda;
--approved-text: #155724;

/* Rejected status */
--rejected-bg: #f8d7da;
--rejected-text: #721c24;

/* Neutrals */
--gray-50: #fafafa;
--gray-100: #f5f5f5;
--gray-200: #e0e0e0;
--gray-300: #bdbdbd;
```

### Key CSS Classes

```css
.table-container        /* Container voor elke tabel */
.main-table            /* Tabel 1 (linksboven) */
.side-table            /* Tabel 2 (rechtsboven) */
.bottom-left-table     /* Tabel 3 (linksonder) */
.bottom-right-table    /* Tabel 4 (rechtsonder) */

.filter-input          /* Search inputs in table headers */
.filter-input.active   /* Actieve filter met data */

.btn-select            /* ‚úì knop in Code kolom */
.btn-delete            /* ‚úï knop in Code kolom */
.btn-delete-small      /* ‚úï knop in Tabel 2 */
.btn-aanvragen         /* üìã Aanvragen knop */

.modal-overlay         /* Modal backdrop (rgba(0,0,0,0.6)) */
.modal-container       /* Modal content box */

.pagination            /* Paginatie container */
.pagination-btn        /* Pagina nummer knoppen */
.pagination-btn.active /* Actieve pagina (blauw) */
```

---

## üîÑ Data Flow

### 0. Background Prefetch Flow (NEW in v2.8.1)
```
App Mounts (Login Screen) ‚Üí useEffect triggers ‚Üí
  getFilteredSheetBData(null) ‚Üí Firebase call ‚Üí
  setPrefetchedData() + setDataPreloaded(true) ‚Üí
  Data cached in React state (ready for instant load)
```

### 1. Login Flow
```
User Input ‚Üí validateUser() ‚Üí
  ‚úì Success:
    - setIsLoggedIn(true)
    - loadAllTableData() ‚Üí Check if prefetchedData exists:
      ‚ö° YES: Instant load from cache (no server call)
      üì° NO: Fetch from Firebase
  ‚úó Failure: Show error message
```

### 2. Installatie Selectie Flow ‚ö†Ô∏è VERWIJDERD IN v2.8.0
```
~~Select Installatie ‚Üí handleInstallationSelect() ‚Üí~~
~~getFilteredSheetBData(installation) ‚Üí~~
~~setTableData() + setFilteredTableData() ‚Üí~~
~~Render Tabel 1~~

NIEUWE FLOW: Direct naar hoofdpagina met alle data
```

### 3. Filter Flow (In-Memory, geen server calls)
```
User types in filter ‚Üí handleFilterChange() ‚Üí
  Update filters state ‚Üí applyFilters() ‚Üí
  Filter tableData.data (IN MEMORY) ‚Üí setFilteredTableData() ‚Üí
  Re-render Tabel 1 (page 1)

NOTE: Geen Firebase calls - alles gebeurt lokaal in browser
```

### 4. Selectie Flow
```
Click ‚úì in Tabel 1 ‚Üí handleSelectRow(row, index) ‚Üí
  Generate unique rowId ‚Üí Add to selectedRows[] ‚Üí
  Re-render Tabel 1 (highlight row) + Tabel 2 (show row)
```

### 5. Aanvraag Submit Flow (v2.10.0 met Email)
```
Fill form + Click Verzenden ‚Üí handleFormSubmit() ‚Üí
  Validate inputs ‚Üí submitAanvraag() ‚Üí
    Write to Firebase Aanvragen database ‚Üí
    ‚úì Success:
      - sendAuthorizerNotification() ‚Üí Email naar autorisator (NEW in v2.10.0)
        ‚Ü≥ HTML email met aanvraag details en vergrendelpunten tabel
        ‚Ü≥ Van: reliabilitycmms@gmail.com
        ‚Ü≥ Naar: geselecteerde autorisator email
      - Clear selectedRows
      - Show Success Modal (met email bevestiging)
      - Refresh aanvragen (Tabel 3)
    ‚úó Failure: Show error alert

NOTE: Aanvraag wordt opgeslagen zelfs als email faalt (email failure wordt gelogd)
```

### 6. Delete Flow
```
Click ‚úï in Tabel 3 ‚Üí handleOpenDeleteModal() ‚Üí
  Show Delete Confirmation Modal ‚Üí
  Click "Ja, Verwijderen" ‚Üí handleConfirmDelete() ‚Üí
    deleteAanvraag(firebaseKey) ‚Üí
      ‚úì Success:
        - Close Delete Modal
        - Show Delete Success Modal
        - Refresh aanvragen (Tabel 3)
      ‚úó Failure: Show error alert
```

---

## üìß Email Systeem (NEW in v2.10.0)

### Autorisator Notificatie Email

**Wanneer**: Automatisch verzonden na succesvolle aanvraag submit

**Functie**: `sendAuthorizerNotification(aanvraagData, formData, selectedRows, userName)`

**Email Details**:
- **Van**: `reliabilitycmms@gmail.com` (via GmailApp alias)
- **Naar**: Geselecteerde autorisator email uit dropdown
- **Onderwerp**: `Nieuwe Aanvraag Vergrendelgroep - [Request ID]`
- **Formaat**: HTML email met plain text fallback

**Email Inhoud**:
1. **Header**: Gradient header met titel "Nieuwe Aanvraag Vergrendelgroep"
2. **Aanvraag Details** (groen panel):
   - Aanvraag Nummer (UUID)
   - Ingediend op (datum/tijd)
   - Aanvrager naam
   - Aanvrager email
3. **Formulier Gegevens** (blauw panel):
   - Installatie
   - Naam aanvraag
   - Interne opmerking
   - Externe opmerking
   - Algemene opmerkingen
4. **Vergrendelpunten Tabel**:
   - Volledig geformatteerde HTML tabel
   - Kolommen: #, Code, Type, Sleutelbox, Naam, Locatie
   - Alle geselecteerde vergrendelpunten
5. **Call to Action** (oranje panel):
   - Melding dat actie vereist is
   - Instructie om in te loggen op applicatie
6. **Footer**: Automatische email disclaimer

**Error Handling**:
```javascript
// Email failure stopt NIET de aanvraag
if (emailResult.success) {
  console.log('‚úì Notification email sent successfully');
} else {
  console.warn('‚ö† Failed to send notification email:', emailResult.message);
  // Continue anyway - aanvraag was saved successfully
}
```

**Return Object**:
```javascript
{
  success: true,
  requestId: "5a2e681f-b775-4f99-...",
  aanvraagNr: "5a2e681f",
  firebaseKey: "firebase-generated-key",
  emailSent: true,              // NEW in v2.10.0
  emailMessage: "Notification..."  // NEW in v2.10.0
}
```

### Debug Email Functies

**1. sendTestEmail()** üîß
- Stuurt test email naar `rob.oversteyns@gmail.com`
- Controleert GmailApp alias configuratie
- Returns: `{success: boolean, message: string, timestamp: string}`

**2. testAanvraagEmail()** üîß
- Stuurt aanvraag notification email met dummy data
- Test volledige email template en formatting
- Gebruikt echte `sendAuthorizerNotification()` functie
- Returns: `{success: boolean, message: string, testData: {...}}`

**3. debugLoadUsersFirebase()** üîß
- Test Firebase Users database connectie
- Controleert verschillende paths (/, /users, /fire-data)
- Returns gedetailleerde debug info over database structuur

### GmailApp Configuratie

**Vereisten**:
- Google Apps Script moet toegang hebben tot Gmail
- `reliabilitycmms@gmail.com` moet als alias ingesteld zijn
- OAuth scopes: `https://www.googleapis.com/auth/gmail.send`

**Code**:
```javascript
GmailApp.sendEmail(
  authorizerEmail,
  subject,
  plainTextBody,
  {
    from: 'reliabilitycmms@gmail.com',
    name: 'Reliability CMMS',
    htmlBody: htmlBody
  }
);
```

---

## üöÄ Performance Optimalisaties

### 1. Background Prefetch (NEW in v2.8.1) ‚ö°
```javascript
// Zodra App mount (login scherm verschijnt)
React.useEffect(() => {
  if (!isLoggedIn && !isPrefetching && !prefetchedData) {
    // Start Firebase data laden op achtergrond
    google.script.run
      .withSuccessHandler((data) => {
        setPrefetchedData(data); // Cache in React state
      })
      .getFilteredSheetBData(null); // Alle data
  }
}, [isLoggedIn, isPrefetching, prefetchedData]);

// Bij login: instant load indien data al klaar is
if (prefetchedData && dataPreloaded) {
  setTableData(prefetchedData); // Geen server call!
}
```

**Voordelen:**
- ‚ö° Meestal instant load na login
- üìâ Minder perceived loading time
- üéØ Betere user experience

### 2. In-Memory Filtering
```javascript
// Filters werken LOKAAL (geen server calls)
const applyFilters = React.useCallback(() => {
  let filtered = [...tableData.data]; // Data al in browser
  // Filter logica in JavaScript
  if (filters.code) {
    filtered = filtered.filter(row => row[codeIndex].includes(filters.code));
  }
  // etc...
}, [tableData.data, filters]);
```

**Voordelen:**
- üöÄ Instant filter resultaten (geen netwerk latency)
- üí∞ Minder Firebase reads (goedkoper)
- üì∂ Werkt offline na eerste load

### 3. Memoization
```javascript
// Gebruik React.useCallback voor stable functions
const getColumnIndex = React.useCallback((headerName) => {...}, [tableData.headers]);
const getUniqueValues = React.useCallback((columnName) => {...}, [...dependencies]);
```

### 4. Lazy Loading
- Paginatie (15 rijen per keer in UI)
- On-demand modal content rendering
- Conditional table rendering

### 5. React Batch Updates
Filters triggeren `applyFilters()` on every keystroke, maar React batch updates automatisch voor optimale performance.

---

## üèõÔ∏è Architecture Decisions

### Data Buffering Strategy (v2.8.0+)

**Beslissing**: In-memory buffering in de browser (React state) in plaats van server-side caching.

**Waarom:**
- ‚úÖ **Snelle filters**: Geen netwerk latency bij filteren
- ‚úÖ **Goedkoper**: Minder Firebase reads (1x bij login vs. meerdere keren bij filteren)
- ‚úÖ **Offline capable**: Werkt na eerste load zonder internet
- ‚úÖ **Betere UX**: Instant feedback bij interactie

**Trade-offs:**
- ‚ùå **Memory footprint**: Grote datasets kunnen browser memory vullen
- ‚ùå **Niet real-time**: Updates in Firebase worden niet automatisch getoond
- ‚ùå **Langere eerste load**: Alle data moet geladen worden

**Mitigatie:**
- Background prefetch (v2.8.1) verkort perceived load time
- Paginatie beperkt aantal gerenderde rijen
- Logout cleared alle cached data

### No Installation Selection (v2.8.0)

**Beslissing**: Verwijderen van installatie selectie scherm en dropdown.

**Waarom:**
- ‚úÖ **Snellere workflow**: 1 scherm minder
- ‚úÖ **Betere zoekervaring**: Doorzoek alle installaties tegelijk
- ‚úÖ **Simpeler codebase**: Minder state management
- ‚úÖ **Gebruikers kunnen nog steeds filteren**: Via Code kolom filter

**Migration path:**
Gebruik de Code kolom filter om te zoeken naar specifieke installaties (bijv. typ "APL3" in Code filter).

### Firebase vs Google Sheets

**Beslissing**: Firebase Realtime Database voor alle runtime data, Sheets alleen voor installaties lijst.

**Data Bronnen (v2.10.0):**
- ‚úÖ **Firebase #1** (`aanvragen-a3d22`): Vergrendelpunten data
- ‚úÖ **Firebase #2** (`aanvragen-groepen`): Aanvragen data
- ‚úÖ **Firebase #3** (`users-6e913`): Autorisators/Gebruikers data (NEW in v2.10.0)
- ‚úÖ **Google Sheets**: Alleen installaties lijst (DATA sheet, kolom A)

**Waarom Firebase voor Autorisators? (v2.10.0 wijziging):**
- ‚úÖ **Centrale user management**: Gebruikers beheer in √©√©n systeem
- ‚úÖ **Betere integratie**: Alle runtime data uit Firebase
- ‚úÖ **Sneller**: Geen Sheets API calls nodig
- ‚úÖ **Actieve gebruikers filter**: `ACTIVE === 1` flag support
- ‚úÖ **Schaalbaarheid**: Beter voor groeiend aantal gebruikers

---

## üêõ Known Issues & Limitations

### Browser Compatibility
- **Vereist moderne browser** met ES6+ support
- **Geen IE11 support** (gebruikt arrow functions, const/let, etc.)
- **Babel Standalone 6**: Geen optional chaining (`?.`) support
- **Geteste browsers**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

### Performance
- Bij >1000 rijen kan **in-memory filtering** traag worden (JavaScript loop)
- Veel geselecteerde rijen (>50) kunnen UI vertragen
- **Prefetch kan falen** bij zeer trage connecties - fallback werkt wel
- Paginatie helpt, maar rendering van zeer grote datasets is suboptimaal

### localStorage Restriction
**KRITIEK**: Artifacts in Claude.ai ondersteunen GEEN browser storage APIs
```javascript
// ‚ùå WERKT NIET in Claude.ai artifacts
localStorage.setItem('data', value);
sessionStorage.setItem('data', value);

// ‚úÖ GEBRUIK IN PLAATS DAARVAN
const [data, setData] = React.useState(value); // In-memory state
```

### Known Bugs
1. **Rare edge case**: Bij snel wisselen van installatie kunnen oude filters blijven hangen
   - **Workaround**: Filters worden gereset bij `handleInstallationChange()`

2. **Slider**: Bij zeer kleine schermen (<768px) kan slider moeilijk te gebruiken zijn
   - **Workaround**: Reset Layout knop herstelt naar defaults

3. **Modal z-index**: Bij meerdere modals kan volgorde soms fout zijn
   - **Workaround**: Modals worden nooit tegelijk geopend (exclusief)

---

## üîê Security Considerations

### Frontend
- **Geen gevoelige data** in frontend code
- **Email validation** op autorisator veld
- **XSS preventie**: React escapet automatisch output
- **CSRF**: Niet van toepassing (geen cookies gebruikt)

### Backend (Google Apps Script)
- **Authenticatie** via server-side validatie
- **Authorization checks** voor data toegang
- **Input sanitization** op alle form inputs
- **Rate limiting** op API calls (100/hour via web_fetch_rate_limit)

### Data Privacy
- **Geen PII** in localStorage (geen localStorage gebruikt)
- **Email addresses** alleen zichtbaar voor geauthenticeerde users
- **Aanvragen** alleen zichtbaar binnen eigen organisatie

---

## üß™ Testing

### Manual Testing Checklist

#### Login
- [ ] Correcte credentials ‚Üí Success
- [ ] Foute credentials ‚Üí Error message
- [ ] Empty fields ‚Üí Validation error

#### Installatie Selectie
- [ ] Dropdown toont alle installaties
- [ ] Selecteer installatie ‚Üí Laadt data
- [ ] Wissel van installatie ‚Üí Reset filters + selecties

#### Tabel 1 - Vergrendelpunten
- [ ] Data wordt correct getoond
- [ ] Filters werken per kolom
- [ ] Meerdere filters combineren werkt
- [ ] Clear filters button reset alles
- [ ] Paginatie werkt (prev/next/numbers)
- [ ] Selecteer rij ‚Üí Verschijnt in Tabel 2
- [ ] Deselecteer rij ‚Üí Verdwijnt uit Tabel 2

#### Tabel 2 - Geselecteerde Vergrendelpunten
- [ ] Toont geselecteerde rijen correct
- [ ] Aanvragen knop enabled bij selecties
- [ ] Verwijder knop werkt per rij
- [ ] Data blijft behouden bij page change Tabel 1

#### Tabel 3 - Aanvragen
- [ ] Laadt alle aanvragen
- [ ] Status badges correct gekleurd
- [ ] Bekijk knop opent detail modal
- [ ] Verwijder knop opent bevestiging
- [ ] Data refresh na nieuwe aanvraag

#### Centrale Slider
- [ ] Slider beweegt in alle richtingen
- [ ] Min/max beperkingen werken (20%-80%)
- [ ] Hulplijnen tonen tijdens slepen
- [ ] Reset button herstelt defaults
- [ ] Layout blijft behouden na resize

#### Aanvraag Modal
- [ ] Form validatie werkt (required fields)
- [ ] Character counter Naam field (66 max)
- [ ] Autorisator dropdown laadt correct
- [ ] Submit met geldige data ‚Üí Success
- [ ] Cancel button reset form

#### Modals (Algemeen)
- [ ] ESC key sluit modal (niet ge√Ømplementeerd, feature request)
- [ ] Click outside modal sluit modal
- [ ] Multiple modals niet tegelijk mogelijk
- [ ] Animaties smooth en zonder glitches

---

## üì¶ Version History & Breaking Changes

### v2.13.2-REQUESTER-EMAIL-FIX (Current)
**Release Date**: November 2025

**Bug Fix: Requester Email bij "Execute as: Me" Deployment üìß**
- ‚úÖ **Correcte requester email**: Aanvragen tonen nu de email van de daadwerkelijke gebruiker
- üßπ **Opgeschoonde email**: "Email" veld verwijderd uit autorisator notification (was redundant)
- üîß **Deploy-agnostic**: Werkt correct met "Execute as: Me" deployment

**Het Probleem:**
Wanneer de app gepubliceerd wordt met **"Execute as: Me"**:
- `getUserEmail()` in `submitAanvraag()` gebruikte `Session.getActiveUser()`
- Dit gaf ALTIJD de publisher's email (rob.oversteyns@gmail.com)
- ‚ùå Alle aanvragen hadden rob.oversteyns@gmail.com als requester
- ‚ùå Autorisator zag altijd dezelfde afzender, ongeacht wie de aanvraag deed

**De Oplossing:**
Requester email wordt nu meegegeven vanuit de frontend (login username):
```javascript
// Frontend (JavaScript.html):
.submitAanvraag(formData, selectedRows, userName, username);
//                                                   ^^^^^^^^
//                                    Login username (email)

// Backend (Code.js):
function submitAanvraag(formData, selectedRows, userName, requesterEmail) {
  // requesterEmail komt nu van login, niet van Session.getActiveUser()
  const aanvraagData = {
    "Requester Email": requesterEmail,  // Correcte email!
    ...
  };
}
```

**Email Template Verbetering:**
Voorheen had de notification email twee aparte velden:
```
Aanvrager: Jan Smit
Email: jan.smit@bedrijf.com
```

Nu gecombineerd in √©√©n regel:
```
Aanvrager: Jan Smit (jan.smit@bedrijf.com)
```

**Technical Changes:**
- **Updated**: `submitAanvraag()` function signature - nieuwe parameter `requesterEmail` (Code.js:349)
- **Updated**: `submitAanvraag()` call - stuurt nu `username` mee (JavaScript.html:747)
- **Removed**: `getUserEmail()` call in `submitAanvraag()` (Code.js:361)
- **Updated**: Email template - gecombineerd aanvrager + email in √©√©n veld (Code.js:741-742)
- **Added**: Console logging van requester email voor debugging (Code.js:354)

**Impact voor Gebruikers:**
- ‚úÖ Autorisators zien nu WIE daadwerkelijk de aanvraag heeft gedaan
- ‚úÖ Audit trail is correct - requester email matched de werkelijke gebruiker
- ‚úÖ Emails zijn overzichtelijker (√©√©n regel i.p.v. twee)

**Voor Deployment:**
Deze fix is essentieel voor correcte werking met **"Execute as: Me"** deployment:
- Alle aanvragen krijgen nu de juiste requester email
- Session.getActiveUser() wordt niet meer gebruikt voor requester identificatie
- Login username is de single source of truth voor gebruikersidentificatie

**Files Modified:**
- [JavaScript.html:2](JavaScript.html#L2) - Version bump
- [JavaScript.html:747](JavaScript.html#L747) - Pass username to submitAanvraag
- [Code.js:2](Code.js#L2) - Version bump
- [Code.js:349](Code.js#L349) - Updated function signature
- [Code.js:354](Code.js#L354) - Added requester email logging
- [Code.js:361-362](Code.js#L361-L362) - Removed getUserEmail() call
- [Code.js:741-743](Code.js#L741-L743) - Combined aanvrager + email in HTML template
- [Readme.html:8](Readme.html#L8) - Version info & changelog

### v2.13.1-USERNAME-FIX
**Release Date**: November 2025

**Bug Fix: Username Display met "Execute as: Me" Deployment üë§**
- ‚úÖ **Correcte username weergave**: Gebruikers zien nu hun eigen naam i.p.v. de publisher's naam
- üîß **Deploy-agnostic**: Werkt correct ongeacht "Execute as" setting
- üöÄ **Eenvoudiger**: Geen server call meer nodig voor username ophalen

**Het Probleem:**
Wanneer de app gepubliceerd wordt met **"Execute as: Me"** (aanbevolen voor email functionaliteit):
- `Session.getActiveUser().getEmail()` geeft ALTIJD de publisher's email (rob.oversteyns@gmail.com)
- `getUserName()` functie gebruikte `Session.getActiveUser()` ‚Üí Iedereen zag "Rob Oversteyns"
- ‚ùå Gebruikers zagen niet hun eigen naam in het welkom bericht

**De Oplossing:**
Username wordt nu direct uit het login formulier gehaald i.p.v. via server call:
```javascript
// Voorheen (na login):
google.script.run.withSuccessHandler(setUserName).getUserName();
// ‚Üí Bij "Execute as: Me" geeft dit altijd publisher's naam

// Nu (bij login success):
setUserName(username);
// ‚Üí Gebruikt de username waarmee gebruiker inlogt (hun email)
```

**Technical Changes:**
- **Verwijderd**: `getUserName()` useEffect call na login (JavaScript.html ~391-398)
- **Updated**: `handleLogin()` success handler zet nu direct `setUserName(username)` (JavaScript.html ~454-455, 468)
- **Verwijderd**: `getUserName()` functie uit Code.js (regel ~619-630)
- **Toegevoegd**: Uitgebreide deployment documentatie in README

**Deployment Settings Impact:**

| Setting | Email Functionaliteit | Username Display | Aanbeveling |
|---------|----------------------|------------------|-------------|
| **Execute as: Me** | ‚úÖ Werkt voor iedereen | ‚úÖ Nu correct! | ‚úÖ **AANBEVOLEN** |
| **Execute as: User** | ‚ùå Werkt alleen met alias setup | ‚úÖ Werkt | ‚ùå Niet aanbevolen |

**Waarom "Execute as: Me" Aanbevolen Is:**
1. ‚úÖ Email quota: Publisher's quota (1500/dag Workspace, 100/dag Consumer)
2. ‚úÖ Consistente afzender: Alle emails komen van √©√©n account
3. ‚úÖ Firebase toegang: Scripts kunnen Firebase aanroepen met publisher's credentials
4. ‚úÖ Geen auth problemen: Gebruikers hoeven geen extra permissies te geven
5. ‚ö†Ô∏è **Let op**: Alle acties gebeuren in naam van publisher (daarom logging belangrijk!)

**Security & Best Practices bij "Execute as: Me":**
1. **Quota Monitoring**:
   - Consumer Gmail: Max 100 emails/dag
   - Google Workspace: Max 1500 emails/dag
   - Implementeer quota check: `MailApp.getRemainingDailyQuota()`

2. **Toegangscontrole**:
   - ‚úÖ Publish met: "Who has access: Anyone with [bedrijf.com]" (Workspace domain)
   - ‚ùå NIET: "Anyone on the internet" (publiek toegankelijk)

3. **Audit Trail**:
   - Log welke gebruiker welke actie uitvoert in Firebase
   - Scripts draaien met publisher's rechten, maar track de echte gebruiker

4. **Email Quota Voorbeeld:**
   ```
   20 gebruikers √ó 5 aanvragen/dag = 100 emails/dag
   ‚Üí Consumer Gmail quota bereikt!
   ‚Üí Gebruik Google Workspace account (1500/dag limit)
   ```

**Session.getActiveUser() Behavior:**

```javascript
// Deployment: "Execute as: Me"
Session.getActiveUser().getEmail()
// ‚Üí ALTIJD: rob.oversteyns@gmail.com (publisher)

// Deployment: "Execute as: User accessing the web app"
Session.getActiveUser().getEmail()
// ‚Üí EMAIL van ingelogde gebruiker (maar emails werken niet!)
```

**Voor Nieuwe Ontwikkelaars:**
Als je dit project voortzet en twijfelt over deployment settings:
- **Voor productie**: Gebruik "Execute as: Me" + "Anyone with [domain.com]"
- **Voor testing**: Beide settings werken nu correct voor username display
- **Let op**: Email functionaliteit vereist ALTIJD "Execute as: Me"

**Files Modified:**
- [JavaScript.html:2](JavaScript.html#L2) - Version bump
- [JavaScript.html:390](JavaScript.html#L390) - Removed getUserName() useEffect
- [JavaScript.html:454-455](JavaScript.html#L454-L455) - Set username from login (new format)
- [JavaScript.html:468](JavaScript.html#L468) - Set username from login (legacy format)
- [Code.js:2](Code.js#L2) - Version bump
- [Code.js:617-621](Code.js#L617-L621) - Removed getUserName(), added deployment warning
- [Readme.html:8](Readme.html#L8) - Version info & comprehensive deployment documentation

### v2.13.0-SLIDER-PERFORMANCE
**Release Date**: November 2025

**Performance Optimization: Slider Throttling met RequestAnimationFrame! üöÄ**
- ‚ö° **Vloeiende slider beweging**: Centrale slider verplaatsing is nu veel soepeler en responsiever
- üéØ **RequestAnimationFrame throttling**: State updates beperkt tot max 60fps i.p.v. 100+ updates per seconde
- üîÑ **Geen lag meer**: React re-renders worden nu gecontroleerd uitgevoerd tijdens drag
- üíæ **Backup gemaakt**: Originele slider code opgeslagen in `JavaScript_OLD_SLIDER` en `Stylesheet_OLD_SLIDER`

**Technical Implementation:**
- **Nieuwe ref**: `sliderAnimationFrame` - Houdt animation frame ID bij voor cancellation
- **Updated**: `handleCentralDrag()` - Gebruikt nu `requestAnimationFrame()` om updates te throttlen
- **Updated**: `handleCentralDragEnd()` - Cancelt pending animation frames bij drag end
- **Probleem opgelost**: Elke mouse move triggerde voorheen direct `setColumnSplit()` en `setRowSplit()`, wat resulteerde in 100+ re-renders per seconde van alle 4 tabellen

**How It Works:**
1. Mouse movement tijdens drag wordt gedetecteerd
2. Eventuele pending animation frame wordt gecanceld met `cancelAnimationFrame()`
3. Nieuwe animation frame wordt gescheduled met `requestAnimationFrame()`
4. Browser voert update uit op volgende frame (max 60fps)
5. React re-rendert alleen op animation frames, niet op elke mouse movement
6. Resultaat: Vloeiende slider met minimale CPU usage

**Rollback Instructions:**
Indien de nieuwe implementatie problemen veroorzaakt:
1. Open [JavaScript_OLD_SLIDER](JavaScript_OLD_SLIDER) voor originele handler code
2. Open [Stylesheet_OLD_SLIDER](Stylesheet_OLD_SLIDER) voor originele CSS (geen wijzigingen)
3. Verwijder `sliderAnimationFrame` ref (regel ~91)
4. Vervang `handleCentralDrag()` met originele code (zonder requestAnimationFrame)
5. Vervang `handleCentralDragEnd()` met originele code (zonder cancelAnimationFrame)
6. Update versie terug naar 2.12.1-CLEANUP

**Files Modified:**
- [JavaScript.html:91](JavaScript.html#L91) - Added `sliderAnimationFrame` ref
- [JavaScript.html:294-321](JavaScript.html#L294-L321) - Optimized `handleCentralDrag()` with RAF throttling
- [JavaScript.html:323-332](JavaScript.html#L323-L332) - Updated `handleCentralDragEnd()` with cleanup
- [Code.js:2](Code.js#L2) - Version bump
- [Readme.html:8](Readme.html#L8) - Version info & changelog

### v2.12.1-CLEANUP
**Release Date**: November 2025

**UI/UX Improvements:**
- üßπ **Modal opgeschoond**: Groene kader met checkmarks verwijderd uit "Eerste Login" modal
- üìß **Email zonder emoji's**: Alle emoji's verwijderd uit welcome email (was: "üîê Welkom...", nu: "Welkom...")
- ‚ú® **Cleaner look**: Eenvoudigere, professionelere weergave

**Modal Changes:**
- Verwijderd: Groen kader met "‚úì Wachtwoord aangemaakt / ‚úì Opgeslagen / ‚úì Gemaild"
- Toegevoegd: Directe tekst met username inline: "...gemaild naar **username**"
- Resultaat: Korter, duidelijker bericht

**Email Changes:**
- Header: "üîê Welkom bij..." ‚Üí "Welkom bij..."
- BELANGRIJK label: "‚ö†Ô∏è Belangrijk:" ‚Üí "BELANGRIJK:"
- Footer: "ü§ñ Generated with..." ‚Üí "Generated with..."
- Alle emoji's verwijderd voor betere email compatibiliteit

### v2.12.0-AUTO-PASSWORD
**Release Date**: November 2025

**Major Feature: Automatische Wachtwoord Generatie! üéâ**
- üîê **Auto-genereer wachtwoord bij eerste login**: Systeem maakt automatisch een random 8-karakter wachtwoord aan
- üíæ **Opslaan in Firebase**: Wachtwoord wordt direct in database opgeslagen
- üìß **Email met wachtwoord**: Gebruiker krijgt professionele HTML email met login credentials
- ‚ú® **Nieuwe modal**: "Eerste Login" modal met success bericht

**Email Template:**
- Mooie HTML email met purple gradient header
- Duidelijk wachtwoord display met monospace font
- Stap-voor-stap login instructies
- Warning box met belangrijke informatie
- Plain text fallback voor email clients zonder HTML support

**Backend Changes:**
- **Nieuwe functie**: `generateRandomPassword(length)` - Genereert random wachtwoord met letters, cijfers en speciale karakters
- **Nieuwe functie**: `updateUserPassword(firebaseKey, newPassword)` - Update wachtwoord in Firebase via PATCH
- **Nieuwe functie**: `sendWelcomePasswordEmail(userEmail, userName, password)` - Stuurt welcome email via GmailApp
- **Updated**: `validateUser()` detecteert leeg wachtwoord en triggert auto-generatie flow
- **Return object**: Nieuw `firstLogin` field om eerste login te identificeren

**Frontend Changes:**
- Modal header: Orange ‚Üí Purple gradient (success kleuren)
- Modal emoji: ‚ö†Ô∏è ‚Üí üîê (security icon)
- Modal titel: "Wachtwoord Niet Ingesteld" ‚Üí "Eerste Login"
- Modal content: Nieuwe tekst met success checklist
- Button kleur: Orange ‚Üí Purple (consistent met header)
- Modal toont gebruikersnaam waarnaar email verzonden is

**Security:**
- Wachtwoord bevat: lowercase, uppercase, cijfers, speciale karakters (!@#$%)
- 8 karakters lang (configureerbaar)
- Cryptographically random via Math.random()

**Error Handling:**
- Als Firebase update faalt ‚Üí Error modal
- Als email faalt ‚Üí Wachtwoord blijft opgeslagen, waarschuwing in logs
- Graceful degradation: Wachtwoord opslaan heeft prioriteit boven email

### v2.11.2-MODAL-FIX
**Release Date**: November 2025

**Bug Fix:**
- üêõ **Modal nu zichtbaar op login scherm**: EmptyPasswordModal wordt nu ook gerenderd in login state
- ‚úÖ Modal verschijnt direct bij gebruikers met leeg database wachtwoord (niet pas na login)

**Technical Changes:**
- Login screen return statement gebruikt nu `React.Fragment` om zowel login form als modal te renderen
- `<EmptyPasswordModal />` toegevoegd aan login screen render
- Modal component blijft ook beschikbaar in ingelogde state (beide schermen)

### v2.11.1-EMPTY-PASSWORD-LOGIC
**Release Date**: November 2025

**Improved UX:**
- üîì **Wachtwoord veld niet meer verplicht**: Gebruikers kunnen nu zonder wachtwoord proberen in te loggen
- üß† **Slimme validatie logica**: Systeem controleert eerst database wachtwoord, dan user input

**Login Flow (nieuwe logica):**
1. **Gebruiker probeert in te loggen** (wachtwoord veld kan leeg zijn)
2. **Systeem checkt database wachtwoord voor deze gebruiker**
3. **Scenario A - DB wachtwoord is leeg:**
   - ‚ö†Ô∏è Toont modal: "Uw wachtwoord is nog niet ingesteld"
   - (Ongeacht wat gebruiker heeft ingetypt)
4. **Scenario B - DB wachtwoord bestaat, maar user typte niets:**
   - ‚ùå Error in login scherm: "Voer uw wachtwoord in"
5. **Scenario C - DB wachtwoord bestaat, user typte verkeerd wachtwoord:**
   - ‚ùå Error in login scherm: "Onjuist wachtwoord"
6. **Scenario D - DB wachtwoord bestaat en matched:**
   - ‚úÖ Login succesvol

**Backend Changes:**
- `validateUser()` uitgebreide logica met 3 scenario's
- Controleert eerst `dbPasswordIsEmpty`, dan `inputPassword`
- Nieuwe error messages: "Voer uw wachtwoord in" vs "Onjuist wachtwoord"
- Uitgebreide code commentaar met flow uitleg

**Frontend Changes:**
- Password veld: `required` attribuut verwijderd
- Placeholder gewijzigd naar: "Wachtwoord (optioneel)"
- Username validatie toegevoegd in `handleLogin()`
- Alle error messages worden getoond in login scherm (behalve empty DB password ‚Üí modal)

### v2.11.0-EMPTY-PASSWORD-CHECK
**Release Date**: November 2025

**New Features:**
- üîê **Wachtwoord Validatie**: Login controleert nu of wachtwoord ingesteld is in Firebase users database
- ‚ö†Ô∏è **Empty Password Modal**: Gebruikers met leeg wachtwoord krijgen duidelijke melding
- üîÑ **Firebase Authentication**: Volledig overschakeling van Google Sheets naar Firebase voor user validatie

**Backend Changes:**
- `validateUser()` functie herschreven om Firebase users database te gebruiken
- Return waarde gewijzigd van `boolean` naar `object` met details:
  - `success`: boolean - Login geslaagd
  - `emptyPassword`: boolean - Wachtwoord niet ingesteld
  - `message`: string - Foutmelding of succesbericht
- Controleert `PASSWORD` field in Firebase `/fire-data` path
- Alleen gebruiker 'Test' heeft wachtwoord ingesteld (voor testing)

**Frontend Changes:**
- `handleLogin()` aangepast om nieuwe response structuur te verwerken
- Nieuwe modal component: `EmptyPasswordModal`
- Orange warning gradient styling consistent met andere modals
- Backward compatible met oude boolean response (legacy support)

### v2.10.2-SYNC-UPDATE
**Release Date**: November 2025

**Changes:**
- üîÑ Version bump voor GitHub synchronisatie
- Alle versienummers ge√ºpdatet voor consistentie

### v2.10.0-DEBUG-AANVRAAG-EMAIL
**Release Date**: November 2025

**New Features:**
- üìß **Email Notificaties**: Automatische email naar autorisator bij nieuwe aanvraag
- üî• **Firebase Users Database**: Autorisators worden nu uit Firebase gelezen (was Google Sheets)
- üì® **HTML Email Template**: Professionele email met volledige aanvraag details
- üîß **Debug Panel**: Nieuwe debug functies voor email testing

**Email Functionaliteit:**
- `sendAuthorizerNotification()` - Stuurt HTML email naar gekozen autorisator
- Email bevat: Aanvraag details, formulier gegevens, vergrendelpunten tabel
- Van: `reliabilitycmms@gmail.com` (GmailApp alias)
- Graceful degradation: Aanvraag wordt opgeslagen zelfs als email faalt

**Backend Changes:**
- Nieuwe Firebase database: `FIREBASE_USERS_URL` (users-6e913)
- `getAutorisators()` haalt nu data uit Firebase `/fire-data` path
- Filtert op actieve gebruikers (`ACTIVE === 1`)
- `submitAanvraag()` roept automatisch `sendAuthorizerNotification()` aan
- Return object bevat nu: `emailSent` en `emailMessage` velden

**Debug Functies:**
- `sendTestEmail()` - Test email functionaliteit
- `testAanvraagEmail()` - Test aanvraag notification email met dummy data
- `debugLoadUsersFirebase()` - Debug Firebase users database connectie

**Technical Details:**
- GmailApp OAuth scopes vereist: `gmail.send`
- Email alias moet ingesteld zijn in Google Workspace
- HTML email met plain text fallback voor compatibiliteit

### v2.8.1-BACKGROUND-PREFETCH
**Release Date**: November 2025

**New Features:**
- ‚ö° Background prefetch: Data laadt tijdens login scherm
- üìä Smart caching: Instant load bij login als prefetch klaar is
- üéØ Graceful degradation: Fallback naar normale load als prefetch niet klaar

**Performance Improvements:**
- Meestal instant load na login (geen wachttijd)
- Betere perceived performance
- Minder server load door slim gebruik van cache

**Technical Changes:**
- Nieuwe React state: `prefetchedData`
- Nieuwe useEffect hook voor background loading
- Updated `loadAllTableData()` om prefetched data te gebruiken
- Removed oude `prefetchAllDataInBackground()` functie

### v2.8.0-NO-INSTALLATION-SELECTION
**Release Date**: November 2025

**Breaking Changes:**
- ‚ùå **VERWIJDERD**: Installatie selectie scherm
- ‚ùå **VERWIJDERD**: Installatie dropdown in sidebar
- ‚ùå **VERWIJDERD**: Filter per installatie functionaliteit

**New Features:**
- ‚úÖ Direct naar hoofdpagina na login
- ‚úÖ Alle vergrendelpunten worden direct getoond
- ‚úÖ In-memory filtering (sneller, geen server calls)
- ‚úÖ Backend ondersteunt nu `null` parameter voor alle data

**Migration Guide:**
```
VOOR v2.8.0:
Login ‚Üí Selecteer Installatie ‚Üí Klik Doorgaan ‚Üí Hoofdpagina (gefilterde data)

NA v2.8.0:
Login ‚Üí Hoofdpagina (alle data) ‚Üí Filter met Code kolom indien nodig
```

**Backend Changes:**
- `getFilteredSheetBData(null)` retourneert nu ALLE data
- Nieuwe functie: `getAllFirebaseDataFormatted()`
- Updated documentatie in Code.js

### v2.7.3-CENTRAL-SLIDER (Legacy)
**Features:**
- Centrale paarse slider voor layout aanpassing
- 4 tabellen grid systeem
- Installatie selectie workflow

---

## üìù Development Notes

### Code Conventions

#### Naming
- **Components**: PascalCase (`SuccessModal`)
- **Functions**: camelCase (`handleSubmit`)
- **Constants**: camelCase (`rowsPerPage`)
- **CSS Classes**: kebab-case (`table-container`)

#### React Patterns
```javascript
// State updaters
setData(newValue)                    // Direct value
setData(prev => [...prev, newItem])  // Functional update (voor arrays/objects)

// Conditional rendering
{condition && <Component />}         // Voor single element
{condition ? <A /> : <B />}         // Voor if-else

// Event handlers
onClick={handleClick}                // Zonder parameters
onClick={() => handleClick(param)}   // Met parameters
```

#### Error Handling
```javascript
google.script.run
  .withSuccessHandler((result) => {
    // Happy path
  })
  .withFailureHandler((error) => {
    console.error('Error:', error);
    alert(`Er is een fout opgetreden: ${error.message}`);
  })
  .functionName(params);
```

---

## üîÆ Future Enhancements

### Prioriteit Hoog
1. **Tabel 4 implementeren** - Analytics dashboard met:
   - Aantal aanvragen per status
   - Meest aangevraagde vergrendelpunten
   - Autorisator response times
   - Trends over tijd

2. **Export functionaliteit**:
   - Export geselecteerde rijen naar Excel
   - Export aanvragen naar PDF
   - Email aanvraag direct vanuit app

3. **Advanced filters**:
   - Datum range picker voor Tabel 3
   - Multi-select filters
   - Saved filter presets

### Prioriteit Middel
4. **Bulk operaties**:
   - Select all checkbox in Tabel 1
   - Bulk delete in Tabel 2
   - Bulk approve/reject in Tabel 3

5. **Notification systeem**:
   - In-app notifications voor nieuwe aanvragen
   - Browser notifications (opt-in)
   - Email digest (daily summary)

6. **User preferences**:
   - Save layout preferences (columnSplit/rowSplit)
   - Remember last selected installatie
   - Dark mode toggle

### Prioriteit Laag
7. **Mobile responsiveness**:
   - Touch-friendly slider
   - Responsive grid layout
   - Mobile-optimized tables

8. **Keyboard shortcuts**:
   - ESC to close modals
   - Arrow keys for pagination
   - / to focus search

9. **Accessibility (A11y)**:
   - ARIA labels
   - Screen reader support
   - Keyboard navigation
   - Focus indicators

---

## üÜò Troubleshooting

### Probleem: "Geen installaties gevonden"
**Oorzaak**: Backend call failed of geen data in spreadsheet  
**Oplossing**:
1. Check Google Apps Script logs
2. Verify spreadsheet data
3. Check `getInstallations()` function

### Probleem: Filters werken niet
**Oorzaak**: Column headers niet gevonden  
**Oplossing**:
1. Verify `tableData.headers` bevat correcte namen
2. Check `getColumnIndex()` functie
3. Inspect console voor errors

### Probleem: Slider beweegt niet
**Oorzaak**: Event listeners niet attached  
**Oplossing**:
1. Check `isDragging` state
2. Verify `handleCentralDrag` is called
3. Check for JavaScript errors in console

### Probleem: Modal sluit niet
**Oorzaak**: onClick handlers niet correct  
**Oplossing**:
1. Verify `e.stopPropagation()` in modal content
2. Check `handleCloseModal` is called
3. Clear modal state manually in console

### Probleem: Data laadt niet na login
**Oorzaak**: Prefetch failed of authentication issue  
**Oplossing**:
1. Check network tab voor failed requests
2. Verify `isLoggedIn` state is true
3. Manually call `fetchInstallations()`

---

## üìö Additional Resources

### React Documentation
- [React Hooks](https://react.dev/reference/react)
- [useCallback](https://react.dev/reference/react/useCallback)
- [useState](https://react.dev/reference/react/useState)

### Google Apps Script
- [HTML Service](https://developers.google.com/apps-script/guides/html)
- [Spreadsheet Service](https://developers.google.com/apps-script/reference/spreadsheet)
- [Base Service](https://developers.google.com/apps-script/guides/services/authorization)

### CSS Grid
- [CSS Grid Guide](https://css-tricks.com/snippets/css/complete-guide-grid/)
- [Grid by Example](https://gridbyexample.com/)

---

## üë• Contact & Support

**Developer**: Claude (Anthropic AI Assistant)  
**Project Owner**: [Your Name]  
**Last Updated**: November 2025

Voor vragen of issues, raadpleeg de Google Apps Script logs of check de browser console voor error messages.

---

## üìÑ License

This project is proprietary and confidential. Unauthorized copying, distribution, or use is strictly prohibited.

---

## ‚úÖ Quick Start Checklist

Voor nieuwe developers:

1. [ ] Clone repository
2. [ ] Open `index.html` in browser
3. [ ] Verify Google Apps Script connection
4. [ ] Test login met test credentials
5. [ ] Explore all 4 tabellen
6. [ ] Test centrale slider
7. [ ] Submit test aanvraag
8. [ ] Read ARCHITECTURE.md voor deep dive
9. [ ] Check CHANGELOG.md voor version history

**Klaar om te beginnen? Happy coding! üöÄ**