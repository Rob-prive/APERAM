<script type="text/babel">
//version = "2.37.2-CRITICALITEIT-STICKY-HEADER-FIX";
  function App() {
    // Authentication state
    const [isLoggedIn, setIsLoggedIn] = React.useState(false);
    const [username, setUsername] = React.useState('');
    const [password, setPassword] = React.useState('');
    const [error, setError] = React.useState('');
    
    // Installation selection state - NIET MEER NODIG (direct naar hoofdpagina)
    const [installations, setInstallations] = React.useState([]);
    const [selectedInstallation, setSelectedInstallation] = React.useState('');
    const [hasSelectedInstallation, setHasSelectedInstallation] = React.useState(true); // Altijd true om selectie scherm over te slaan
    
    // User and data state
    const [userName, setUserName] = React.useState('');
    const [userRole, setUserRole] = React.useState('A'); // A = user (default for security), B = authorizer, C = admin, D = super user, T = technical admin
    const [tableData, setTableData] = React.useState({ headers: [], data: [] });
    const [filteredTableData, setFilteredTableData] = React.useState([]);
    const [showTable, setShowTable] = React.useState(false);
    const [isLoading, setIsLoading] = React.useState(false);
    const [isLoadingTable, setIsLoadingTable] = React.useState(false);

    // Admin menu state
    const [isAdminMenuExpanded, setIsAdminMenuExpanded] = React.useState(false);
    const [activeAdminView, setActiveAdminView] = React.useState(null); // null, 'users', 'debug', 'criticaliteit'

    // Criticaliteit view state
    const [activeCriticaliteitView, setActiveCriticaliteitView] = React.useState(false);
    const [criticalityData, setCriticalityData] = React.useState([]);
    const [isLoadingCriticality, setIsLoadingCriticality] = React.useState(false);
    const [isCriticalityDetailModalOpen, setIsCriticalityDetailModalOpen] = React.useState(false);
    const [selectedCriticalityItem, setSelectedCriticalityItem] = React.useState(null);

    // Users management state
    const [users, setUsers] = React.useState([]);
    const [isLoadingUsers, setIsLoadingUsers] = React.useState(false);
    const [isEditUserModalOpen, setIsEditUserModalOpen] = React.useState(false);
    const [editingUser, setEditingUser] = React.useState(null);
    const [isUserSuccessModalOpen, setIsUserSuccessModalOpen] = React.useState(false);
    const [isUserErrorModalOpen, setIsUserErrorModalOpen] = React.useState(false);
    const [userModalMessage, setUserModalMessage] = React.useState('');
    const [isDeleteUserModalOpen, setIsDeleteUserModalOpen] = React.useState(false);
    const [isDeletingUser, setIsDeletingUser] = React.useState(false);
    const [isAddUserModalOpen, setIsAddUserModalOpen] = React.useState(false);

    // Filter state - Vergrendelpunten
    const [filters, setFilters] = React.useState({
      code: '',
      type: '',
      sleutelbox: '',
      naam: '',
      naamGeografisch: ''
    });

    // Filter state - Aanvragen
    const [aanvraagFilters, setAanvraagFilters] = React.useState({
      naam: '',
      datum: '',
      aanvrager: '',
      autorisator: '',
      status: ''
    });
    
    // Performance optimization state - Prefetch data
    const [isPrefetching, setIsPrefetching] = React.useState(false);
    const [dataPreloaded, setDataPreloaded] = React.useState(false);
    const [prefetchedData, setPrefetchedData] = React.useState(null);
    
    // Resizable grid state - CENTRALE SLIDER
    const [columnSplit, setColumnSplit] = React.useState(50);
    const [rowSplit, setRowSplit] = React.useState(60);
    const [isDragging, setIsDragging] = React.useState(false);

    // Sidebar collapse state
    const [isSidebarCollapsed, setIsSidebarCollapsed] = React.useState(false);
    
    // Pagination state
    const [currentPage, setCurrentPage] = React.useState(1);
    const rowsPerPage = 15;
    
    // Selection state
    const [selectedRows, setSelectedRows] = React.useState([]);
    
    // Modal and form state
    const [isModalOpen, setIsModalOpen] = React.useState(false);
    const [autorisators, setAutorisators] = React.useState([]);
    const [formData, setFormData] = React.useState({
      naam: '',
      installatie: '',
      interneOpmerking: '',
      externeOpmerking: '',
      opmerkingen: '',
      autorisator: ''
    });
    
    // Success modal state
    const [isSuccessModalOpen, setIsSuccessModalOpen] = React.useState(false);
    const [successData, setSuccessData] = React.useState(null);
    
    // Detail modal state
    const [isDetailModalOpen, setIsDetailModalOpen] = React.useState(false);
    const [selectedAanvraag, setSelectedAanvraag] = React.useState(null);
    
    // Delete confirmation modal state
    const [isDeleteModalOpen, setIsDeleteModalOpen] = React.useState(false);
    const [aanvraagToDelete, setAanvraagToDelete] = React.useState(null);
    const [isDeleting, setIsDeleting] = React.useState(false);
    
    // Delete success modal state
    const [isDeleteSuccessModalOpen, setIsDeleteSuccessModalOpen] = React.useState(false);

    // About modal state
    const [isAboutModalOpen, setIsAboutModalOpen] = React.useState(false);

    // Debug panel state
    const [isDebugPanelOpen, setIsDebugPanelOpen] = React.useState(false);
    const [debugOutput, setDebugOutput] = React.useState('');

    // Draggable test modal state
    const [isDraggableTestOpen, setIsDraggableTestOpen] = React.useState(false);

    // Empty password modal state
    const [isEmptyPasswordModalOpen, setIsEmptyPasswordModalOpen] = React.useState(false);

    // Approve state (used in detail modal)
    const [approverRemark, setApproverRemark] = React.useState('');
    const [isProcessingDecision, setIsProcessingDecision] = React.useState(false);

    // Decision result modal state
    const [isDecisionResultModalOpen, setIsDecisionResultModalOpen] = React.useState(false);
    const [decisionResult, setDecisionResult] = React.useState(null); // {type: 'Approved'|'Rejected', success: boolean}

    // RequestAnimationFrame ref voor slider throttling
    const sliderAnimationFrame = React.useRef(null);

    // Aanvragen data state
    const [aanvragen, setAanvragen] = React.useState([]);
    const [isLoadingAanvragen, setIsLoadingAanvragen] = React.useState(false);

    const version = "2.37.2-CRITICALITEIT-STICKY-HEADER-FIX";
    const stylesheetVersion = "1.3.1";

    // ===== HELPER FUNCTIONS =====

    const translateStatus = (status) => {
      const statusTranslations = {
        'Pending': 'In Behandeling',
        'Approved': 'Goedgekeurd',
        'Rejected': 'Afgekeurd'
      };
      return statusTranslations[status] || status;
    };

    const getNameFromEmail = (email) => {
      if (!email || !email.includes('@')) return email || 'Onbekend';
      const parts = email.split('@')[0].split('.');
      if (parts.length >= 2) {
        const firstName = parts[0].charAt(0).toUpperCase() + parts[0].slice(1);
        const lastName = parts[1].charAt(0).toUpperCase() + parts[1].slice(1);
        return `${firstName} ${lastName}`;
      }
      return email.split('@')[0];
    };
    
    const formatDate = (isoString) => {
      if (!isoString) return '-';
      try {
        const date = new Date(isoString);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${day}/${month}/${year} ${hours}:${minutes}`;
      } catch (error) {
        console.error('Error formatting date:', error);
        return isoString;
      }
    };

    const formatCriticalityDate = (isoString) => {
      if (!isoString) return '-';
      try {
        const date = new Date(isoString);
        const months = ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'];
        const day = date.getDate();
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        return `${day} ${month} ${year}`;
      } catch (error) {
        console.error('Error formatting criticality date:', error);
        return isoString;
      }
    };
    
    const parseFormData = (formDataString) => {
      try {
        return JSON.parse(formDataString);
      } catch (error) {
        console.error('Error parsing form data:', error);
        return {};
      }
    };
    
    const getColumnIndex = React.useCallback((headerName) => {
      const normalizedName = headerName.toLowerCase();
      return tableData.headers.findIndex(h => h.toLowerCase().includes(normalizedName));
    }, [tableData.headers]);

    const getUniqueValues = React.useCallback((columnName) => {
      if (!tableData.data || tableData.data.length === 0) return [];
      
      const columnIndex = getColumnIndex(columnName);
      if (columnIndex === -1) return [];

      let dataToFilter = [...tableData.data];
      
      const codeIndex = getColumnIndex('code');
      const typeIndex = getColumnIndex('type');
      
      if (columnName === 'type' && filters.code) {
        dataToFilter = dataToFilter.filter(row => row[codeIndex] === filters.code);
      } else if (columnName === 'sleutelbox') {
        if (filters.code) {
          dataToFilter = dataToFilter.filter(row => row[codeIndex] === filters.code);
        }
        if (filters.type) {
          dataToFilter = dataToFilter.filter(row => row[typeIndex] === filters.type);
        }
      }

      const values = dataToFilter
        .map(row => row[columnIndex])
        .filter(value => value !== null && value !== undefined && value !== '');
      
      return [...new Set(values)].sort();
    }, [tableData.data, filters.code, filters.type, getColumnIndex]);

    const applyFilters = React.useCallback(() => {
      let filtered = [...tableData.data];
      
      const codeIndex = getColumnIndex('code');
      const typeIndex = getColumnIndex('type');
      const sleutelboxIndex = getColumnIndex('sleutelbox');
      const naamIndex = getColumnIndex('naam');
      
      const naamGeografischIndex = tableData.headers.findIndex(h => {
        const lower = h.toLowerCase();
        return lower.includes('naam') && lower.includes('geografische');
      });

      if (filters.code) {
        const searchText = filters.code.toLowerCase();
        filtered = filtered.filter(row => {
          const cellValue = row[codeIndex];
          return cellValue && cellValue.toString().toLowerCase().includes(searchText);
        });
      }
      
      if (filters.type) {
        const searchText = filters.type.toLowerCase();
        filtered = filtered.filter(row => {
          const cellValue = row[typeIndex];
          return cellValue && cellValue.toString().toLowerCase().includes(searchText);
        });
      }
      
      if (filters.sleutelbox) {
        const searchText = filters.sleutelbox.toLowerCase();
        filtered = filtered.filter(row => {
          const cellValue = row[sleutelboxIndex];
          return cellValue && cellValue.toString().toLowerCase().includes(searchText);
        });
      }

      if (filters.naam) {
        const searchText = filters.naam.toLowerCase();
        filtered = filtered.filter(row => {
          const cellValue = row[naamIndex];
          return cellValue && cellValue.toString().toLowerCase().includes(searchText);
        });
      }

      if (filters.naamGeografisch) {
        const searchText = filters.naamGeografisch.toLowerCase();
        filtered = filtered.filter(row => {
          const cellValue = row[naamGeografischIndex];
          return cellValue && cellValue.toString().toLowerCase().includes(searchText);
        });
      }

      setFilteredTableData(filtered);
    }, [tableData.data, tableData.headers, filters]);

    const handleFilterChange = (filterName, value) => {
      setFilters(prev => ({
        ...prev,
        [filterName]: value
      }));
    };

    const handleAanvraagFilterChange = (filterName, value) => {
      setAanvraagFilters(prev => ({
        ...prev,
        [filterName]: value
      }));
    };

    const clearFilters = () => {
      setFilters({
        code: '',
        type: '',
        sleutelbox: '',
        naam: '',
        naamGeografisch: ''
      });
      setCurrentPage(1);
    };

    // ===== SELECTION HANDLERS =====

    const generateRowId = (row, rowIndex) => {
      const cellValues = row.map(cell => String(cell || '')).join('|');
      return `row-${rowIndex}-${cellValues}`;
    };

    const handleSelectRow = (row, rowIndex) => {
      const fullRowIndex = startIndex + rowIndex;
      const rowId = generateRowId(row, fullRowIndex);
      
      const rowData = {
        data: row,
        originalIndex: fullRowIndex,
        id: rowId
      };
      
      const isAlreadySelected = selectedRows.some(r => r.id === rowId);
      
      if (!isAlreadySelected) {
        setSelectedRows(prev => {
          const newRows = [...prev, rowData];
          console.log('Selected rows:', newRows.length);
          return newRows;
        });
      }
    };

    const handleDeleteRow = (rowId) => {
      setSelectedRows(prev => prev.filter(r => r.id !== rowId));
    };

    const isRowSelected = (rowIndex) => {
      const fullRowIndex = startIndex + rowIndex;
      const row = paginatedData[rowIndex];
      if (!row) return false;
      const rowId = generateRowId(row, fullRowIndex);
      return selectedRows.some(r => r.id === rowId);
    };

    // ===== CENTRALE SLIDER HANDLERS =====

    const handleCentralDragStart = (e) => {
      e.preventDefault();
      setIsDragging(true);
      document.body.classList.add('dragging-central');
    };

    const handleCentralDrag = React.useCallback((e) => {
      if (!isDragging) return;

      // Cancel any pending animation frame to prevent queuing multiple updates
      if (sliderAnimationFrame.current) {
        cancelAnimationFrame(sliderAnimationFrame.current);
      }

      // Schedule update on next animation frame (max 60fps)
      sliderAnimationFrame.current = requestAnimationFrame(() => {
        const container = document.querySelector('.tables-grid');
        if (!container) return;

        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const percentageX = (x / rect.width) * 100;
        const percentageY = (y / rect.height) * 100;

        if (percentageX >= 20 && percentageX <= 80) {
          setColumnSplit(percentageX);
        }
        if (percentageY >= 20 && percentageY <= 80) {
          setRowSplit(percentageY);
        }
      });
    }, [isDragging]);

    const handleCentralDragEnd = () => {
      // Cancel any pending animation frame on drag end
      if (sliderAnimationFrame.current) {
        cancelAnimationFrame(sliderAnimationFrame.current);
        sliderAnimationFrame.current = null;
      }

      setIsDragging(false);
      document.body.classList.remove('dragging-central');
    };

    // ===== PAGINATION =====

    const totalPages = Math.ceil(filteredTableData.length / rowsPerPage);
    const startIndex = (currentPage - 1) * rowsPerPage;
    const endIndex = startIndex + rowsPerPage;
    const paginatedData = filteredTableData.slice(startIndex, endIndex);

    const handlePageChange = (newPage) => {
      if (newPage >= 1 && newPage <= totalPages) {
        setCurrentPage(newPage);
      }
    };

    const getPageNumbers = () => {
      const pages = [];
      const maxVisible = 5;
      
      if (totalPages <= maxVisible) {
        for (let i = 1; i <= totalPages; i++) {
          pages.push(i);
        }
      } else {
        if (currentPage <= 3) {
          for (let i = 1; i <= 4; i++) pages.push(i);
          pages.push('...');
          pages.push(totalPages);
        } else if (currentPage >= totalPages - 2) {
          pages.push(1);
          pages.push('...');
          for (let i = totalPages - 3; i <= totalPages; i++) pages.push(i);
        } else {
          pages.push(1);
          pages.push('...');
          pages.push(currentPage - 1);
          pages.push(currentPage);
          pages.push(currentPage + 1);
          pages.push('...');
          pages.push(totalPages);
        }
      }
      
      return pages;
    };

    // ===== ROLE-BASED FILTERING =====
    // ===== PRE-COMPUTED CACHE FOR AANVRAGEN =====
    // Parse JSON and format data ONCE instead of on every render
    // This prevents performance issues when filtering
    const processedAanvragen = React.useMemo(() => {
      if (!aanvragen || aanvragen.length === 0) return [];

      return aanvragen.map(aanvraag => {
        const formData = parseFormData(aanvraag['Form Data'] || '{}');
        return {
          ...aanvraag,
          _formData: formData,
          _naam: formData.naam || '',
          _installatie: formData.installatie || '',
          _aanvragerNaam: getNameFromEmail(aanvraag['Requester Email']),
          _autorisatorNaam: getNameFromEmail(aanvraag['Approver Email']),
          _datum: formatDate(aanvraag['Timestamp']),
          _status: aanvraag['Status'] || 'Pending'
        };
      });
    }, [aanvragen]);

    // Filter aanvragen based on user role:
    // Role A (user): See only own requests (Requester Email = username)
    // Role B (authorizer): See only requests to approve (Approver Email = username)
    // Role C (admin) and D (super user): See all requests
    const filteredAanvragen = React.useMemo(() => {
      if (!processedAanvragen || processedAanvragen.length === 0) return [];

      // Step 1: Role-based filtering
      let filtered = processedAanvragen;

      if (userRole === 'C' || userRole === 'D') {
        // Admin and Super User see all
        filtered = processedAanvragen;
      } else if (userRole === 'B') {
        // Authorizer sees only requests they need to approve
        filtered = processedAanvragen.filter(aanvraag =>
          aanvraag['Approver Email'] === username
        );
      } else if (userRole === 'A') {
        // Standard user sees only their own requests
        filtered = processedAanvragen.filter(aanvraag =>
          aanvraag['Requester Email'] === username
        );
      } else {
        // Default: no access
        return [];
      }

      // Step 2: Search filtering on cached data
      if (aanvraagFilters.naam) {
        const searchText = aanvraagFilters.naam.toLowerCase();
        filtered = filtered.filter(aanvraag =>
          aanvraag._naam.toLowerCase().includes(searchText)
        );
      }

      if (aanvraagFilters.datum) {
        const searchText = aanvraagFilters.datum.toLowerCase();
        filtered = filtered.filter(aanvraag =>
          aanvraag._datum.toLowerCase().includes(searchText)
        );
      }

      if (aanvraagFilters.aanvrager) {
        const searchText = aanvraagFilters.aanvrager.toLowerCase();
        filtered = filtered.filter(aanvraag =>
          aanvraag._aanvragerNaam.toLowerCase().includes(searchText)
        );
      }

      if (aanvraagFilters.autorisator) {
        const searchText = aanvraagFilters.autorisator.toLowerCase();
        filtered = filtered.filter(aanvraag =>
          aanvraag._autorisatorNaam.toLowerCase().includes(searchText)
        );
      }

      if (aanvraagFilters.status) {
        const searchText = aanvraagFilters.status.toLowerCase();
        filtered = filtered.filter(aanvraag =>
          aanvraag._status.toLowerCase().includes(searchText)
        );
      }

      return filtered;
    }, [processedAanvragen, userRole, username, aanvraagFilters.naam, aanvraagFilters.datum, aanvraagFilters.aanvrager, aanvraagFilters.autorisator, aanvraagFilters.status]);

	// ===== EFFECTS =====

    React.useEffect(() => {
      if (tableData.data && tableData.data.length > 0) {
        applyFilters();
      }
    }, [tableData.data, tableData.headers, filters, getColumnIndex]);

    React.useEffect(() => {
      setCurrentPage(1);
    }, [filters, selectedInstallation]);

    // VERWIJDERD: Username prefetch voor installaties - niet meer nodig
    // VERWIJDERD: getUserName() call - gebruiken nu de login username direct

    // useEffect hooks voor installatie selectie verwijderd - data wordt nu direct bij login geladen

    // Prefetch data zodra login scherm gerenderd is (achtergrond laden)
    React.useEffect(() => {
      if (!isLoggedIn && !isPrefetching && !prefetchedData) {
        console.log('üöÄ Starting background prefetch of vergrendelpunten data...');
        setIsPrefetching(true);

        google.script.run
          .withSuccessHandler((data) => {
            const itemCount = (data && data.data) ? data.data.length : 0;
            console.log('‚úì Background prefetch completed:', itemCount, 'vergrendelpunten');
            setPrefetchedData(data);
            setDataPreloaded(true);
            setIsPrefetching(false);
          })
          .withFailureHandler((error) => {
            console.log('Background prefetch failed (not critical):', error);
            setIsPrefetching(false);
          })
          .getFilteredSheetBData(null); // Laad alle data zonder filter
      }
    }, [isLoggedIn, isPrefetching, prefetchedData]);

    React.useEffect(() => {
      if (isDragging) {
        document.addEventListener('mousemove', handleCentralDrag);
        document.addEventListener('mouseup', handleCentralDragEnd);
        return () => {
          document.removeEventListener('mousemove', handleCentralDrag);
          document.removeEventListener('mouseup', handleCentralDragEnd);
        };
      }
    }, [isDragging, handleCentralDrag]);

    // ===== EVENT HANDLERS =====

    const handleSubmit = (e) => {
      e.preventDefault();
      handleLogin();
    };

    const handleLogin = () => {
      setError('');

      // Validate username is not empty
      if (!username || username.trim() === '') {
        setError('Voer uw gebruikersnaam in');
        return;
      }

      setIsLoading(true);

      google.script.run
        .withSuccessHandler((result) => {
          setIsLoading(false);

          // Check if result is an object (new format) or boolean (legacy)
          if (typeof result === 'object' && result !== null) {
            // New format: { success: boolean, emptyPassword: boolean, role: string, message: string }
            if (result.success) {
              setIsLoggedIn(true);
              // Set username from login (werkt ongeacht deployment setting)
              setUserName(username);
              // Set user role (A = user, B = authorizer, C = admin, D = super user, T = technical admin)
              const role = result.role || 'A'; // Default to user if role not provided
              setUserRole(role);

              // If role is T (technical admin), go directly to Criticaliteit view
              if (role === 'T') {
                setActiveCriticaliteitView(true);
                setShowTable(true); // Enable main content
                fetchCriticalityData(); // Load criticality data
              } else {
                // For other roles, load normal table data
                loadAllTableData();
              }
            } else if (result.emptyPassword) {
              // Password is empty - show modal
              setIsEmptyPasswordModalOpen(true);
            } else {
              // Other error (wrong password, user not found, etc.)
              setError(result.message || 'Ongeldige gebruikersnaam of wachtwoord');
            }
          } else if (result === true) {
            // Legacy format: boolean true
            setIsLoggedIn(true);
            setUserName(username);
            setUserRole('A'); // Default to user for legacy format (security)
            loadAllTableData();
          } else {
            // Legacy format: boolean false
            setError('Ongeldige gebruikersnaam of wachtwoord');
          }
        })
        .withFailureHandler((error) => {
          setIsLoading(false);
          setError(`Er is een fout opgetreden: ${error.message}`);
        })
        .validateUser(username, password);
    };

    // VERWIJDERD: fetchAllDataParallel - niet meer nodig
    // VERWIJDERD: fetchInstallations - niet meer nodig
    // VERWIJDERD: handleInstallationSelect - niet meer nodig

    // Nieuwe functie: laadt ALLE data zonder installatie filter
    // Gebruikt prefetched data indien beschikbaar voor snellere load
    const loadAllTableData = () => {
      setShowTable(true);
      setFilters({
        code: '',
        type: '',
        sleutelbox: '',
        naam: '',
        naamGeografisch: ''
      });
      setCurrentPage(1);
      setSelectedRows([]);

      // Check of data al geprefetcht is
      if (prefetchedData && dataPreloaded) {
        console.log('‚ö° Gebruik prefetched data (instant load!)');
        setTableData(prefetchedData);
        setFilteredTableData(prefetchedData.data || []);
        fetchAanvragen();
        return; // Geen server call nodig!
      }

      // Fallback: data nog niet geprefetcht, laad nu
      console.log('üì° Prefetch niet beschikbaar, laden van server...');
      setIsLoadingTable(true);

      google.script.run
        .withSuccessHandler((data) => {
          setIsLoadingTable(false);
          setTableData(data);
          setFilteredTableData(data.data || []);
          setPrefetchedData(data); // Cache voor volgende keer
          setDataPreloaded(true);
          console.log('‚úì Alle vergrendelpunten data geladen');
          // Ook aanvragen laden
          fetchAanvragen();
        })
        .withFailureHandler((error) => {
          setIsLoadingTable(false);
          setError('Fout bij het ophalen van tabel data');
          console.error('Error fetching table data:', error);
        })
        .getFilteredSheetBData(null); // null = alle data zonder filter
    };

    // VERWIJDERD: fetchFilteredTableData - niet meer nodig (we laden nu altijd alle data)
    
    const fetchAanvragen = () => {
      setIsLoadingAanvragen(true);

      google.script.run
        .withSuccessHandler((data) => {
          setIsLoadingAanvragen(false);
          setAanvragen(data || []);
          console.log('‚úì Aanvragen loaded:', data.length);
        })
        .withFailureHandler((error) => {
          setIsLoadingAanvragen(false);
          console.error('Error fetching aanvragen:', error);
          setAanvragen([]);
        })
        .getAanvragen();
    };

    const fetchUsers = () => {
      setIsLoadingUsers(true);

      google.script.run
        .withSuccessHandler((data) => {
          setIsLoadingUsers(false);
          // Filter out empty/invalid users (deleted users leave gaps in Firebase numeric keys)
          const validUsers = (data || []).filter(user =>
            user && user.USER_NAME && user.USER_NAME.trim() !== ''
          );
          setUsers(validUsers);
          console.log('‚úì Users loaded:', validUsers.length, '(filtered from', (data && data.length) || 0, 'total)');
        })
        .withFailureHandler((error) => {
          setIsLoadingUsers(false);
          console.error('Error fetching users:', error);
          setUsers([]);
        })
        .getUsers();
    };

    const fetchCriticalityData = () => {
      setIsLoadingCriticality(true);

      google.script.run
        .withSuccessHandler((data) => {
          setIsLoadingCriticality(false);
          setCriticalityData(data || []);
          console.log('‚úì Criticality data loaded:', (data || []).length, 'items');
        })
        .withFailureHandler((error) => {
          setIsLoadingCriticality(false);
          console.error('Error fetching criticality data:', error);
          setCriticalityData([]);
        })
        .getCriticalityData();
    };

    // Criticaliteit detail modal handlers
    const handleOpenCriticalityDetail = (item) => {
      setSelectedCriticalityItem(item);
      setIsCriticalityDetailModalOpen(true);
    };

    const handleCloseCriticalityDetail = () => {
      setIsCriticalityDetailModalOpen(false);
      setSelectedCriticalityItem(null);
    };

    // User edit handlers
    const handleOpenEditUserModal = (user) => {
      setEditingUser(user);
      setIsEditUserModalOpen(true);
    };

    const handleCloseEditUserModal = () => {
      setIsEditUserModalOpen(false);
      setEditingUser(null);
    };

    const handleUpdateUser = (updatedUserData) => {
      console.log('Updating user:', updatedUserData);

      google.script.run
        .withSuccessHandler((result) => {
          if (result.success) {
            setUserModalMessage(result.message);
            setIsUserSuccessModalOpen(true);
            handleCloseEditUserModal();
            fetchUsers(); // Refresh de lijst
          } else {
            setUserModalMessage(result.message);
            setIsUserErrorModalOpen(true);
          }
        })
        .withFailureHandler((error) => {
          console.error('Error updating user:', error);
          setUserModalMessage('Fout bij bijwerken gebruiker: ' + error.message);
          setIsUserErrorModalOpen(true);
        })
        .updateUser(updatedUserData);
    };

    // User delete handlers
    const handleOpenDeleteUserModal = () => {
      setIsDeleteUserModalOpen(true);
    };

    const handleCloseDeleteUserModal = () => {
      setIsDeleteUserModalOpen(false);
    };

    const handleDeleteUser = () => {
      if (!editingUser) return;

      setIsDeletingUser(true);
      console.log('Deleting user:', editingUser.firebaseKey);

      google.script.run
        .withSuccessHandler((result) => {
          setIsDeletingUser(false);
          if (result.success) {
            setUserModalMessage(result.message);
            setIsUserSuccessModalOpen(true);
            handleCloseDeleteUserModal();
            handleCloseEditUserModal();
            fetchUsers(); // Refresh de lijst
          } else {
            setUserModalMessage(result.message);
            setIsUserErrorModalOpen(true);
            handleCloseDeleteUserModal();
          }
        })
        .withFailureHandler((error) => {
          setIsDeletingUser(false);
          console.error('Error deleting user:', error);
          setUserModalMessage('Fout bij verwijderen gebruiker: ' + error.message);
          setIsUserErrorModalOpen(true);
          handleCloseDeleteUserModal();
        })
        .deleteUser(editingUser.firebaseKey);
    };

    // User create handlers
    const handleOpenAddUserModal = () => {
      setIsAddUserModalOpen(true);
    };

    const handleCloseAddUserModal = () => {
      setIsAddUserModalOpen(false);
    };

    const handleCreateUser = (newUserData) => {
      console.log('Creating user:', newUserData);

      google.script.run
        .withSuccessHandler((result) => {
          if (result.success) {
            setUserModalMessage(result.message);
            setIsUserSuccessModalOpen(true);
            handleCloseAddUserModal();
            fetchUsers(); // Refresh de lijst
          } else {
            setUserModalMessage(result.message);
            setIsUserErrorModalOpen(true);
          }
        })
        .withFailureHandler((error) => {
          console.error('Error creating user:', error);
          setUserModalMessage('Fout bij aanmaken gebruiker: ' + error.message);
          setIsUserErrorModalOpen(true);
        })
        .createUser(newUserData);
    };

    const handleLogout = () => {
      setIsLoggedIn(false);
      // hasSelectedInstallation wordt niet meer gereset (altijd true)
      setSelectedInstallation('');
      setUsername('');
      setPassword('');
      setError('');
      setUserRole('A'); // Reset to most restrictive role (user)
      setActiveAdminView(null); // Close admin views
      setTableData({ headers: [], data: [] });
      setFilteredTableData([]);
      setShowTable(false);
      setDataPreloaded(false);
      setIsPrefetching(false);
      setPrefetchedData(null); // Clear prefetched data bij logout
      setSelectedRows([]);
      setAanvragen([]);
      setUsers([]); // Clear users list
      setFilters({
        code: '',
        type: '',
        sleutelbox: '',
        naam: '',
        naamGeografisch: ''
      });
    };

    // VERWIJDERD: handleInstallationChange - niet meer nodig

    // ===== MODAL HANDLERS =====
    
    const handleOpenDetailModal = (aanvraag) => {
      setSelectedAanvraag(aanvraag);
      setIsDetailModalOpen(true);
      setApproverRemark(''); // Reset remark when opening modal
    };

    const handleCloseDetailModal = () => {
      setIsDetailModalOpen(false);
      setSelectedAanvraag(null);
      setApproverRemark(''); // Reset remark when closing modal
    };
    
    const handleOpenDeleteModal = (aanvraag) => {
      setAanvraagToDelete(aanvraag);
      setIsDeleteModalOpen(true);
    };
    
    const handleCloseDeleteModal = () => {
      setIsDeleteModalOpen(false);
      setAanvraagToDelete(null);
    };

    const handleApproveAanvraag = (decision) => {
      if (!selectedAanvraag) return;

      setIsProcessingDecision(true);

      const decisionData = {
        firebaseKey: selectedAanvraag.firebaseKey,
        decision: decision, // 'Approved' or 'Rejected'
        authorizerRemark: approverRemark,
        decisionTimestamp: new Date().toISOString()
      };

      google.script.run
        .withSuccessHandler((result) => {
          setIsProcessingDecision(false);

          if (result.success) {
            // Refresh aanvragen data
            fetchAanvragen();

            // Close detail modal and reset remark
            handleCloseDetailModal();
            setApproverRemark('');

            // Show success modal
            setDecisionResult({ type: decision, success: true });
            setIsDecisionResultModalOpen(true);
          } else {
            // Show error modal
            setDecisionResult({ type: decision, success: false, message: result.message });
            setIsDecisionResultModalOpen(true);
          }
        })
        .withFailureHandler((error) => {
          setIsProcessingDecision(false);
          // Show error modal
          setDecisionResult({ type: decision, success: false, message: error.message });
          setIsDecisionResultModalOpen(true);
        })
        .updateAanvraagDecision(decisionData);
    };

    const handleOpenAboutModal = () => {
      console.log('üîµ About button clicked! Opening modal...');
      console.log('Current state - isAboutModalOpen:', isAboutModalOpen);
      setIsAboutModalOpen(true);
      console.log('‚úÖ setIsAboutModalOpen(true) called');
    };

    const handleCloseAboutModal = () => {
      console.log('üî¥ Closing About modal...');
      setIsAboutModalOpen(false);
      console.log('‚úÖ setIsAboutModalOpen(false) called');
    };

    const handleToggleDebugPanel = () => {
      console.log('üîß Toggle debug panel:', !isDebugPanelOpen);
      setIsDebugPanelOpen(!isDebugPanelOpen);
    };

    const handleConfirmDelete = () => {
      if (!aanvraagToDelete || !aanvraagToDelete.firebaseKey) {
        alert('Geen geldige aanvraag om te verwijderen');
        return;
      }
      
      setIsDeleting(true);
      
      google.script.run
        .withSuccessHandler((result) => {
          setIsDeleting(false);
          
          if (result.success) {
            handleCloseDeleteModal();
            fetchAanvragen();
            setIsDeleteSuccessModalOpen(true);
          } else {
            alert(`‚úñ Fout bij verwijderen:\n\n${result.error}`);
          }
        })
        .withFailureHandler((error) => {
          setIsDeleting(false);
          alert(`‚úñ Er is een fout opgetreden:\n\n${error.message}`);
        })
        .deleteAanvraag(aanvraagToDelete.firebaseKey);
    };
    
    const handleOpenModal = () => {
      console.log('Opening modal...');
      setFormData(prev => ({
        ...prev,
        installatie: selectedInstallation
      }));
      
      google.script.run
        .withSuccessHandler((data) => {
          console.log('Autorisators loaded:', data);
          setAutorisators(data);
        })
        .withFailureHandler((error) => {
          console.error('Error fetching autorisators:', error);
          setAutorisators([]);
        })
        .getAutorisators();
      
      setIsModalOpen(true);
      console.log('Modal state set to true');
    };
    
    const handleCloseModal = () => {
      setIsModalOpen(false);
      setFormData({
        naam: '',
        installatie: selectedInstallation,
        interneOpmerking: '',
        externeOpmerking: '',
        opmerkingen: '',
        autorisator: ''
      });
    };
    
    const handleFormChange = (field, value) => {
      setFormData(prev => ({
        ...prev,
        [field]: value
      }));
    };
    
    const handleFormSubmit = (e) => {
      e.preventDefault();
      
      if (!formData.naam.trim()) {
        alert('Vul een naam in');
        return;
      }
      
      if (!formData.autorisator) {
        alert('Selecteer een autorisator');
        return;
      }
      
      if (selectedRows.length === 0) {
        alert('Selecteer minimaal 1 vergrendelpunt');
        return;
      }
      
      const submitButton = e.target.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      submitButton.disabled = true;
      submitButton.textContent = 'Bezig met verzenden...';
      
      console.log('Submitting aanvraag:', {
        formData: formData,
        selectedRows: selectedRows,
        userName: userName,
        timestamp: new Date().toISOString()
      });
      
      google.script.run
        .withSuccessHandler((result) => {
          console.log('Aanvraag result:', result);
          
          if (result.success) {
            handleCloseModal();
            setSelectedRows([]);
            
            submitButton.disabled = false;
            submitButton.textContent = originalText;
            
            fetchAanvragen();
            
            setSuccessData({
              requestId: result.requestId,
              aanvraagNr: result.aanvraagNr,
              autorisatorEmail: formData.autorisator
            });
            setIsSuccessModalOpen(true);
          } else {
            alert(`‚úñ Fout bij het indienen van de aanvraag:\n\n${result.error}`);
            submitButton.disabled = false;
            submitButton.textContent = originalText;
          }
        })
        .withFailureHandler((error) => {
          console.error('Error submitting aanvraag:', error);
          alert(`‚úñ Er is een fout opgetreden:\n\n${error.message}`);
          
          submitButton.disabled = false;
          submitButton.textContent = originalText;
        })
        .submitAanvraag(formData, selectedRows, userName, username);
    };

    // ===== SUCCESS MODAL COMPONENT =====
    
    const SuccessModal = () => {
      if (!isSuccessModalOpen || !successData) return null;
      
      return (
        <div 
          className="success-modal-overlay"
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.5)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 999999,
            padding: '20px',
            animation: 'fadeIn 0.3s ease-out'
          }}
          onClick={() => setIsSuccessModalOpen(false)}
        >
          <div 
            className="success-modal-container"
            onClick={(e) => e.stopPropagation()}
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
              maxWidth: '500px',
              width: '100%',
              overflow: 'hidden'
            }}
          >
            <div style={{
              background: 'linear-gradient(135deg, #4caf50 0%, #2e7d32 100%)',
              padding: '30px 25px',
              position: 'relative',
              overflow: 'hidden'
            }}>
              <div style={{
                width: '80px',
                height: '80px',
                margin: '0 auto 20px',
                backgroundColor: 'white',
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                position: 'relative'
              }}>
                <div style={{
                  width: '35px',
                  height: '70px',
                  borderBottom: '8px solid #4caf50',
                  borderRight: '8px solid #4caf50',
                  transform: 'rotate(45deg)',
                  marginBottom: '15px',
                  marginLeft: '5px'
                }}></div>
              </div>

              <h2 style={{
                margin: 0,
                color: 'white',
                fontSize: '26px',
                fontWeight: '700',
                textAlign: 'center',
                textShadow: '0 2px 4px rgba(0,0,0,0.1)'
              }}>
                Aanvraag Succesvol!
              </h2>
            </div>

            <div style={{ padding: '30px 25px' }}>
              <div style={{
                backgroundColor: '#e8f5e9',
                border: '2px solid #4caf50',
                borderRadius: '8px',
                padding: '16px',
                marginBottom: '25px'
              }}>
                <p style={{
                  margin: '0 0 8px 0',
                  color: '#2e7d32',
                  fontSize: '15px',
                  fontWeight: '600',
                  lineHeight: '1.5'
                }}>
                  Aanvraag succesvol ingediend!
                </p>
                <p style={{
                  margin: 0,
                  color: '#558b2f',
                  fontSize: '13px',
                  lineHeight: '1.5'
                }}>
                  Je aanvraag is opgeslagen en wordt nu verwerkt.
                </p>
              </div>

              <div style={{
                marginBottom: '20px',
                padding: '16px',
                backgroundColor: '#f5f5f5',
                borderRadius: '8px',
                borderLeft: '4px solid #4caf50'
              }}>
                <div style={{
                  color: '#666',
                  fontSize: '12px',
                  fontWeight: '600',
                  textTransform: 'uppercase',
                  letterSpacing: '0.5px',
                  marginBottom: '6px'
                }}>
                  Aanvraag Nummer
                </div>
                <div style={{
                  color: '#333',
                  fontSize: '16px',
                  fontWeight: '700',
                  fontFamily: 'monospace',
                  letterSpacing: '0.5px',
                  wordBreak: 'break-all'
                }}>
                  {successData.aanvraagNr}
                </div>
                <div style={{
                  color: '#999',
                  fontSize: '11px',
                  marginTop: '4px',
                  fontFamily: 'monospace'
                }}>
                  {successData.requestId}
                </div>
              </div>

              {successData.emailSent !== undefined && (
                <div style={{
                  padding: '16px',
                  backgroundColor: successData.emailSent ? '#e3f2fd' : '#fff3e0',
                  borderRadius: '8px',
                  border: successData.emailSent ? '1px solid #90caf9' : '1px solid #ffb74d'
                }}>
                  <p style={{
                    margin: '0 0 4px 0',
                    color: successData.emailSent ? '#1565c0' : '#ef6c00',
                    fontSize: '14px',
                    fontWeight: '600',
                    lineHeight: '1.4'
                  }}>
                    {successData.emailSent ? '‚úÖ Email notificatie verzonden' : '‚ö†Ô∏è Email notificatie mislukt'}
                  </p>
                  <p style={{
                    margin: 0,
                    color: successData.emailSent ? '#1976d2' : '#f57c00',
                    fontSize: '12px',
                    lineHeight: '1.5'
                  }}>
                    {successData.emailSent
                      ? 'De autorisator ontvangt binnenkort een email om de aanvraag goed te keuren of af te wijzen.'
                      : (successData.emailMessage || 'Email kon niet worden verzonden, maar de aanvraag is wel opgeslagen.')}
                  </p>
                </div>
              )}
            </div>

            <div style={{
              padding: '20px 25px',
              backgroundColor: '#fafafa',
              borderTop: '1px solid #e0e0e0',
              display: 'flex',
              justifyContent: 'center'
            }}>
              <button
                onClick={() => setIsSuccessModalOpen(false)}
                style={{
                  padding: '12px 40px',
                  backgroundColor: '#4caf50',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  fontSize: '15px',
                  fontWeight: '700',
                  cursor: 'pointer',
                  transition: 'all 0.3s',
                  boxShadow: '0 4px 12px rgba(76, 175, 80, 0.3)',
                  textTransform: 'uppercase',
                  letterSpacing: '0.5px'
                }}
              >
                Begrepen
              </button>
            </div>
          </div>
        </div>
      );
    };

    // ===== ABOUT MODAL COMPONENT =====

    const AboutModal = () => {
      if (!isAboutModalOpen) {
        return null;
      }
      return (
        <div
          className="about-modal-overlay"
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.6)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 999999,
            padding: '20px',
            animation: 'fadeIn 0.3s ease-out'
          }}
          onClick={handleCloseAboutModal}
        >
          <div
            className="about-modal-container"
            onClick={(e) => e.stopPropagation()}
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
              maxWidth: '550px',
              width: '100%',
              overflow: 'hidden',
              animation: 'slideUp 0.4s ease-out'
            }}
          >
            {/* Header */}
            <div style={{
              background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
              padding: '30px 25px',
              position: 'relative',
              overflow: 'hidden'
            }}>
              <div style={{
                width: '80px',
                height: '80px',
                margin: '0 auto 20px',
                backgroundColor: 'white',
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '40px'
              }}>
                ‚ÑπÔ∏è
              </div>

              <h2 style={{
                margin: 0,
                color: 'white',
                fontSize: '28px',
                fontWeight: '700',
                textAlign: 'center',
                textShadow: '0 2px 4px rgba(0,0,0,0.1)'
              }}>
                Over deze applicatie
              </h2>
            </div>

            {/* Content */}
            <div style={{ padding: '30px 25px' }}>
              {/* App Info */}
              <div style={{
                marginBottom: '25px',
                textAlign: 'center'
              }}>
                <h3 style={{
                  margin: '0 0 10px 0',
                  color: '#333',
                  fontSize: '20px',
                  fontWeight: '600'
                }}>
                  Aanvragen Rimses
                </h3>
                <p style={{
                  margin: 0,
                  color: '#666',
                  fontSize: '14px',
                  lineHeight: '1.6'
                }}>
                  Webapplicatie voor het beheren van vergrendelpunten en aanvragen binnen installaties
                </p>
              </div>

              {/* Version Info */}
              <div style={{
                backgroundColor: '#f5f5f5',
                borderRadius: '8px',
                padding: '20px',
                marginBottom: '20px'
              }}>
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: '1fr 1fr',
                  gap: '16px'
                }}>
                  <div style={{
                    backgroundColor: 'white',
                    borderRadius: '6px',
                    padding: '14px',
                    borderLeft: '4px solid #667eea'
                  }}>
                    <div style={{
                      color: '#999',
                      fontSize: '11px',
                      fontWeight: '600',
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px',
                      marginBottom: '6px'
                    }}>
                      JavaScript
                    </div>
                    <div style={{
                      color: '#333',
                      fontSize: '14px',
                      fontWeight: '700',
                      fontFamily: 'monospace'
                    }}>
                      {version}
                    </div>
                  </div>

                  <div style={{
                    backgroundColor: 'white',
                    borderRadius: '6px',
                    padding: '14px',
                    borderLeft: '4px solid #764ba2'
                  }}>
                    <div style={{
                      color: '#999',
                      fontSize: '11px',
                      fontWeight: '600',
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px',
                      marginBottom: '6px'
                    }}>
                      Stylesheet
                    </div>
                    <div style={{
                      color: '#333',
                      fontSize: '14px',
                      fontWeight: '700',
                      fontFamily: 'monospace'
                    }}>
                      {stylesheetVersion}
                    </div>
                  </div>
                </div>
              </div>

              {/* Tech Stack */}
              <div style={{
                backgroundColor: '#e8f4f8',
                border: '1px solid #b3d9e8',
                borderRadius: '8px',
                padding: '16px',
                marginBottom: '20px'
              }}>
                <div style={{
                  color: '#2c5f7a',
                  fontSize: '12px',
                  fontWeight: '600',
                  textTransform: 'uppercase',
                  letterSpacing: '0.5px',
                  marginBottom: '10px'
                }}>
                  Tech Stack
                </div>
                <div style={{
                  display: 'flex',
                  flexWrap: 'wrap',
                  gap: '8px'
                }}>
                  {['React 18', 'Google Apps Script', 'Firebase', 'Babel Standalone'].map((tech, index) => (
                    <span key={index} style={{
                      backgroundColor: 'white',
                      color: '#2c5f7a',
                      padding: '6px 12px',
                      borderRadius: '16px',
                      fontSize: '12px',
                      fontWeight: '600',
                      border: '1px solid #b3d9e8'
                    }}>
                      {tech}
                    </span>
                  ))}
                </div>
              </div>

              {/* Features */}
              <div style={{
                backgroundColor: '#f0f4f8',
                borderRadius: '8px',
                padding: '16px'
              }}>
                <div style={{
                  color: '#555',
                  fontSize: '12px',
                  fontWeight: '600',
                  textTransform: 'uppercase',
                  letterSpacing: '0.5px',
                  marginBottom: '10px'
                }}>
                  Features
                </div>
                <ul style={{
                  margin: 0,
                  paddingLeft: '20px',
                  color: '#666',
                  fontSize: '13px',
                  lineHeight: '1.8'
                }}>
                  <li>4 dynamisch aanpasbare tabellen</li>
                  <li>Background prefetch voor snelle load</li>
                  <li>Real-time data synchronisatie</li>
                  <li>In-memory filtering</li>
                  <li>Centrale layout slider</li>
                </ul>
              </div>
            </div>

            {/* Footer */}
            <div style={{
              padding: '20px 25px',
              backgroundColor: '#fafafa',
              borderTop: '1px solid #e0e0e0',
              display: 'flex',
              justifyContent: 'center'
            }}>
              <button
                onClick={handleCloseAboutModal}
                style={{
                  padding: '12px 40px',
                  background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  fontSize: '15px',
                  fontWeight: '700',
                  cursor: 'pointer',
                  transition: 'all 0.3s',
                  boxShadow: '0 4px 12px rgba(102, 126, 234, 0.3)',
                  textTransform: 'uppercase',
                  letterSpacing: '0.5px'
                }}
              >
                Sluiten
              </button>
            </div>
          </div>
        </div>
      );
    };

    // ===== DECISION RESULT MODAL COMPONENT =====

    const DecisionResultModal = () => {
      if (!isDecisionResultModalOpen || !decisionResult) return null;

      const isApproved = decisionResult.type === 'Approved';
      const isSuccess = decisionResult.success;

      const gradient = isSuccess
        ? (isApproved
            ? 'linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%)' // Green for approved
            : 'linear-gradient(135deg, #f44336 0%, #c62828 100%)') // Red for rejected
        : 'linear-gradient(135deg, #ff9800 0%, #f57c00 100%)'; // Orange for error

      const icon = isSuccess
        ? (isApproved ? '‚úì' : '‚úï')
        : '‚ö†';

      const title = isSuccess
        ? (isApproved ? 'Aanvraag Goedgekeurd' : 'Aanvraag Afgekeurd')
        : 'Fout bij Verwerken';

      const message = isSuccess
        ? (isApproved
            ? 'De aanvraag is succesvol goedgekeurd.'
            : 'De aanvraag is succesvol afgekeurd.')
        : `Fout bij verwerken beslissing: ${decisionResult.message || 'Onbekende fout'}`;

      return (
        <div
          className="decision-result-modal-overlay"
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.7)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 999999,
            padding: '20px',
            animation: 'fadeIn 0.3s ease-out'
          }}
          onClick={() => {
            setIsDecisionResultModalOpen(false);
            setDecisionResult(null);
          }}
        >
          <div
            className="decision-result-modal-container"
            onClick={(e) => e.stopPropagation()}
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              maxWidth: '500px',
              width: '100%',
              boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
              overflow: 'hidden',
              animation: 'slideDown 0.3s ease-out'
            }}
          >
            {/* Header */}
            <div style={{
              background: gradient,
              padding: '30px',
              textAlign: 'center',
              color: 'white'
            }}>
              <div style={{
                fontSize: '64px',
                marginBottom: '15px',
                fontWeight: 'bold'
              }}>
                {icon}
              </div>
              <h2 style={{
                margin: 0,
                fontSize: '24px',
                fontWeight: '700'
              }}>
                {title}
              </h2>
            </div>

            {/* Content */}
            <div style={{ padding: '30px', textAlign: 'center' }}>
              <p style={{
                fontSize: '16px',
                color: '#333',
                marginBottom: '25px',
                lineHeight: '1.6'
              }}>
                {message}
              </p>

              <button
                onClick={() => {
                  setIsDecisionResultModalOpen(false);
                  setDecisionResult(null);
                }}
                style={{
                  padding: '12px 30px',
                  backgroundColor: isSuccess
                    ? (isApproved ? '#4CAF50' : '#f44336')
                    : '#ff9800',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  fontSize: '16px',
                  fontWeight: '600',
                  cursor: 'pointer',
                  transition: 'all 0.2s',
                  minWidth: '120px'
                }}
                onMouseEnter={(e) => {
                  e.target.style.opacity = '0.9';
                  e.target.style.transform = 'translateY(-1px)';
                  e.target.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
                }}
                onMouseLeave={(e) => {
                  e.target.style.opacity = '1';
                  e.target.style.transform = 'translateY(0)';
                  e.target.style.boxShadow = 'none';
                }}
              >
                Sluiten
              </button>
            </div>
          </div>
        </div>
      );
    };

    // ===== EMPTY PASSWORD MODAL COMPONENT =====

    const EmptyPasswordModal = () => {
      if (!isEmptyPasswordModalOpen) return null;

      return (
        <div
          className="empty-password-modal-overlay"
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.7)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 1000,
            padding: '20px',
            animation: 'fadeIn 0.3s ease-out'
          }}
          onClick={() => setIsEmptyPasswordModalOpen(false)}
        >
          <div
            className="empty-password-modal-container"
            onClick={(e) => e.stopPropagation()}
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              maxWidth: '500px',
              width: '100%',
              boxShadow: '0 10px 40px rgba(0, 0, 0, 0.3)',
              overflow: 'hidden',
              animation: 'slideDown 0.3s ease-out'
            }}
          >
            {/* Header - Purple/Success gradient for first login */}
            <div style={{
              background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
              padding: '25px',
              textAlign: 'center',
              color: 'white'
            }}>
              <div style={{
                fontSize: '48px',
                marginBottom: '10px',
                animation: 'bounce 1s ease-in-out'
              }}>
                üîê
              </div>
              <h2 style={{
                margin: 0,
                fontSize: '24px',
                fontWeight: '700'
              }}>
                Eerste Login
              </h2>
            </div>

            {/* Content */}
            <div style={{ padding: '30px' }}>
              <p style={{
                fontSize: '16px',
                lineHeight: '1.6',
                color: '#333',
                marginBottom: '20px',
                textAlign: 'center'
              }}>
                Dit is uw eerste login! We hebben automatisch een wachtwoord voor u aangemaakt en gemaild naar <strong>{username}</strong>.
              </p>
              <p style={{
                fontSize: '15px',
                lineHeight: '1.6',
                color: '#666',
                marginBottom: '25px',
                textAlign: 'center'
              }}>
                Check uw email om uw wachtwoord te zien en log opnieuw in.
              </p>

              {/* Button */}
              <div style={{
                display: 'flex',
                justifyContent: 'center',
                marginTop: '25px'
              }}>
                <button
                  onClick={() => setIsEmptyPasswordModalOpen(false)}
                  style={{
                    padding: '12px 40px',
                    backgroundColor: '#667eea',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '15px',
                    fontWeight: '700',
                    cursor: 'pointer',
                    transition: 'all 0.3s',
                    boxShadow: '0 4px 12px rgba(102, 126, 234, 0.3)',
                    textTransform: 'uppercase',
                    letterSpacing: '0.5px'
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.backgroundColor = '#5568d3';
                    e.target.style.transform = 'translateY(-2px)';
                    e.target.style.boxShadow = '0 6px 16px rgba(102, 126, 234, 0.4)';
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.backgroundColor = '#667eea';
                    e.target.style.transform = 'translateY(0)';
                    e.target.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.3)';
                  }}
                >
                  Begrepen
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // ===== EDIT USER MODAL COMPONENT =====

    const EditUserModal = () => {
      if (!isEditUserModalOpen || !editingUser) return null;

      const [formData, setFormData] = React.useState({
        email: editingUser.USER_NAME || '',
        role: editingUser.ROLE || 'A',
        departement: editingUser.DEPARTEMENT || '',
        titel: editingUser.TITEL || '',
        active: editingUser.ACTIVE || 0,
        password: '' // Laat leeg om huidige wachtwoord te behouden
      });

      const handleInputChange = (field, value) => {
        setFormData(prev => ({
          ...prev,
          [field]: value
        }));
      };

      const handleSubmit = () => {
        // Validatie
        if (!formData.email || !formData.email.includes('@')) {
          setUserModalMessage('Voer een geldig email adres in');
          setIsUserErrorModalOpen(true);
          return;
        }

        // Prepare update data
        const updateData = {
          firebaseKey: editingUser.firebaseKey, // Original key
          newEmail: formData.email !== editingUser.USER_NAME ? formData.email : null,
          ROLE: formData.role,
          DEPARTEMENT: formData.departement,
          TITEL: formData.titel,
          ACTIVE: formData.active,
          USER_NAME: formData.email
        };

        // Only include password if it's been changed
        if (formData.password && formData.password.trim() !== '') {
          updateData.PASSWORD = formData.password;
        }

        handleUpdateUser(updateData);
      };

      return (
        <div
          className="edit-user-modal-overlay"
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.6)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 999999,
            padding: '20px',
            animation: 'fadeIn 0.3s ease-out'
          }}
          onClick={handleCloseEditUserModal}
        >
          <div
            className="edit-user-modal-container"
            onClick={(e) => e.stopPropagation()}
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
              maxWidth: '600px',
              width: '100%',
              maxHeight: '90vh',
              overflow: 'auto',
              animation: 'slideUp 0.4s ease-out'
            }}
          >
            {/* Header */}
            <div style={{
              background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
              padding: '30px 25px',
              position: 'relative'
            }}>
              <h2 style={{
                margin: 0,
                color: 'white',
                fontSize: '24px',
                fontWeight: '700',
                textAlign: 'center'
              }}>
                Gebruiker Bewerken
              </h2>
            </div>

            {/* Form Content */}
            <div style={{ padding: '30px 25px' }}>
              {/* Email */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Email *
                </label>
                <input
                  type="email"
                  value={formData.email}
                  onChange={(e) => handleInputChange('email', e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                  placeholder="gebruiker@example.com"
                />
              </div>

              {/* Rol */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Rol *
                </label>
                <select
                  value={formData.role}
                  onChange={(e) => handleInputChange('role', e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                >
                  <option value="A">Gebruiker (A)</option>
                  <option value="B">Autorisator (B)</option>
                  <option value="C">Administrator (C)</option>
                  <option value="T">Technisch Beheerder (T)</option>
                  {/* Role D (Super User) is only visible if the user being edited already has role D */}
                  {/* This prevents admins from promoting users to Super User role */}
                  {/* Only database admins can assign role D manually */}
                  {editingUser.ROLE === 'D' && (
                    <option value="D">Super User (D) - Alleen Database</option>
                  )}
                </select>
              </div>

              {/* Departement */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Departement
                </label>
                <input
                  type="text"
                  value={formData.departement}
                  onChange={(e) => handleInputChange('departement', e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                  placeholder="bijv. REL"
                />
              </div>

              {/* Titel */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Titel
                </label>
                <input
                  type="text"
                  value={formData.titel}
                  onChange={(e) => handleInputChange('titel', e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                  placeholder="bijv. CMMS"
                />
              </div>

              {/* Actief */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Status
                </label>
                <select
                  value={formData.active}
                  onChange={(e) => handleInputChange('active', parseInt(e.target.value))}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                >
                  <option value={1}>Actief</option>
                  <option value={0}>Inactief</option>
                </select>
              </div>

              {/* Wachtwoord */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Nieuw Wachtwoord (optioneel)
                </label>
                <input
                  type="text"
                  value={formData.password}
                  onChange={(e) => handleInputChange('password', e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                  placeholder="Laat leeg om huidige wachtwoord te behouden"
                />
                <small style={{ color: '#666', fontSize: '12px' }}>
                  Laat dit veld leeg als u het wachtwoord niet wilt wijzigen
                </small>
              </div>

              {/* Buttons */}
              <div style={{
                display: 'flex',
                gap: '10px',
                marginTop: '30px'
              }}>
                <button
                  onClick={handleCloseEditUserModal}
                  style={{
                    flex: 1,
                    padding: '12px 24px',
                    backgroundColor: '#f5f5f5',
                    color: '#333',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                >
                  Annuleren
                </button>
                <button
                  onClick={handleOpenDeleteUserModal}
                  style={{
                    flex: 1,
                    padding: '12px 24px',
                    background: 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                >
                  Verwijderen
                </button>
                <button
                  onClick={handleSubmit}
                  style={{
                    flex: 1,
                    padding: '12px 24px',
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                >
                  Opslaan
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // ===== ADD USER MODAL COMPONENT =====

    const AddUserModal = () => {
      const [formData, setFormData] = React.useState({
        email: '',
        role: 'A',
        departement: '',
        titel: '',
        active: 1,
        password: ''
      });

      const handleInputChange = (field, value) => {
        setFormData(prev => ({
          ...prev,
          [field]: value
        }));
      };

      const handleSubmit = () => {
        // Validatie
        if (!formData.email || !formData.email.includes('@')) {
          setUserModalMessage('Vul een geldig email adres in');
          setIsUserErrorModalOpen(true);
          return;
        }

        if (!formData.password || formData.password.trim() === '') {
          setUserModalMessage('Wachtwoord is verplicht');
          setIsUserErrorModalOpen(true);
          return;
        }

        // Prepare data voor backend
        const newUserData = {
          email: formData.email,
          ROLE: formData.role,
          DEPARTEMENT: formData.departement,
          TITEL: formData.titel,
          ACTIVE: formData.active,
          USER_NAME: formData.email,
          PASSWORD: formData.password
        };

        handleCreateUser(newUserData);
      };

      if (!isAddUserModalOpen) return null;

      return (
        <div
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.6)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 999999,
            animation: 'fadeIn 0.3s ease-out'
          }}
          onClick={handleCloseAddUserModal}
        >
          <div
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              width: '500px',
              maxWidth: '90%',
              maxHeight: '90vh',
              overflow: 'hidden',
              boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)'
            }}
            onClick={(e) => e.stopPropagation()}
          >
            {/* Header */}
            <div style={{
              background: 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)',
              padding: '25px',
              color: 'white'
            }}>
              <h2 style={{
                margin: '0 0 8px 0',
                fontSize: '24px',
                fontWeight: '700'
              }}>
                Nieuwe Gebruiker
              </h2>
              <p style={{
                margin: 0,
                fontSize: '14px',
                opacity: 0.95
              }}>
                Vul de gegevens in voor de nieuwe gebruiker
              </p>
            </div>

            {/* Content */}
            <div style={{
              padding: '25px',
              maxHeight: 'calc(90vh - 200px)',
              overflowY: 'auto'
            }}>
              {/* Email */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Email (verplicht)
                </label>
                <input
                  type="email"
                  value={formData.email}
                  onChange={(e) => handleInputChange('email', e.target.value)}
                  placeholder="gebruiker@example.com"
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                />
              </div>

              {/* Rol */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Rol
                </label>
                <select
                  value={formData.role}
                  onChange={(e) => handleInputChange('role', e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                >
                  <option value="A">A - Gebruiker</option>
                  <option value="B">B - Autorisator</option>
                  <option value="C">C - Admin</option>
                  <option value="T">T - Technisch Beheerder</option>
                  {/* Role D (Super User) is not available in Add User form for security reasons */}
                  {/* Super User role must be assigned manually in the database */}
                </select>
              </div>

              {/* Departement */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Departement
                </label>
                <input
                  type="text"
                  value={formData.departement}
                  onChange={(e) => handleInputChange('departement', e.target.value)}
                  placeholder="bijv. REL"
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                />
              </div>

              {/* Titel */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Titel
                </label>
                <input
                  type="text"
                  value={formData.titel}
                  onChange={(e) => handleInputChange('titel', e.target.value)}
                  placeholder="bijv. CMMS"
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                />
              </div>

              {/* Actief */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Actief
                </label>
                <select
                  value={formData.active}
                  onChange={(e) => handleInputChange('active', parseInt(e.target.value))}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                >
                  <option value="1">Ja</option>
                  <option value="0">Nee</option>
                </select>
              </div>

              {/* Wachtwoord */}
              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  color: '#333',
                  fontSize: '14px',
                  fontWeight: '600'
                }}>
                  Wachtwoord (verplicht)
                </label>
                <input
                  type="text"
                  value={formData.password}
                  onChange={(e) => handleInputChange('password', e.target.value)}
                  placeholder="Voer wachtwoord in"
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    boxSizing: 'border-box'
                  }}
                />
              </div>

              {/* Buttons */}
              <div style={{
                display: 'flex',
                gap: '10px',
                marginTop: '30px'
              }}>
                <button
                  onClick={handleCloseAddUserModal}
                  style={{
                    flex: 1,
                    padding: '12px 24px',
                    backgroundColor: '#f5f5f5',
                    color: '#333',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                >
                  Annuleren
                </button>
                <button
                  onClick={handleSubmit}
                  style={{
                    flex: 1,
                    padding: '12px 24px',
                    background: 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                >
                  Toevoegen
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // ===== USER SUCCESS MODAL COMPONENT =====

    const UserSuccessModal = () => {
      if (!isUserSuccessModalOpen) return null;

      return (
        <div
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.6)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 999999,
            animation: 'fadeIn 0.3s ease-out'
          }}
          onClick={() => setIsUserSuccessModalOpen(false)}
        >
          <div
            onClick={(e) => e.stopPropagation()}
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
              maxWidth: '500px',
              width: '100%',
              overflow: 'hidden',
              animation: 'slideUp 0.4s ease-out'
            }}
          >
            {/* Header */}
            <div style={{
              background: 'linear-gradient(135deg, #4caf50 0%, #45a049 100%)',
              padding: '30px 25px',
              textAlign: 'center'
            }}>
              <div style={{
                width: '60px',
                height: '60px',
                margin: '0 auto 15px',
                backgroundColor: 'white',
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '30px'
              }}>
                ‚úì
              </div>
              <h2 style={{
                margin: 0,
                color: 'white',
                fontSize: '24px',
                fontWeight: '700'
              }}>
                Succes!
              </h2>
            </div>

            {/* Content */}
            <div style={{ padding: '30px 25px', textAlign: 'center' }}>
              <p style={{
                fontSize: '16px',
                lineHeight: '1.6',
                color: '#333',
                margin: 0
              }}>
                {userModalMessage}
              </p>

              {/* Button */}
              <button
                onClick={() => setIsUserSuccessModalOpen(false)}
                style={{
                  marginTop: '25px',
                  padding: '12px 40px',
                  background: 'linear-gradient(135deg, #4caf50 0%, #45a049 100%)',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  fontSize: '15px',
                  fontWeight: '600',
                  cursor: 'pointer',
                  transition: 'all 0.2s'
                }}
              >
                OK
              </button>
            </div>
          </div>
        </div>
      );
    };

    // ===== USER ERROR MODAL COMPONENT =====

    const UserErrorModal = () => {
      if (!isUserErrorModalOpen) return null;

      return (
        <div
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.6)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 999999,
            animation: 'fadeIn 0.3s ease-out'
          }}
          onClick={() => setIsUserErrorModalOpen(false)}
        >
          <div
            onClick={(e) => e.stopPropagation()}
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
              maxWidth: '500px',
              width: '100%',
              overflow: 'hidden',
              animation: 'slideUp 0.4s ease-out'
            }}
          >
            {/* Header */}
            <div style={{
              background: 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)',
              padding: '30px 25px',
              textAlign: 'center'
            }}>
              <div style={{
                width: '60px',
                height: '60px',
                margin: '0 auto 15px',
                backgroundColor: 'white',
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '30px',
                color: '#f44336'
              }}>
                ‚ö†
              </div>
              <h2 style={{
                margin: 0,
                color: 'white',
                fontSize: '24px',
                fontWeight: '700'
              }}>
                Fout
              </h2>
            </div>

            {/* Content */}
            <div style={{ padding: '30px 25px', textAlign: 'center' }}>
              <p style={{
                fontSize: '16px',
                lineHeight: '1.6',
                color: '#333',
                margin: 0
              }}>
                {userModalMessage}
              </p>

              {/* Button */}
              <button
                onClick={() => setIsUserErrorModalOpen(false)}
                style={{
                  marginTop: '25px',
                  padding: '12px 40px',
                  background: 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  fontSize: '15px',
                  fontWeight: '600',
                  cursor: 'pointer',
                  transition: 'all 0.2s'
                }}
              >
                OK
              </button>
            </div>
          </div>
        </div>
      );
    };

    // ===== DELETE USER CONFIRMATION MODAL =====

    const DeleteUserConfirmationModal = () => {
      if (!isDeleteUserModalOpen || !editingUser) return null;

      return (
        <div
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.6)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 9999999,
            animation: 'fadeIn 0.3s ease-out'
          }}
          onClick={handleCloseDeleteUserModal}
        >
          <div
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              width: '500px',
              maxWidth: '90%',
              boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
              overflow: 'hidden'
            }}
            onClick={(e) => e.stopPropagation()}
          >
            {/* Header */}
            <div style={{
              background: 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)',
              padding: '25px',
              color: 'white'
            }}>
              <h2 style={{
                margin: '0 0 8px 0',
                fontSize: '24px',
                fontWeight: '700'
              }}>
                Gebruiker Verwijderen
              </h2>
              <p style={{
                margin: 0,
                fontSize: '14px',
                opacity: 0.95
              }}>
                Deze actie kan niet ongedaan gemaakt worden
              </p>
            </div>

            {/* Content */}
            <div style={{ padding: '30px 25px' }}>
              <div style={{
                backgroundColor: '#fff3cd',
                border: '1px solid #ffc107',
                borderRadius: '8px',
                padding: '15px',
                marginBottom: '20px'
              }}>
                <p style={{
                  fontSize: '14px',
                  color: '#856404',
                  margin: 0,
                  lineHeight: '1.6'
                }}>
                  <strong>Let op:</strong> U staat op het punt gebruiker <strong>{editingUser.USER_NAME}</strong> permanent te verwijderen uit het systeem.
                </p>
              </div>

              <p style={{
                fontSize: '15px',
                lineHeight: '1.6',
                color: '#333',
                margin: '0 0 25px 0'
              }}>
                Weet u zeker dat u deze gebruiker wilt verwijderen? Deze actie kan niet ongedaan gemaakt worden.
              </p>

              {/* Buttons */}
              <div style={{
                display: 'flex',
                gap: '10px'
              }}>
                <button
                  onClick={handleCloseDeleteUserModal}
                  disabled={isDeletingUser}
                  style={{
                    flex: 1,
                    padding: '12px 24px',
                    backgroundColor: '#f5f5f5',
                    color: '#333',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: isDeletingUser ? 'not-allowed' : 'pointer',
                    opacity: isDeletingUser ? 0.6 : 1,
                    transition: 'all 0.2s'
                  }}
                >
                  Annuleren
                </button>
                <button
                  onClick={handleDeleteUser}
                  disabled={isDeletingUser}
                  style={{
                    flex: 1,
                    padding: '12px 24px',
                    background: isDeletingUser
                      ? '#ccc'
                      : 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: isDeletingUser ? 'not-allowed' : 'pointer',
                    transition: 'all 0.2s'
                  }}
                >
                  {isDeletingUser ? 'Verwijderen...' : 'Ja, Verwijderen'}
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // ===== DRAGGABLE MODAL COMPONENT =====

    const DraggableTestModal = () => {
      const [position, setPosition] = React.useState({ x: 100, y: 100 });
      const [isDragging, setIsDragging] = React.useState(false);
      const [dragOffset, setDragOffset] = React.useState({ x: 0, y: 0 });

      const handleMouseDown = (e) => {
        // Only start dragging if clicking on the header
        if (e.target.closest('.draggable-header')) {
          setIsDragging(true);
          setDragOffset({
            x: e.clientX - position.x,
            y: e.clientY - position.y
          });
        }
      };

      const handleMouseMove = React.useCallback((e) => {
        if (isDragging) {
          setPosition({
            x: e.clientX - dragOffset.x,
            y: e.clientY - dragOffset.y
          });
        }
      }, [isDragging, dragOffset]);

      const handleMouseUp = () => {
        setIsDragging(false);
      };

      React.useEffect(() => {
        if (isDragging) {
          window.addEventListener('mousemove', handleMouseMove);
          window.addEventListener('mouseup', handleMouseUp);
          return () => {
            window.removeEventListener('mousemove', handleMouseMove);
            window.removeEventListener('mouseup', handleMouseUp);
          };
        }
      }, [isDragging, handleMouseMove]);

      if (!isDraggableTestOpen) return null;

      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundColor: 'rgba(0, 0, 0, 0.3)',
          zIndex: 999998,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center'
        }}
        onClick={() => setIsDraggableTestOpen(false)}
        >
          <div
            style={{
              position: 'fixed',
              left: `${position.x}px`,
              top: `${position.y}px`,
              width: '600px',
              backgroundColor: 'white',
              borderRadius: '12px',
              boxShadow: isDragging ? '0 20px 60px rgba(0, 0, 0, 0.5)' : '0 10px 40px rgba(0, 0, 0, 0.3)',
              overflow: 'hidden',
              cursor: isDragging ? 'grabbing' : 'default',
              transition: isDragging ? 'none' : 'box-shadow 0.3s'
            }}
            onClick={(e) => e.stopPropagation()}
            onMouseDown={handleMouseDown}
          >
            {/* Draggable Header */}
            <div
              className="draggable-header"
              style={{
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                padding: '20px 25px',
                cursor: isDragging ? 'grabbing' : 'grab',
                userSelect: 'none'
              }}
            >
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <div>
                  <h2 style={{
                    margin: '0 0 5px 0',
                    fontSize: '20px',
                    fontWeight: '700',
                    color: 'white'
                  }}>
                    Draggable Modal Test
                  </h2>
                  <p style={{
                    margin: 0,
                    fontSize: '13px',
                    color: 'rgba(255, 255, 255, 0.9)'
                  }}>
                    Sleep dit venster door de header te verslepen
                  </p>
                </div>
                <button
                  onClick={() => setIsDraggableTestOpen(false)}
                  style={{
                    width: '35px',
                    height: '35px',
                    backgroundColor: 'rgba(255, 255, 255, 0.2)',
                    color: 'white',
                    border: 'none',
                    borderRadius: '50%',
                    fontSize: '20px',
                    fontWeight: '700',
                    cursor: 'pointer',
                    transition: 'all 0.2s',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}
                >
                  ‚úï
                </button>
              </div>
            </div>

            {/* Content */}
            <div style={{
              padding: '25px',
              maxHeight: '500px',
              overflowY: 'auto'
            }}>
              <div style={{
                marginBottom: '20px',
                padding: '15px',
                backgroundColor: '#f0f4ff',
                borderRadius: '8px',
                border: '2px solid #667eea'
              }}>
                <h3 style={{
                  margin: '0 0 10px 0',
                  color: '#1a237e',
                  fontSize: '16px'
                }}>
                  Hoe werkt het?
                </h3>
                <ul style={{
                  margin: '0',
                  paddingLeft: '20px',
                  color: '#333',
                  fontSize: '14px',
                  lineHeight: '1.6'
                }}>
                  <li>Klik en sleep op de paarse header bovenaan om het venster te verplaatsen</li>
                  <li>Het venster blijft binnen het scherm terwijl u sleept</li>
                  <li>De cursor verandert naar een "grab" icoon als u over de header beweegt</li>
                  <li>Klik op de ‚úï knop of buiten het venster om te sluiten</li>
                </ul>
              </div>

              <div style={{
                padding: '15px',
                backgroundColor: '#f9f9f9',
                borderRadius: '8px',
                border: '1px solid #e0e0e0'
              }}>
                <h3 style={{
                  margin: '0 0 10px 0',
                  color: '#1a237e',
                  fontSize: '16px'
                }}>
                  Huidige Positie
                </h3>
                <div style={{
                  fontSize: '14px',
                  color: '#333',
                  fontFamily: 'monospace'
                }}>
                  <div>X: {Math.round(position.x)}px</div>
                  <div>Y: {Math.round(position.y)}px</div>
                  <div>Status: {isDragging ? 'Aan het slepen...' : 'Klaar'}</div>
                </div>
              </div>

              <div style={{
                marginTop: '20px',
                padding: '15px',
                backgroundColor: '#fff3cd',
                borderRadius: '8px',
                border: '1px solid #ffc107'
              }}>
                <p style={{
                  margin: 0,
                  fontSize: '13px',
                  color: '#856404'
                }}>
                  <strong>Opmerking:</strong> Deze functionaliteit kan toegepast worden op detail modals
                  voor aanvragen om ze vrij te kunnen verplaatsen op het scherm.
                </p>
              </div>
            </div>

            {/* Footer */}
            <div style={{
              padding: '15px 25px',
              backgroundColor: '#f9f9f9',
              borderTop: '1px solid #e0e0e0',
              display: 'flex',
              justifyContent: 'flex-end'
            }}>
              <button
                onClick={() => setIsDraggableTestOpen(false)}
                style={{
                  padding: '10px 30px',
                  backgroundColor: '#667eea',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  fontSize: '14px',
                  fontWeight: '600',
                  cursor: 'pointer',
                  transition: 'all 0.3s'
                }}
              >
                Sluiten
              </button>
            </div>
          </div>
        </div>
      );
    };

    // ===== DEBUG PANEL COMPONENT =====

    const DebugPanel = () => {
      if (!isDebugPanelOpen) return null;

      const browserInfo = navigator.userAgent.split(' ').slice(-2).join(' ');

      return (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundColor: 'rgba(0, 0, 0, 0.7)',
          zIndex: 999999,
          padding: '20px',
          overflow: 'auto',
          animation: 'fadeIn 0.3s ease-out'
        }}
        onClick={handleToggleDebugPanel}
        >
          <div style={{
            maxWidth: '1400px',
            margin: '0 auto',
            backgroundColor: 'white',
            borderRadius: '12px',
            padding: '30px',
            boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)'
          }}
          onClick={(e) => e.stopPropagation()}
          >
            {/* Header */}
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '30px',
              paddingBottom: '20px',
              borderBottom: '3px solid #667eea'
            }}>
              <div>
                <h1 style={{ margin: '0 0 10px 0', color: '#1a237e', fontSize: '32px' }}>
                  üîß Debug & Test Panel
                </h1>
                <p style={{ margin: 0, color: '#666', fontSize: '14px' }}>
                  Test functionaliteit en bekijk system informatie
                </p>
              </div>
              <button
                onClick={handleToggleDebugPanel}
                style={{
                  padding: '10px 20px',
                  backgroundColor: '#f44336',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  fontSize: '16px',
                  fontWeight: '600',
                  cursor: 'pointer',
                  transition: 'all 0.3s'
                }}
              >
                ‚úï Sluiten
              </button>
            </div>

            {/* 4-panel grid */}
            <div style={{
              display: 'grid',
              gridTemplateColumns: '1fr 1fr',
              gridTemplateRows: 'auto auto',
              gap: '20px',
              minHeight: '600px'
            }}>
              {/* Panel 1: Version Info */}
              <div style={{
                backgroundColor: '#f5f5f5',
                borderRadius: '12px',
                padding: '25px',
                border: '2px solid #e0e0e0'
              }}>
                <div style={{
                  fontSize: '18px',
                  fontWeight: '700',
                  color: '#1a237e',
                  marginBottom: '20px',
                  paddingBottom: '15px',
                  borderBottom: '2px solid #e0e0e0'
                }}>
                  ‚ÑπÔ∏è Versie Informatie
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', marginBottom: '20px' }}>
                  <div style={{
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    padding: '20px',
                    borderRadius: '8px',
                    color: 'white'
                  }}>
                    <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '8px' }}>JavaScript</div>
                    <div style={{ fontSize: '16px', fontWeight: '700', fontFamily: 'monospace' }}>{version}</div>
                  </div>
                  <div style={{
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    padding: '20px',
                    borderRadius: '8px',
                    color: 'white'
                  }}>
                    <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '8px' }}>Stylesheet</div>
                    <div style={{ fontSize: '16px', fontWeight: '700', fontFamily: 'monospace' }}>{stylesheetVersion}</div>
                  </div>
                </div>

                <div style={{ backgroundColor: 'white', padding: '15px', borderRadius: '8px' }}>
                  <h4 style={{ color: '#333', marginBottom: '10px', fontSize: '14px' }}>System Info</h4>
                  <div style={{ fontSize: '13px', color: '#666', lineHeight: '2' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                      <strong>Browser:</strong>
                      <span>{browserInfo}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                      <strong>Platform:</strong>
                      <span>{navigator.platform}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                      <strong>Screen:</strong>
                      <span>{window.screen.width} x {window.screen.height}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '8px 0' }}>
                      <strong>Viewport:</strong>
                      <span>{window.innerWidth} x {window.innerHeight}</span>
                    </div>
                  </div>
                </div>
              </div>

              {/* Panel 2: State Info */}
              <div style={{
                backgroundColor: '#f5f5f5',
                borderRadius: '12px',
                padding: '25px',
                border: '2px solid #e0e0e0'
              }}>
                <div style={{
                  fontSize: '18px',
                  fontWeight: '700',
                  color: '#1a237e',
                  marginBottom: '20px',
                  paddingBottom: '15px',
                  borderBottom: '2px solid #e0e0e0'
                }}>
                  üéÆ Application State
                </div>

                <div style={{ backgroundColor: 'white', padding: '15px', borderRadius: '8px', fontSize: '13px' }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                    <strong>Logged In:</strong>
                    <span style={{ color: isLoggedIn ? '#4caf50' : '#f44336' }}>
                      {isLoggedIn ? '‚úÖ Yes' : '‚ùå No'}
                    </span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                    <strong>User Name:</strong>
                    <span>{userName || 'N/A'}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                    <strong>Table Data Rows:</strong>
                    <span>{(tableData.data && tableData.data.length) || 0}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                    <strong>Filtered Rows:</strong>
                    <span>{(filteredTableData && filteredTableData.length) || 0}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                    <strong>Selected Rows:</strong>
                    <span>{(selectedRows && selectedRows.length) || 0}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                    <strong>Aanvragen:</strong>
                    <span>{(aanvragen && aanvragen.length) || 0}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                    <strong>Current Page:</strong>
                    <span>{currentPage} / {totalPages}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                    <strong>Active Filters:</strong>
                    <span>
                      {Object.values(filters).filter(f => f).length}
                    </span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #e0e0e0', padding: '8px 0' }}>
                    <strong>About Modal:</strong>
                    <span style={{ color: isAboutModalOpen ? '#4caf50' : '#666' }}>
                      {isAboutModalOpen ? 'Open' : 'Closed'}
                    </span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', padding: '8px 0' }}>
                    <strong>Sidebar Collapsed:</strong>
                    <span style={{ color: isSidebarCollapsed ? '#f44336' : '#4caf50' }}>
                      {isSidebarCollapsed ? 'Yes' : 'No'}
                    </span>
                  </div>
                </div>

                <button
                  onClick={handleOpenAboutModal}
                  style={{
                    marginTop: '15px',
                    width: '100%',
                    padding: '12px',
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '14px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  üß™ Test About Modal
                </button>
              </div>

              {/* Panel 3: Filters & Layout */}
              <div style={{
                backgroundColor: '#f5f5f5',
                borderRadius: '12px',
                padding: '25px',
                border: '2px solid #e0e0e0'
              }}>
                <div style={{
                  fontSize: '18px',
                  fontWeight: '700',
                  color: '#1a237e',
                  marginBottom: '20px',
                  paddingBottom: '15px',
                  borderBottom: '2px solid #e0e0e0'
                }}>
                  üé® Filters & Layout
                </div>

                <div style={{ backgroundColor: 'white', padding: '15px', borderRadius: '8px', marginBottom: '15px' }}>
                  <h4 style={{ margin: '0 0 10px 0', fontSize: '14px' }}>Active Filters:</h4>
                  <div style={{ fontSize: '12px', color: '#666' }}>
                    {Object.entries(filters).map(([key, value]) => (
                      <div key={key} style={{ padding: '4px 0', display: 'flex', justifyContent: 'space-between' }}>
                        <strong style={{ textTransform: 'capitalize' }}>{key}:</strong>
                        <span style={{ fontFamily: 'monospace', color: value ? '#4caf50' : '#999' }}>
                          {value || '(empty)'}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>

                <div style={{ backgroundColor: 'white', padding: '15px', borderRadius: '8px' }}>
                  <h4 style={{ margin: '0 0 10px 0', fontSize: '14px' }}>Layout:</h4>
                  <div style={{ fontSize: '12px', color: '#666' }}>
                    <div style={{ padding: '4px 0', display: 'flex', justifyContent: 'space-between' }}>
                      <strong>Column Split:</strong>
                      <span style={{ fontFamily: 'monospace' }}>{columnSplit}%</span>
                    </div>
                    <div style={{ padding: '4px 0', display: 'flex', justifyContent: 'space-between' }}>
                      <strong>Row Split:</strong>
                      <span style={{ fontFamily: 'monospace' }}>{rowSplit}%</span>
                    </div>
                  </div>
                </div>
              </div>

              {/* Panel 4: Quick Actions */}
              <div style={{
                backgroundColor: '#f5f5f5',
                borderRadius: '12px',
                padding: '25px',
                border: '2px solid #e0e0e0'
              }}>
                <div style={{
                  fontSize: '18px',
                  fontWeight: '700',
                  color: '#1a237e',
                  marginBottom: '20px',
                  paddingBottom: '15px',
                  borderBottom: '2px solid #e0e0e0'
                }}>
                  ‚ö° Quick Actions
                </div>

                <div style={{ display: 'grid', gap: '10px' }}>
                  <button
                    onClick={() => {
                      console.log('Current state:', {
                        version,
                        isLoggedIn,
                        userName,
                        tableDataRows: (tableData.data && tableData.data.length) || 0,
                        selectedRows: (selectedRows && selectedRows.length) || 0,
                        filters
                      });
                      alert('Check console for state dump');
                    }}
                    style={{
                      padding: '12px',
                      background: 'linear-gradient(135deg, #2196f3 0%, #1565c0 100%)',
                      color: 'white',
                      border: 'none',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '600',
                      cursor: 'pointer'
                    }}
                  >
                    üìä Dump State to Console
                  </button>

                  <button
                    onClick={() => {
                      clearFilters();
                      console.log('‚úÖ Filters cleared');
                    }}
                    style={{
                      padding: '12px',
                      background: 'linear-gradient(135deg, #ff9800 0%, #f57c00 100%)',
                      color: 'white',
                      border: 'none',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '600',
                      cursor: 'pointer'
                    }}
                  >
                    üóëÔ∏è Clear All Filters
                  </button>

                  <button
                    onClick={() => {
                      setColumnSplit(50);
                      setRowSplit(60);
                      console.log('‚úÖ Layout reset');
                    }}
                    style={{
                      padding: '12px',
                      background: 'linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%)',
                      color: 'white',
                      border: 'none',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '600',
                      cursor: 'pointer'
                    }}
                  >
                    ‚ü≤ Reset Layout
                  </button>

                  <button
                    onClick={() => {
                      setIsDraggableTestOpen(true);
                      console.log('‚úÖ Opening draggable modal test');
                    }}
                    style={{
                      padding: '12px',
                      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                      color: 'white',
                      border: 'none',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '600',
                      cursor: 'pointer'
                    }}
                  >
                    ü™ü Test Draggable Modal
                  </button>

                  <button
                    onClick={() => {
                      console.log('üîç Loading Firebase users debug info...');
                      const btn = event.target;
                      const originalText = btn.textContent;
                      btn.disabled = true;
                      btn.textContent = '‚è≥ Loading...';
                      setDebugOutput('Loading Firebase users data...');

                      google.script.run
                        .withSuccessHandler((result) => {
                          btn.disabled = false;
                          btn.textContent = originalText;
                          console.log('‚úÖ Debug info received:', result);
                          setDebugOutput(JSON.stringify(result, null, 2));
                        })
                        .withFailureHandler((error) => {
                          btn.disabled = false;
                          btn.textContent = originalText;
                          console.error('‚ùå Error:', error);
                          setDebugOutput('ERROR: ' + error.message + '\n\n' + error.toString());
                        })
                        .debugLoadUsersFirebase();
                    }}
                    style={{
                      padding: '12px',
                      background: 'linear-gradient(135deg, #2196f3 0%, #1565c0 100%)',
                      color: 'white',
                      border: 'none',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '600',
                      cursor: 'pointer'
                    }}
                  >
                    üîç Load Users Firebase
                  </button>

                  <button
                    onClick={() => {
                      console.log('üìß Sending test email...');
                      const btn = event.target;
                      const originalText = btn.textContent;
                      btn.disabled = true;
                      btn.textContent = 'üìß Verzenden...';

                      google.script.run
                        .withSuccessHandler((result) => {
                          btn.disabled = false;
                          btn.textContent = originalText;

                          if (result.success) {
                            console.log('‚úÖ Email sent:', result);
                            alert('‚úÖ Test email verzonden!\n\n' + result.message + '\n\nTijdstip: ' + result.timestamp);
                          } else {
                            console.error('‚ùå Email failed:', result);
                            alert('‚ùå Email verzenden mislukt:\n\n' + result.message);
                          }
                        })
                        .withFailureHandler((error) => {
                          btn.disabled = false;
                          btn.textContent = originalText;
                          console.error('‚ùå Error:', error);
                          alert('‚ùå Fout bij verzenden email:\n\n' + error.message);
                        })
                        .sendTestEmail();
                    }}
                    style={{
                      padding: '12px',
                      background: 'linear-gradient(135deg, #4caf50 0%, #2e7d32 100%)',
                      color: 'white',
                      border: 'none',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '600',
                      cursor: 'pointer'
                    }}
                  >
                    üìß Send Test Email
                  </button>

                  <button
                    onClick={() => {
                      console.log('üì® Testing aanvraag email...');
                      const btn = event.target;
                      const originalText = btn.textContent;
                      btn.disabled = true;
                      btn.textContent = 'üì® Verzenden...';
                      setDebugOutput('Testing aanvraag notification email...');

                      google.script.run
                        .withSuccessHandler((result) => {
                          btn.disabled = false;
                          btn.textContent = originalText;
                          console.log('‚úÖ Aanvraag email test result:', result);
                          setDebugOutput(JSON.stringify(result, null, 2));

                          if (result.success) {
                            alert('‚úÖ Aanvraag test email verzonden!\n\n' + result.message + '\n\nRequest ID: ' + result.testData.requestId + '\nVerzonden naar: ' + result.testData.sentTo);
                          } else {
                            alert('‚ùå Aanvraag email mislukt:\n\n' + result.message + '\n\nError: ' + (result.error || 'Unknown'));
                          }
                        })
                        .withFailureHandler((error) => {
                          btn.disabled = false;
                          btn.textContent = originalText;
                          console.error('‚ùå Error:', error);
                          setDebugOutput('ERROR: ' + error.message + '\n\n' + error.toString());
                          alert('‚ùå Fout bij testen aanvraag email:\n\n' + error.message);
                        })
                        .testAanvraagEmail();
                    }}
                    style={{
                      padding: '12px',
                      background: 'linear-gradient(135deg, #ff9800 0%, #f57c00 100%)',
                      color: 'white',
                      border: 'none',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '600',
                      cursor: 'pointer'
                    }}
                  >
                    üì® Test Aanvraag Email
                  </button>
                </div>

                <div style={{
                  marginTop: '20px',
                  padding: '15px',
                  backgroundColor: '#e8f4f8',
                  borderRadius: '8px',
                  border: '1px solid #b3d9e8'
                }}>
                  <div style={{ color: '#2c5f7a', fontSize: '12px', fontWeight: '600', marginBottom: '8px' }}>
                    üí° TIP
                  </div>
                  <div style={{ color: '#2c5f7a', fontSize: '13px', lineHeight: '1.6' }}>
                    Open browser DevTools (F12) voor gedetailleerde console logs en network monitoring.
                  </div>
                </div>

                <div style={{
                  marginTop: '15px',
                  padding: '15px',
                  backgroundColor: '#e8f5e9',
                  borderRadius: '8px',
                  border: '1px solid #a5d6a7'
                }}>
                  <div style={{ color: '#2e7d32', fontSize: '12px', fontWeight: '600', marginBottom: '8px' }}>
                    üìß EMAIL TEST
                  </div>
                  <div style={{ color: '#2e7d32', fontSize: '13px', lineHeight: '1.6' }}>
                    Test email wordt verzonden naar: rob.oversteyns@gmail.com
                  </div>
                </div>

                {debugOutput && (
                  <div style={{
                    marginTop: '15px',
                    padding: '15px',
                    backgroundColor: '#fff3e0',
                    borderRadius: '8px',
                    border: '2px solid #ff9800'
                  }}>
                    <div style={{
                      color: '#e65100',
                      fontSize: '12px',
                      fontWeight: '600',
                      marginBottom: '8px',
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center'
                    }}>
                      <span>üîç DEBUG OUTPUT</span>
                      <button
                        onClick={() => {
                          navigator.clipboard.writeText(debugOutput);
                          alert('Debug output gekopieerd naar klembord!');
                        }}
                        style={{
                          padding: '4px 8px',
                          fontSize: '11px',
                          backgroundColor: '#ff9800',
                          color: 'white',
                          border: 'none',
                          borderRadius: '4px',
                          cursor: 'pointer'
                        }}
                      >
                        üìã Kopieer
                      </button>
                    </div>
                    <pre style={{
                      color: '#424242',
                      fontSize: '11px',
                      lineHeight: '1.4',
                      maxHeight: '400px',
                      overflow: 'auto',
                      margin: 0,
                      fontFamily: 'Consolas, Monaco, monospace',
                      whiteSpace: 'pre-wrap',
                      wordWrap: 'break-word'
                    }}>
                      {debugOutput}
                    </pre>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    };

// ===== RENDER =====

    if (!isLoggedIn) {
      return (
        <React.Fragment>
          <div className="login-container">
            <form onSubmit={handleSubmit}>
              <h1>Login</h1>
              <input
                type="text"
                value={username}
                onChange={(e) => setUsername(e.target.value)}
                placeholder="Gebruikersnaam"
                required
                disabled={isLoading}
              />
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                placeholder="Wachtwoord (optioneel)"
                disabled={isLoading}
              />
              <button type="submit" disabled={isLoading}>
                {isLoading ? 'Bezig met inloggen...' : 'Inloggen'}
              </button>
              {error && <p className="error">{error}</p>}
              {isPrefetching && (
                <p className="prefetch-info">‚ö° Data wordt voorgeladen...</p>
              )}
              <div className="version-info">
                <span className="version-badge">JS: {version} | CSS: {stylesheetVersion}</span>
              </div>
            </form>
          </div>

          {/* Empty Password Modal - also available on login screen */}
          <EmptyPasswordModal />
        </React.Fragment>
      );
    }

    // Installatie selectie scherm verwijderd - ga direct naar hoofdpagina na login

    return (
      <React.Fragment>
        <style>{`
          body.dragging-central {
            user-select: none;
            cursor: move;
          }
          body.dragging-central * {
            cursor: move !important;
          }
          @keyframes pulse-ring {
            0% {
              box-shadow: 0 0 0 0 rgba(103, 58, 183, 0.7);
            }
            70% {
              box-shadow: 0 0 0 15px rgba(103, 58, 183, 0);
            }
            100% {
              box-shadow: 0 0 0 0 rgba(103, 58, 183, 0);
            }
          }
          @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }
          @keyframes slideUp {
            from { 
              opacity: 0;
              transform: translateY(20px) scale(0.95);
            }
            to { 
              opacity: 1;
              transform: translateY(0) scale(1);
            }
          }
        `}</style>
        
        <div className="app-container">
          <nav className={`sidebar ${isSidebarCollapsed ? 'collapsed' : ''}`}>
            <button
              className="sidebar-toggle-btn"
              onClick={() => setIsSidebarCollapsed(!isSidebarCollapsed)}
              title={isSidebarCollapsed ? "Open menu" : "Sluit menu"}
            >
              {isSidebarCollapsed ? '‚ò∞' : '‚úï'}
            </button>

            <div className="app-title">{isSidebarCollapsed ? 'AR' : 'Aanvragen Rimses'}</div>

            {/* Installatie dropdown verwijderd - toon nu alle data zonder filter */}

            {/* Vergrendelpunten menu - Hidden for Role T (technical admin) */}
            {!isSidebarCollapsed && userRole !== 'T' && (
              <button
                className={`nav-button ${!activeCriticaliteitView ? 'active' : ''}`}
                onClick={() => {
                  setActiveCriticaliteitView(false);
                  setActiveAdminView(null);
                }}
              >
                <span className="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
                    <path fill="currentColor" d="M6.906.664a1.75 1.75 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z"/>
                  </svg>
                </span>
                Vergrendelpunten
              </button>
            )}

            {/* Criticaliteit menu - Visible for Role C (admin), D (super user), and T (technical admin) */}
            {!isSidebarCollapsed && (userRole === 'C' || userRole === 'D' || userRole === 'T') && (
              <button
                className={`nav-button ${activeCriticaliteitView ? 'active' : ''}`}
                onClick={() => {
                  setActiveCriticaliteitView(true);
                  setActiveAdminView(null);
                  setIsAdminMenuExpanded(false);
                  fetchCriticalityData();
                }}
              >
                <span className="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
                    <path fill="currentColor" d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/>
                  </svg>
                </span>
                Criticaliteit
              </button>
            )}

            {/* Admin menu - Visible for Role C (admin) and D (super user) */}
            {!isSidebarCollapsed && (userRole === 'C' || userRole === 'D') && (
              <div className="admin-menu">
                <button
                  className="nav-button"
                  onClick={() => {
                    const newExpandedState = !isAdminMenuExpanded;
                    setIsAdminMenuExpanded(newExpandedState);
                    // Reset active admin view when closing menu
                    if (!newExpandedState) {
                      setActiveAdminView(null);
                    }
                  }}
                  style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center'
                  }}
                >
                  <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                    <span className="icon">
                      <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
                        <path fill="currentColor" d="M8 4.754a3.246 3.246 0 1 0 0 6.492a3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0a2.246 2.246 0 0 1-4.492 0"/>
                        <path fill="currentColor" d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
                      </svg>
                    </span>
                    Admin
                  </div>
                  <span style={{
                    transition: 'transform 0.2s',
                    transform: isAdminMenuExpanded ? 'rotate(90deg)' : 'rotate(0deg)',
                    marginLeft: '12px'
                  }}>
                    ‚Ä∫
                  </span>
                </button>

                {isAdminMenuExpanded && (
                  <div className="submenu" style={{
                    paddingLeft: '20px',
                    borderLeft: '2px solid rgba(102, 126, 234, 0.3)',
                    marginLeft: '10px'
                  }}>
                    <button
                      className="nav-button submenu-item"
                      onClick={() => {
                        setActiveAdminView('users');
                        fetchUsers();
                      }}
                      style={{
                        fontSize: '14px',
                        padding: '8px 12px'
                      }}
                    >
                      Gebruikers
                    </button>
                    {/* Debug & Test - Only visible for Role D (super user) */}
                    {userRole === 'D' && (
                      <button
                        className="nav-button submenu-item"
                        onClick={handleToggleDebugPanel}
                        title="Toggle debug & test panel"
                        style={{
                          fontSize: '14px',
                          padding: '8px 12px'
                        }}
                      >
                        Debug & Test
                      </button>
                    )}
                  </div>
                )}
              </div>
            )}

            {!isSidebarCollapsed && (
              <button className="nav-button" onClick={handleLogout}>
                <span className="icon">‚éã</span>
                Uitloggen
              </button>
            )}
          </nav>
          
          <main className="main-content">
            <header>
              <div className="welcome">Welkom: {userName}</div>
              <div className="header-actions">
                {showTable && !activeCriticaliteitView && (
                  <button
                    className="reset-layout-btn"
                    onClick={() => {
                      setColumnSplit(50);
                      setRowSplit(60);
                    }}
                    title="Reset layout naar standaard"
                  >
                    ‚ü≤ Reset Layout
                  </button>
                )}
                <button className="about" onClick={handleOpenAboutModal}>About</button>
              </div>
            </header>

            {activeCriticaliteitView ? (
              <div className="criticaliteit-container">
                <h2 style={{
                  fontSize: '24px',
                  fontWeight: '600',
                  marginBottom: '20px',
                  color: '#333',
                  textAlign: 'center'
                }}>
                  Criticaliteit Beheer
                </h2>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  height: 'calc(100vh - 220px)',
                  padding: '20px'
                }}>
                  {/* Single centered table container */}
                  <div className="criticaliteit-table-container" style={{
                    backgroundColor: 'white',
                    border: '2px solid #e0e0e0',
                    borderRadius: '8px',
                    padding: '20px',
                    width: '95%',
                    maxWidth: '1600px',
                    height: '85%',
                    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
                    transition: 'all 0.2s ease',
                    display: 'flex',
                    flexDirection: 'column',
                    overflow: 'hidden'
                  }}>
                    {isLoadingCriticality ? (
                      <div style={{
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        height: '100%',
                        color: '#999'
                      }}>
                        <div className="spinner"></div>
                        <p>Bezig met laden van criticaliteit data...</p>
                      </div>
                    ) : criticalityData.length === 0 ? (
                      <div style={{
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        height: '100%',
                        color: '#999',
                        fontSize: '18px',
                        fontWeight: '500'
                      }}>
                        Geen criticaliteit data beschikbaar
                      </div>
                    ) : (
                      <React.Fragment>
                        <div style={{
                          marginBottom: '15px',
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center'
                        }}>
                          <div style={{ fontSize: '16px', fontWeight: '600', color: '#333' }}>
                            Totaal: {criticalityData.length} items
                          </div>
                        </div>
                        <div style={{
                          flex: 1,
                          overflow: 'auto',
                          border: '1px solid #e0e0e0',
                          borderRadius: '4px'
                        }}>
                          <table style={{
                            width: '100%',
                            borderCollapse: 'collapse',
                            fontSize: '13px'
                          }}>
                            <thead>
                              <tr>
                                <th style={{
                                  padding: '10px 8px',
                                  textAlign: 'left',
                                  borderBottom: '2px solid #ddd',
                                  fontWeight: '600',
                                  fontSize: '12px',
                                  minWidth: '60px',
                                  backgroundColor: '#f5f5f5',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>ID</th>
                                <th style={{
                                  padding: '10px 8px',
                                  textAlign: 'left',
                                  borderBottom: '2px solid #ddd',
                                  fontWeight: '600',
                                  fontSize: '12px',
                                  minWidth: '180px',
                                  backgroundColor: '#f5f5f5',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Naam</th>
                                <th style={{
                                  padding: '10px 8px',
                                  textAlign: 'left',
                                  borderBottom: '2px solid #ddd',
                                  fontWeight: '600',
                                  fontSize: '12px',
                                  minWidth: '100px',
                                  backgroundColor: '#f5f5f5',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Remax</th>
                                <th style={{
                                  padding: '10px 8px',
                                  textAlign: 'left',
                                  borderBottom: '2px solid #ddd',
                                  fontWeight: '600',
                                  fontSize: '12px',
                                  minWidth: '90px',
                                  backgroundColor: '#f5f5f5',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Cat.</th>
                                <th style={{
                                  padding: '10px 8px',
                                  textAlign: 'left',
                                  borderBottom: '2px solid #ddd',
                                  fontWeight: '600',
                                  fontSize: '12px',
                                  minWidth: '100px',
                                  backgroundColor: '#f5f5f5',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Mach. Crit</th>
                                <th style={{
                                  padding: '10px 8px',
                                  textAlign: 'left',
                                  borderBottom: '2px solid #ddd',
                                  fontWeight: '600',
                                  fontSize: '12px',
                                  minWidth: '80px',
                                  backgroundColor: '#f5f5f5',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Risico</th>
                                <th style={{
                                  padding: '10px 8px',
                                  textAlign: 'left',
                                  borderBottom: '2px solid #ddd',
                                  fontWeight: '600',
                                  fontSize: '12px',
                                  minWidth: '100px',
                                  backgroundColor: '#f5f5f5',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Status</th>
                                <th style={{
                                  padding: '10px 8px',
                                  textAlign: 'left',
                                  borderBottom: '2px solid #ddd',
                                  fontWeight: '600',
                                  fontSize: '12px',
                                  minWidth: '110px',
                                  backgroundColor: '#f5f5f5',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Datum</th>
                                <th style={{
                                  padding: '10px 8px',
                                  textAlign: 'left',
                                  borderBottom: '2px solid #ddd',
                                  fontWeight: '600',
                                  fontSize: '12px',
                                  minWidth: '150px',
                                  backgroundColor: '#f5f5f5',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>User</th>
                              </tr>
                            </thead>
                            <tbody>
                              {criticalityData.map((item, index) => (
                                <tr key={item.firebaseKey || index} style={{
                                  backgroundColor: index % 2 === 0 ? 'white' : '#fafafa',
                                  transition: 'background-color 0.15s'
                                }}>
                                  <td style={{ padding: '10px 8px', borderBottom: '1px solid #e0e0e0' }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                      <button
                                        title="Details bekijken"
                                        onClick={() => handleOpenCriticalityDetail(item)}
                                        style={{
                                          padding: '4px 8px',
                                          border: 'none',
                                          borderRadius: '3px',
                                          fontSize: '14px',
                                          cursor: 'pointer',
                                          backgroundColor: '#2196f3',
                                          color: 'white',
                                          transition: 'all 0.2s',
                                          display: 'flex',
                                          alignItems: 'center',
                                          justifyContent: 'center',
                                          minWidth: '28px',
                                          height: '28px'
                                        }}
                                      >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                          <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                      </button>
                                      <span>{item.ID || '-'}</span>
                                    </div>
                                  </td>
                                  <td style={{ padding: '10px 8px', borderBottom: '1px solid #e0e0e0', fontWeight: '500' }}>{item.Naam || '-'}</td>
                                  <td style={{ padding: '10px 8px', borderBottom: '1px solid #e0e0e0' }}>{item.RemaxNummer || '-'}</td>
                                  <td style={{ padding: '10px 8px', borderBottom: '1px solid #e0e0e0' }}>
                                    <span style={{
                                      backgroundColor: item.Categorie === 'QS0' ? '#bbdefb' : item.Categorie === 'QS2' ? '#1976d2' : item.Categorie === 'QS3' ? '#ff9800' : '#e0e0e0',
                                      color: item.Categorie === 'QS0' ? '#0d47a1' : item.Categorie === 'QS2' ? '#ffffff' : item.Categorie === 'QS3' ? '#ffffff' : '#666',
                                      padding: '3px 8px',
                                      borderRadius: '4px',
                                      fontSize: '12px',
                                      fontWeight: '600'
                                    }}>
                                      {item.Categorie || '-'}
                                    </span>
                                  </td>
                                  <td style={{ padding: '10px 8px', borderBottom: '1px solid #e0e0e0' }}>
                                    <span style={{
                                      backgroundColor: item.MachineCrit === 'AA' ? '#c8e6c9' : item.MachineCrit === 'A' ? '#fff3cd' : '#f8d7da',
                                      color: item.MachineCrit === 'AA' ? '#2e7d32' : item.MachineCrit === 'A' ? '#856404' : '#721c24',
                                      padding: '3px 8px',
                                      borderRadius: '4px',
                                      fontSize: '12px',
                                      fontWeight: '600'
                                    }}>
                                      {item.MachineCrit || '-'}
                                    </span>
                                  </td>
                                  <td style={{ padding: '10px 8px', borderBottom: '1px solid #e0e0e0' }}>
                                    <span style={{
                                      backgroundColor: item.Risico === 'A' ? '#c8e6c9' : item.Risico === 'B' ? '#fff3cd' : '#f8d7da',
                                      color: item.Risico === 'A' ? '#2e7d32' : item.Risico === 'B' ? '#856404' : '#721c24',
                                      padding: '3px 8px',
                                      borderRadius: '4px',
                                      fontSize: '12px',
                                      fontWeight: '600'
                                    }}>
                                      {item.Risico || '-'}
                                    </span>
                                  </td>
                                  <td style={{ padding: '10px 8px', borderBottom: '1px solid #e0e0e0' }}>
                                    <span style={{
                                      backgroundColor: item.Status === 'Voltooid' ? '#c8e6c9' : item.Status === 'In behandeling' ? '#fff3cd' : '#e0e0e0',
                                      color: item.Status === 'Voltooid' ? '#2e7d32' : item.Status === 'In behandeling' ? '#856404' : '#666',
                                      padding: '3px 8px',
                                      borderRadius: '4px',
                                      fontSize: '11px',
                                      fontWeight: '600'
                                    }}>
                                      {item.Status || '-'}
                                    </span>
                                  </td>
                                  <td style={{ padding: '10px 8px', borderBottom: '1px solid #e0e0e0' }}>{formatCriticalityDate(item.Datum)}</td>
                                  <td style={{ padding: '10px 8px', borderBottom: '1px solid #e0e0e0', fontSize: '12px', color: '#666' }}>{item.User || '-'}</td>
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>
                      </React.Fragment>
                    )}
                  </div>
                </div>
              </div>
            ) : isLoadingTable ? (
              <div className="loading-spinner">
                <div className="spinner"></div>
                <p>Bezig met laden van data...</p>
              </div>
            ) : showTable && tableData.headers.length > 0 ? (
              <div 
                className="tables-grid"
                style={{
                  display: 'grid',
                  gridTemplateColumns: `${columnSplit}% ${100 - columnSplit}%`,
                  gridTemplateRows: `${rowSplit}% ${100 - rowSplit}%`,
                  gap: 0,
                  height: 'calc(100vh - 180px)',
                  position: 'relative'
                }}
              >
                {/* TABEL 1 - TOP LEFT - Vergrendelpunten */}
                <div className="table-container main-table" style={{ gridColumn: 1, gridRow: 1 }}>
                  <div className="table-header-info">
                    <h3>Vergrendelpunten voor {selectedInstallation}</h3>
                    <div className="table-info-row">
                      <p className="data-count">
                        Rij {startIndex + 1}-{Math.min(endIndex, filteredTableData.length)} van {filteredTableData.length} 
                        {tableData.data.length !== filteredTableData.length && ` (totaal: ${tableData.data.length})`}
                        {(filters.code || filters.type || filters.sleutelbox || filters.naam || filters.naamGeografisch) && (
                          <span className="filter-indicator"> (gefilterd)</span>
                        )}
                      </p>
                      {(filters.code || filters.type || filters.sleutelbox || filters.naam || filters.naamGeografisch) && (
                        <button onClick={clearFilters} className="clear-filters-btn">
                          ‚úï Wis filters
                        </button>
                      )}
                    </div>
                  </div>
                  
                  {filteredTableData.length > 0 ? (
                    <div className="table-content">
                      <div className="table-wrapper">
                        <table>
                          <thead>
                            <tr className="filter-row">
                              {tableData.headers.map((header, index) => {
                                const headerLower = header.toLowerCase();
                                const isCode = headerLower.includes('code');
                                const isType = headerLower.includes('type');
                                const isSleutelbox = headerLower.includes('sleutelbox');
                                const isNaam = headerLower.includes('naam') && !headerLower.includes('geografische');
                                const isNaamGeografisch = headerLower.includes('naam') && headerLower.includes('geografische');
                                
                                if (isCode || isType || isSleutelbox || isNaam || isNaamGeografisch) {
                                  let filterName = '';
                                  if (isCode) filterName = 'code';
                                  else if (isType) filterName = 'type';
                                  else if (isSleutelbox) filterName = 'sleutelbox';
                                  else if (isNaamGeografisch) filterName = 'naamGeografisch';
                                  else if (isNaam) filterName = 'naam';
                                  
                                  return (
                                    <th key={`filter-${index}`}>
                                      <input
                                        type="text"
                                        value={filters[filterName]}
                                        onChange={(e) => handleFilterChange(filterName, e.target.value)}
                                        placeholder={`Zoek ${header}...`}
                                        className={`filter-input ${filters[filterName] ? 'active' : ''}`}
                                      />
                                    </th>
                                  );
                                }
                                return <th key={`filter-${index}`}></th>;
                              })}
                            </tr>
                            <tr>
                              {tableData.headers.map((header, index) => (
                                <th key={index}>{header}</th>
                              ))}
                            </tr>
                          </thead>
                          <tbody>
                            {paginatedData.map((row, rowIndex) => {
                              const isSelected = isRowSelected(rowIndex);
                              return (
                                <tr key={rowIndex} className={isSelected ? 'selected-row' : ''}>
                                  {row.map((cell, cellIndex) => {
                                    const headerLower = tableData.headers[cellIndex].toLowerCase();
                                    const isCode = headerLower.includes('code');
                                    
                                    if (isCode) {
                                      return (
                                        <td key={cellIndex} className="code-column">
                                          <div className="code-cell">
                                            <span className="code-value" title={cell || '-'}>
                                              {cell !== null && cell !== undefined && cell !== '' ? cell : '-'}
                                            </span>
                                            <div className="code-actions">
                                              <button 
                                                className="btn-select" 
                                                title="Selecteer"
                                                onClick={() => handleSelectRow(row, rowIndex)}
                                                disabled={isSelected}
                                              >
                                                ‚úì
                                              </button>
                                              <button 
                                                className="btn-delete" 
                                                title="Verwijder selectie"
                                                onClick={() => {
                                                  const fullRowIndex = startIndex + rowIndex;
                                                  const rowId = generateRowId(row, fullRowIndex);
                                                  handleDeleteRow(rowId);
                                                }}
                                                disabled={!isSelected}
                                              >
                                                ‚úï
                                              </button>
                                            </div>
                                          </div>
                                        </td>
                                      );
                                    }
                                    
                                    return (
                                      <td key={cellIndex} title={cell || '-'}>
                                        {cell !== null && cell !== undefined && cell !== '' ? cell : '-'}
                                      </td>
                                    );
                                  })}
                                </tr>
                              );
                            })}
                          </tbody>
                        </table>
                      </div>
                      
                      {totalPages > 1 && (
                        <div className="pagination">
                          <button 
                            className="pagination-btn" 
                            onClick={() => handlePageChange(1)}
                            disabled={currentPage === 1}
                            title="Eerste pagina"
                          >
                            ¬´¬´
                          </button>
                          <button 
                            className="pagination-btn" 
                            onClick={() => handlePageChange(currentPage - 1)}
                            disabled={currentPage === 1}
                            title="Vorige pagina"
                          >
                            ‚Äπ
                          </button>
                          
                          {getPageNumbers().map((page, index) => (
                            page === '...' ? (
                              <span key={`ellipsis-${index}`} className="pagination-ellipsis">...</span>
                            ) : (
                              <button
                                key={page}
                                className={`pagination-btn ${currentPage === page ? 'active' : ''}`}
                                onClick={() => handlePageChange(page)}
                              >
                                {page}
                              </button>
                            )
                          ))}
                          
                          <button 
                            className="pagination-btn" 
                            onClick={() => handlePageChange(currentPage + 1)}
                            disabled={currentPage === totalPages}
                            title="Volgende pagina"
                          >
                            ‚Ä∫
                          </button>
                          <button 
                            className="pagination-btn" 
                            onClick={() => handlePageChange(totalPages)}
                            disabled={currentPage === totalPages}
                            title="Laatste pagina"
                          >
                            ¬ª¬ª
                          </button>
                        </div>
                      )}
                    </div>
                  ) : (
                    <div className="no-data">
                      <p>Geen vergrendelpunten gevonden</p>
                    </div>
                  )}
                </div>
{/* TABEL 2 - TOP RIGHT - Geselecteerde rijen */}
                <div
                  className={`table-container side-table ${selectedRows.length === 0 ? 'empty' : ''}`}
                  style={{
                    gridColumn: 2,
                    gridRow: 1,
                    padding: selectedRows.length === 0 ? '0' : '8px',
                    background: 'transparent',
                    position: 'relative'
                  }}
                >
                  {selectedRows.length > 0 ? (
                    <div className="selected-table">
                      <div className="table-header-info">
                        <div className="table-header-row">
                          <h3>Geselecteerde Vergrendelpunten</h3>
                          <button 
                            className="btn-aanvragen"
                            onClick={handleOpenModal}
                            disabled={selectedRows.length === 0}
                            title="Verstuur aanvraag voor geselecteerde vergrendelpunten"
                          >
                            üìã Aanvragen
                          </button>
                        </div>
                        <p className="data-count">
                          {selectedRows.length} {selectedRows.length === 1 ? 'selectie' : 'selecties'}
                        </p>
                      </div>
                      <div className="table-wrapper">
                        <table key={`selected-table-${selectedRows.length}`}>
                          <thead>
                            <tr>
                              {tableData.headers.map((header, index) => (
                                <th key={index}>{header}</th>
                              ))}
                              <th>Actie</th>
                            </tr>
                          </thead>
                          <tbody>
                            {selectedRows.length > 0 && (
                              <tr style={{height: '1px', backgroundColor: 'transparent'}}>
                                {tableData.headers.map((_, index) => (
                                  <td key={index} style={{height: '1px', padding: '0', border: 'none'}}></td>
                                ))}
                                <td style={{height: '1px', padding: '0', border: 'none'}}></td>
                              </tr>
                            )}
                            
                            {selectedRows.map((selectedRow, idx) => {
                              if (!selectedRow.data || !Array.isArray(selectedRow.data)) {
                                console.error('Invalid row data:', selectedRow);
                                return null;
                              }
                              
                              return (
                                <tr 
                                  key={selectedRow.id}
                                  style={{
                                    backgroundColor: idx % 2 === 0 ? 'white' : '#fafafa'
                                  }}
                                >
                                  {selectedRow.data.map((cell, cellIndex) => {
                                    const cellValue = cell !== null && cell !== undefined && cell !== '' ? String(cell) : '-';
                                    return (
                                      <td 
                                        key={cellIndex} 
                                        title={cellValue}
                                      >
                                        {cellValue}
                                      </td>
                                    );
                                  })}
                                  <td>
                                    <button 
                                      className="btn-delete-small" 
                                      title="Verwijder selectie"
                                      onClick={() => handleDeleteRow(selectedRow.id)}
                                    >
                                      ‚úï
                                    </button>
                                  </td>
                                </tr>
                              );
                            })}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  ) : (
                    <div style={{
                      background: 'linear-gradient(135deg, #c7d2fe 0%, #ddd6fe 100%)',
                      height: '100%',
                      width: '100%',
                      borderRadius: '8px',
                      position: 'absolute',
                      top: 0,
                      left: 0
                    }}></div>
                  )}
                </div>

                {/* TABEL 3 - BOTTOM LEFT - Aanvragen */}
                <div 
                  className="table-container bottom-left-table" 
                  style={{ gridColumn: 1, gridRow: 2, padding: '8px' }}
                >
                  <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    marginBottom: '6px',
                    paddingBottom: '6px',
                    borderBottom: '2px solid #e0e0e0'
                  }}>
                    <h3 style={{margin: 0, color: '#1a237e', fontSize: '14px'}}>Aanvragen</h3>
                    <p style={{margin: 0, color: '#666', fontSize: '12px'}}>
                      {isLoadingAanvragen ? 'Laden...' : `${filteredAanvragen.length} aanvragen`}
                    </p>
                  </div>

                  {isLoadingAanvragen ? (
                    <div className="loading-spinner">
                      <div className="spinner"></div>
                      <p style={{fontSize: '12px'}}>Aanvragen laden...</p>
                    </div>
                  ) : filteredAanvragen.length > 0 ? (
                    <div style={{
                      flex: '1 1 auto',
                      overflow: 'auto',
                      margin: 0,
                      padding: 0
                    }}>
                      <table style={{
                        width: '100%',
                        borderCollapse: 'collapse',
                        fontSize: '10px',
                        margin: 0,
                        padding: 0
                      }}>
                        <thead>
                          <tr>
                            <th style={{
                              backgroundColor: '#f5f5f5',
                              fontWeight: 600,
                              color: '#333',
                              border: '1px solid #e0e0e0',
                              padding: '10px',
                              textAlign: 'left',
                              fontSize: '11px',
                              position: 'sticky',
                              top: 0,
                              zIndex: 10
                            }}>Aanvraag tekst</th>
                            <th style={{
                              backgroundColor: '#f5f5f5',
                              fontWeight: 600,
                              color: '#333',
                              border: '1px solid #e0e0e0',
                              padding: '10px',
                              textAlign: 'left',
                              fontSize: '11px',
                              position: 'sticky',
                              top: 0,
                              zIndex: 10
                            }}>Installatie</th>
                            <th style={{
                              backgroundColor: '#f5f5f5',
                              fontWeight: 600,
                              color: '#333',
                              border: '1px solid #e0e0e0',
                              padding: '10px',
                              textAlign: 'left',
                              fontSize: '11px',
                              position: 'sticky',
                              top: 0,
                              zIndex: 10
                            }}>Aanvrager</th>
                            <th style={{
                              backgroundColor: '#f5f5f5',
                              fontWeight: 600,
                              color: '#333',
                              border: '1px solid #e0e0e0',
                              padding: '10px',
                              textAlign: 'left',
                              fontSize: '11px',
                              position: 'sticky',
                              top: 0,
                              zIndex: 10
                            }}>Autorisator</th>
                            <th style={{
                              backgroundColor: '#f5f5f5',
                              fontWeight: 600,
                              color: '#333',
                              border: '1px solid #e0e0e0',
                              padding: '10px',
                              textAlign: 'left',
                              fontSize: '11px',
                              position: 'sticky',
                              top: 0,
                              zIndex: 10
                            }}>Aanvraag datum</th>
                            <th style={{
                              backgroundColor: '#f5f5f5',
                              fontWeight: 600,
                              color: '#333',
                              border: '1px solid #e0e0e0',
                              padding: '10px',
                              textAlign: 'left',
                              fontSize: '11px',
                              position: 'sticky',
                              top: 0,
                              zIndex: 10
                            }}>Status</th>
                            <th style={{
                              backgroundColor: '#f5f5f5',
                              fontWeight: 600,
                              color: '#333',
                              border: '1px solid #e0e0e0',
                              padding: '10px',
                              textAlign: 'center',
                              fontSize: '11px',
                              width: '80px',
                              position: 'sticky',
                              top: 0,
                              zIndex: 10
                            }}>Acties</th>
                          </tr>
                          <tr>
                            <th style={{
                              backgroundColor: '#e8eaf6',
                              border: '1px solid #e0e0e0',
                              padding: '6px',
                              position: 'sticky',
                              top: '41px',
                              zIndex: 9
                            }}>
                              <input
                                type="text"
                                placeholder="Zoek..."
                                value={aanvraagFilters.naam}
                                onChange={(e) => handleAanvraagFilterChange('naam', e.target.value)}
                                style={{
                                  width: '100%',
                                  padding: '4px 6px',
                                  fontSize: '10px',
                                  border: '1px solid #c5cae9',
                                  borderRadius: '3px',
                                  outline: 'none'
                                }}
                              />
                            </th>
                            <th style={{
                              backgroundColor: '#e8eaf6',
                              border: '1px solid #e0e0e0',
                              padding: '6px',
                              position: 'sticky',
                              top: '41px',
                              zIndex: 9
                            }}>
                              {/* No filter for installatie */}
                            </th>
                            <th style={{
                              backgroundColor: '#e8eaf6',
                              border: '1px solid #e0e0e0',
                              padding: '6px',
                              position: 'sticky',
                              top: '41px',
                              zIndex: 9
                            }}>
                              <input
                                type="text"
                                placeholder="Zoek..."
                                value={aanvraagFilters.aanvrager}
                                onChange={(e) => handleAanvraagFilterChange('aanvrager', e.target.value)}
                                style={{
                                  width: '100%',
                                  padding: '4px 6px',
                                  fontSize: '10px',
                                  border: '1px solid #c5cae9',
                                  borderRadius: '3px',
                                  outline: 'none'
                                }}
                              />
                            </th>
                            <th style={{
                              backgroundColor: '#e8eaf6',
                              border: '1px solid #e0e0e0',
                              padding: '6px',
                              position: 'sticky',
                              top: '41px',
                              zIndex: 9
                            }}>
                              <input
                                type="text"
                                placeholder="Zoek..."
                                value={aanvraagFilters.autorisator}
                                onChange={(e) => handleAanvraagFilterChange('autorisator', e.target.value)}
                                style={{
                                  width: '100%',
                                  padding: '4px 6px',
                                  fontSize: '10px',
                                  border: '1px solid #c5cae9',
                                  borderRadius: '3px',
                                  outline: 'none'
                                }}
                              />
                            </th>
                            <th style={{
                              backgroundColor: '#e8eaf6',
                              border: '1px solid #e0e0e0',
                              padding: '6px',
                              position: 'sticky',
                              top: '41px',
                              zIndex: 9
                            }}>
                              <input
                                type="text"
                                placeholder="Zoek..."
                                value={aanvraagFilters.datum}
                                onChange={(e) => handleAanvraagFilterChange('datum', e.target.value)}
                                style={{
                                  width: '100%',
                                  padding: '4px 6px',
                                  fontSize: '10px',
                                  border: '1px solid #c5cae9',
                                  borderRadius: '3px',
                                  outline: 'none'
                                }}
                              />
                            </th>
                            <th style={{
                              backgroundColor: '#e8eaf6',
                              border: '1px solid #e0e0e0',
                              padding: '6px',
                              position: 'sticky',
                              top: '41px',
                              zIndex: 9
                            }}>
                              <input
                                type="text"
                                placeholder="Zoek..."
                                value={aanvraagFilters.status}
                                onChange={(e) => handleAanvraagFilterChange('status', e.target.value)}
                                style={{
                                  width: '100%',
                                  padding: '4px 6px',
                                  fontSize: '10px',
                                  border: '1px solid #c5cae9',
                                  borderRadius: '3px',
                                  outline: 'none'
                                }}
                              />
                            </th>
                            <th style={{
                              backgroundColor: '#e8eaf6',
                              border: '1px solid #e0e0e0',
                              padding: '6px',
                              position: 'sticky',
                              top: '41px',
                              zIndex: 9
                            }}>
                              {/* No filter for actions */}
                            </th>
                          </tr>
                        </thead>
                        <tbody>
                          {filteredAanvragen.map((aanvraag, index) => {
                            // Use pre-computed cached values instead of parsing on every render
                            return (
                              <tr key={aanvraag.firebaseKey || index} style={{
                                backgroundColor: index % 2 === 0 ? 'white' : '#fafafa'
                              }}>
                                <td title={aanvraag._naam || '-'} style={{
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  textAlign: 'left',
                                  fontSize: '11px',
                                  whiteSpace: 'nowrap',
                                  overflow: 'hidden',
                                  textOverflow: 'ellipsis',
                                  maxWidth: '200px'
                                }}>
                                  {aanvraag._naam || '-'}
                                </td>
                                <td style={{
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  fontSize: '11px'
                                }}>{aanvraag._installatie || '-'}</td>
                                <td style={{
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  fontSize: '11px'
                                }}>{aanvraag._aanvragerNaam}</td>
                                <td style={{
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  fontSize: '11px'
                                }}>{aanvraag._autorisatorNaam}</td>
                                <td style={{
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  fontSize: '11px'
                                }}>{aanvraag._datum}</td>
                                <td style={{
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  fontSize: '11px'
                                }}>
                                  <span style={{
                                    padding: '4px 8px',
                                    borderRadius: '4px',
                                    fontSize: '11px',
                                    fontWeight: '600',
                                    backgroundColor: aanvraag['Status'] === 'Pending' ? '#fff3cd' :
                                                    aanvraag['Status'] === 'Approved' ? '#d4edda' : '#f8d7da',
                                    color: aanvraag['Status'] === 'Pending' ? '#856404' :
                                           aanvraag['Status'] === 'Approved' ? '#155724' : '#721c24'
                                  }}>
                                    {translateStatus(aanvraag['Status'] || 'Pending')}
                                  </span>
                                </td>
                                <td style={{
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  textAlign: 'center'
                                }}>
                                  <div style={{
                                    display: 'flex',
                                    gap: '4px',
                                    justifyContent: 'center',
                                    alignItems: 'center'
                                  }}>
                                    <button
                                      className="btn-view-aanvraag"
                                      title="Bekijken"
                                      onClick={() => handleOpenDetailModal(aanvraag)}
                                      style={{
                                        padding: '4px 8px',
                                        border: 'none',
                                        borderRadius: '3px',
                                        fontSize: '14px',
                                        cursor: 'pointer',
                                        backgroundColor: '#2196f3',
                                        color: 'white',
                                        transition: 'all 0.2s',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        minWidth: '28px',
                                        height: '28px'
                                      }}
                                    >
                                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                      </svg>
                                    </button>
                                    <button
                                      className="btn-delete-aanvraag"
                                      title="Verwijderen"
                                      onClick={() => handleOpenDeleteModal(aanvraag)}
                                      style={{
                                        padding: '4px 8px',
                                        border: 'none',
                                        borderRadius: '3px',
                                        fontSize: '12px',
                                        cursor: 'pointer',
                                        backgroundColor: '#f44336',
                                        color: 'white',
                                        transition: 'all 0.2s',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        minWidth: '28px',
                                        height: '28px',
                                        fontWeight: 'bold'
                                      }}
                                    >
                                      ‚úï
                                    </button>
                                  </div>
                                </td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    </div>
                  ) : (
                    <div className="no-data" style={{
                      background: 'linear-gradient(135deg, #c7d2fe 0%, #ddd6fe 100%)',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      height: '100%',
                      borderRadius: '8px'
                    }}>
                      <p style={{
                        color: '#5b21b6',
                        fontSize: '14px',
                        fontWeight: '500',
                        margin: 0
                      }}>Geen aanvragen gevonden</p>
                    </div>
                  )}
                </div>
                
                {/* TABEL 4 - BOTTOM RIGHT - Users (Admin only) */}
                <div
                  className="table-container bottom-right-table"
                  style={{ gridColumn: 2, gridRow: 2, padding: '8px' }}
                >
                  {activeAdminView === 'users' ? (
                    <React.Fragment>
                      <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '6px',
                        paddingBottom: '6px',
                        borderBottom: '2px solid #e0e0e0'
                      }}>
                        <div style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                          <h3 style={{margin: 0, color: '#1a237e', fontSize: '14px'}}>Gebruikers</h3>
                          <button
                            onClick={() => setIsAddUserModalOpen(true)}
                            title="Nieuwe gebruiker toevoegen"
                            style={{
                              width: '28px',
                              height: '28px',
                              backgroundColor: 'white',
                              border: '2px solid #e0e0e0',
                              borderRadius: '6px',
                              cursor: 'pointer',
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              transition: 'all 0.2s',
                              padding: 0
                            }}
                            onMouseOver={(e) => {
                              e.currentTarget.style.backgroundColor = '#f5f5f5';
                              e.currentTarget.style.borderColor = '#667eea';
                            }}
                            onMouseOut={(e) => {
                              e.currentTarget.style.backgroundColor = 'white';
                              e.currentTarget.style.borderColor = '#e0e0e0';
                            }}
                          >
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M8 3V13M3 8H13" stroke="#FFC107" strokeWidth="2.5" strokeLinecap="round"/>
                            </svg>
                          </button>
                        </div>
                        <p style={{margin: 0, color: '#666', fontSize: '12px'}}>
                          {isLoadingUsers ? 'Laden...' : `${users.length} gebruikers`}
                        </p>
                      </div>

                      {isLoadingUsers ? (
                        <div className="loading-spinner">
                          <div className="spinner"></div>
                          <p style={{fontSize: '12px'}}>Gebruikers laden...</p>
                        </div>
                      ) : users.length > 0 ? (
                        <div style={{
                          flex: '1 1 auto',
                          overflow: 'auto',
                          margin: 0,
                          padding: 0
                        }}>
                          <table style={{
                            width: '100%',
                            borderCollapse: 'collapse',
                            fontSize: '10px',
                            margin: 0,
                            padding: 0
                          }}>
                            <thead>
                              <tr>
                                <th style={{
                                  backgroundColor: '#f5f5f5',
                                  fontWeight: 600,
                                  color: '#333',
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  textAlign: 'left',
                                  fontSize: '11px',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Email</th>
                                <th style={{
                                  backgroundColor: '#f5f5f5',
                                  fontWeight: 600,
                                  color: '#333',
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  textAlign: 'left',
                                  fontSize: '11px',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Rol</th>
                                <th style={{
                                  backgroundColor: '#f5f5f5',
                                  fontWeight: 600,
                                  color: '#333',
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  textAlign: 'left',
                                  fontSize: '11px',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Departement</th>
                                <th style={{
                                  backgroundColor: '#f5f5f5',
                                  fontWeight: 600,
                                  color: '#333',
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  textAlign: 'left',
                                  fontSize: '11px',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Titel</th>
                                <th style={{
                                  backgroundColor: '#f5f5f5',
                                  fontWeight: 600,
                                  color: '#333',
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  textAlign: 'center',
                                  fontSize: '11px',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Actief</th>
                                <th style={{
                                  backgroundColor: '#f5f5f5',
                                  fontWeight: 600,
                                  color: '#333',
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  textAlign: 'center',
                                  fontSize: '11px',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Wachtwoord</th>
                                <th style={{
                                  backgroundColor: '#f5f5f5',
                                  fontWeight: 600,
                                  color: '#333',
                                  border: '1px solid #e0e0e0',
                                  padding: '10px',
                                  textAlign: 'center',
                                  fontSize: '11px',
                                  position: 'sticky',
                                  top: 0,
                                  zIndex: 10
                                }}>Acties</th>
                              </tr>
                            </thead>
                            <tbody>
                              {users.map((user, index) => (
                                <tr key={user.firebaseKey || index} style={{
                                  backgroundColor: index % 2 === 0 ? 'white' : '#fafafa',
                                  transition: 'background-color 0.2s'
                                }}>
                                  <td style={{
                                    border: '1px solid #e0e0e0',
                                    padding: '10px',
                                    fontSize: '11px'
                                  }}>{user.USER_NAME || '-'}</td>
                                  <td style={{
                                    border: '1px solid #e0e0e0',
                                    padding: '10px',
                                    fontSize: '11px'
                                  }}>
                                    <span style={{
                                      padding: '4px 8px',
                                      borderRadius: '4px',
                                      fontSize: '11px',
                                      fontWeight: '600',
                                      backgroundColor: user.ROLE === 'D' ? '#c8e6c9' :
                                                      user.ROLE === 'C' ? '#e3f2fd' :
                                                      user.ROLE === 'T' ? '#ffe0b2' :
                                                      user.ROLE === 'B' ? '#fff3cd' : '#f3e5f5',
                                      color: user.ROLE === 'D' ? '#2e7d32' :
                                             user.ROLE === 'C' ? '#1565c0' :
                                             user.ROLE === 'T' ? '#e65100' :
                                             user.ROLE === 'B' ? '#856404' : '#6a1b9a'
                                    }}>
                                      {user.ROLE === 'D' ? 'Super User' :
                                       user.ROLE === 'C' ? 'Administrator' :
                                       user.ROLE === 'T' ? 'Technisch Beheerder' :
                                       user.ROLE === 'B' ? 'Autorisator' : 'Gebruiker'}
                                    </span>
                                  </td>
                                  <td style={{
                                    border: '1px solid #e0e0e0',
                                    padding: '10px',
                                    fontSize: '11px'
                                  }}>{user.DEPARTEMENT || '-'}</td>
                                  <td style={{
                                    border: '1px solid #e0e0e0',
                                    padding: '10px',
                                    fontSize: '11px'
                                  }}>{user.TITEL || '-'}</td>
                                  <td style={{
                                    border: '1px solid #e0e0e0',
                                    padding: '10px',
                                    fontSize: '11px',
                                    textAlign: 'center'
                                  }}>
                                    <span style={{
                                      padding: '4px 8px',
                                      borderRadius: '4px',
                                      fontSize: '11px',
                                      fontWeight: '600',
                                      backgroundColor: user.ACTIVE === 1 ? '#d4edda' : '#f8d7da',
                                      color: user.ACTIVE === 1 ? '#155724' : '#721c24'
                                    }}>
                                      {user.ACTIVE === 1 ? 'Ja' : 'Nee'}
                                    </span>
                                  </td>
                                  <td style={{
                                    border: '1px solid #e0e0e0',
                                    padding: '10px',
                                    fontSize: '11px',
                                    textAlign: 'center',
                                    fontFamily: 'monospace'
                                  }}>
                                    {user.PASSWORD ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '-'}
                                  </td>
                                  <td style={{
                                    border: '1px solid #e0e0e0',
                                    padding: '10px',
                                    textAlign: 'center'
                                  }}>
                                    <button
                                      title="Bewerken"
                                      onClick={() => handleOpenEditUserModal(user)}
                                      style={{
                                        padding: '4px 8px',
                                        border: 'none',
                                        borderRadius: '3px',
                                        fontSize: '14px',
                                        cursor: 'pointer',
                                        backgroundColor: '#667eea',
                                        color: 'white',
                                        transition: 'all 0.2s',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        minWidth: '28px',
                                        height: '28px',
                                        margin: '0 auto'
                                      }}
                                    >
                                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                      </svg>
                                    </button>
                                  </td>
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>
                      ) : (
                        <div style={{
                          background: 'linear-gradient(135deg, #c7d2fe 0%, #ddd6fe 100%)',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          height: 'calc(100% - 60px)',
                          borderRadius: '8px',
                          marginTop: '8px'
                        }}>
                          <p style={{
                            fontSize: '14px',
                            color: '#5b21b6',
                            fontWeight: '500',
                            margin: 0
                          }}>
                            Geen gebruikers gevonden
                          </p>
                        </div>
                      )}
                    </React.Fragment>
                  ) : (
                    <div style={{
                      background: 'linear-gradient(135deg, #c7d2fe 0%, #ddd6fe 100%)',
                      height: '100%',
                      borderRadius: '8px'
                    }}></div>
                  )}
                </div>

                {/* CENTRALE SLIDER */}
                <div 
                  onMouseDown={handleCentralDragStart}
                  style={{
                    position: 'absolute',
                    left: `${columnSplit}%`,
                    top: `${rowSplit}%`,
                    transform: 'translate(-50%, -50%)',
                    width: '40px',
                    height: '40px',
                    backgroundColor: isDragging ? '#5e35b1' : '#673ab7',
                    borderRadius: '50%',
                    cursor: 'move',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    boxShadow: isDragging ? '0 8px 24px rgba(103, 58, 183, 0.6)' : '0 4px 12px rgba(103, 58, 183, 0.4)',
                    border: '3px solid white',
                    zIndex: 1000,
                    transition: isDragging ? 'none' : 'all 0.2s'
                  }}
                  title="Sleep om beide dimensies tegelijk aan te passen"
                >
                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: '4px 4px 4px',
                    gridTemplateRows: '4px 4px 4px',
                    gap: '3px'
                  }}>
                    {[...Array(9)].map((_, i) => (
                      <div 
                        key={i} 
                        style={{
                          width: '4px',
                          height: '4px',
                          backgroundColor: 'white',
                          borderRadius: '50%'
                        }}
                      ></div>
                    ))}
                  </div>
                  
                  {!isDragging && (
                    <div style={{
                      position: 'absolute',
                      width: '100%',
                      height: '100%',
                      borderRadius: '50%',
                      animation: 'pulse-ring 2s ease-out infinite'
                    }}></div>
                  )}
                </div>
                
                {/* Visuele hulplijnen tijdens slepen */}
                {isDragging && (
                  <React.Fragment>
                    <div style={{
                      position: 'absolute',
                      left: `${columnSplit}%`,
                      top: 0,
                      bottom: 0,
                      width: '2px',
                      backgroundColor: 'rgba(103, 58, 183, 0.5)',
                      pointerEvents: 'none',
                      zIndex: 999
                    }}></div>
                    <div style={{
                      position: 'absolute',
                      top: `${rowSplit}%`,
                      left: 0,
                      right: 0,
                      height: '2px',
                      backgroundColor: 'rgba(103, 58, 183, 0.5)',
                      pointerEvents: 'none',
                      zIndex: 999
                    }}></div>
                  </React.Fragment>
                )}
              </div>
            ) : null}
          </main>
          
          <footer className="footer">
            <div className="version">JS: {version} | CSS: {stylesheetVersion}</div>
          </footer>
        </div>
		{/* Aanvraag Modal */}
        {isModalOpen && (
          <div 
            className="modal-overlay" 
            onClick={handleCloseModal}
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              width: '100vw',
              height: '100vh',
              backgroundColor: 'rgba(0, 0, 0, 0.6)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 999999,
              overflowY: 'auto',
              padding: '20px'
            }}
          >
            <div 
              className="modal-container" 
              onClick={(e) => e.stopPropagation()}
              style={{
                backgroundColor: 'white',
                borderRadius: '8px',
                boxShadow: '0 10px 40px rgba(0, 0, 0, 0.3)',
                maxWidth: '600px',
                width: '90%',
                maxHeight: '85vh',
                overflowY: 'auto',
                margin: 'auto',
                position: 'relative',
                zIndex: 1000000
              }}
            >
              <div className="modal-header" style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                padding: '20px 25px',
                borderBottom: '2px solid #e0e0e0',
                backgroundColor: '#f9f9f9',
                borderRadius: '8px 8px 0 0'
              }}>
                <h2 style={{margin: 0, color: '#1a237e', fontSize: '20px'}}>Aanvraag Vergrendelgroep</h2>
                <button 
                  className="modal-close" 
                  onClick={handleCloseModal} 
                  title="Sluiten"
                  style={{
                    background: 'none',
                    border: 'none',
                    fontSize: '24px',
                    color: '#666',
                    cursor: 'pointer',
                    padding: 0,
                    width: '30px',
                    height: '30px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    borderRadius: '4px',
                    transition: 'all 0.2s'
                  }}
                >
                  ‚úï
                </button>
              </div>
              
              <form onSubmit={handleFormSubmit} style={{padding: '25px'}}>
                <div style={{marginBottom: '20px'}}>
                  <label htmlFor="naam" style={{
                    display: 'block',
                    marginBottom: '6px',
                    color: '#333',
                    fontWeight: '500',
                    fontSize: '14px'
                  }}>
                    Naam <span style={{color: '#f44336', marginLeft: '2px'}}>*</span>
                    <span style={{color: '#999', fontSize: '12px', fontWeight: 'normal', marginLeft: '5px'}}>
                      ({formData.naam.length}/66 karakters)
                    </span>
                  </label>
                  <input
                    type="text"
                    id="naam"
                    value={formData.naam}
                    onChange={(e) => handleFormChange('naam', e.target.value)}
                    maxLength={66}
                    placeholder="Beschrijving van de aanvraag"
                    required
                    style={{
                      width: '100%',
                      padding: '10px 12px',
                      border: '2px solid #e0e0e0',
                      borderRadius: '4px',
                      fontSize: '14px',
                      fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif',
                      transition: 'border-color 0.3s',
                      boxSizing: 'border-box'
                    }}
                  />
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <label htmlFor="installatie" style={{
                    display: 'block',
                    marginBottom: '6px',
                    color: '#333',
                    fontWeight: '500',
                    fontSize: '14px'
                  }}>
                    Installatie:
                  </label>
                  <select
                    id="installatie"
                    value={formData.installatie}
                    onChange={(e) => handleFormChange('installatie', e.target.value)}
                    style={{
                      width: '100%',
                      padding: '10px 12px',
                      border: '2px solid #e0e0e0',
                      borderRadius: '4px',
                      fontSize: '14px',
                      fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif',
                      backgroundColor: '#ffffff',
                      color: '#333',
                      cursor: 'pointer',
                      boxSizing: 'border-box'
                    }}
                  >
                    <option value="">-- Selecteer Installatie --</option>
                    <option value="G4">G4</option>
                    <option value="G5">G5</option>
                    <option value="SLT2">SLT2</option>
                    <option value="SF">SF</option>
                    <option value="APL4">APL4</option>
                    <option value="CRM3">CRM3</option>
                    <option value="SLT6">SLT6</option>
                    <option value="SBL1">SBL1</option>
                    <option value="CRM5">CRM5</option>
                    <option value="CCS">CCS</option>
                    <option value="CPL2">CPL2</option>
                    <option value="SLT5">SLT5</option>
                    <option value="APL2">APL2</option>
                    <option value="CPO2">CPO2</option>
                    <option value="CRM2">CRM2</option>
                    <option value="WKSR1+2">WKSR1+2</option>
                    <option value="CTL1">CTL1</option>
                    <option value="SKP1">SKP1</option>
                    <option value="SKP2">SKP2</option>
                    <option value="CRM4">CRM4</option>
                    <option value="APL3">APL3</option>
                    <option value="2O">2O</option>
                  </select>
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <label htmlFor="interneOpmerking" style={{
                    display: 'block',
                    marginBottom: '6px',
                    color: '#333',
                    fontWeight: '500',
                    fontSize: '14px'
                  }}>
                    Interne opmerking:
                  </label>
                  <textarea
                    id="interneOpmerking"
                    value={formData.interneOpmerking}
                    onChange={(e) => handleFormChange('interneOpmerking', e.target.value)}
                    rows={3}
                    placeholder="Deze opmerking is alleen intern zichtbaar"
                    style={{
                      width: '100%',
                      padding: '10px 12px',
                      border: '2px solid #e0e0e0',
                      borderRadius: '4px',
                      fontSize: '14px',
                      fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif',
                      resize: 'vertical',
                      minHeight: '80px',
                      boxSizing: 'border-box'
                    }}
                  />
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <label htmlFor="externeOpmerking" style={{
                    display: 'block',
                    marginBottom: '6px',
                    color: '#333',
                    fontWeight: '500',
                    fontSize: '14px'
                  }}>
                    Externe opmerking: <span style={{color: '#666', fontSize: '12px', fontWeight: 'normal', fontStyle: 'italic'}}>Deze wordt mee afgedrukt</span>
                  </label>
                  <textarea
                    id="externeOpmerking"
                    value={formData.externeOpmerking}
                    onChange={(e) => handleFormChange('externeOpmerking', e.target.value)}
                    rows={3}
                    placeholder="Deze opmerking wordt mee afgedrukt op het formulier"
                    style={{
                      width: '100%',
                      padding: '10px 12px',
                      border: '2px solid #e0e0e0',
                      borderRadius: '4px',
                      fontSize: '14px',
                      fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif',
                      resize: 'vertical',
                      minHeight: '80px',
                      boxSizing: 'border-box'
                    }}
                  />
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <label htmlFor="opmerkingen" style={{
                    display: 'block',
                    marginBottom: '6px',
                    color: '#333',
                    fontWeight: '500',
                    fontSize: '14px'
                  }}>
                    Opmerkingen van de aanvrager:
                  </label>
                  <textarea
                    id="opmerkingen"
                    value={formData.opmerkingen}
                    onChange={(e) => handleFormChange('opmerkingen', e.target.value)}
                    rows={3}
                    placeholder="Eventuele aanvullende opmerkingen"
                    style={{
                      width: '100%',
                      padding: '10px 12px',
                      border: '2px solid #e0e0e0',
                      borderRadius: '4px',
                      fontSize: '14px',
                      fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif',
                      resize: 'vertical',
                      minHeight: '80px',
                      boxSizing: 'border-box'
                    }}
                  />
                </div>
                
                <div style={{marginBottom: '20px'}}>
                  <label htmlFor="autorisator" style={{
                    display: 'block',
                    marginBottom: '6px',
                    color: '#333',
                    fontWeight: '500',
                    fontSize: '14px'
                  }}>
                    Autorisator: <span style={{color: '#f44336', marginLeft: '2px'}}>*</span>
                  </label>
                  <select
                    id="autorisator"
                    value={formData.autorisator}
                    onChange={(e) => handleFormChange('autorisator', e.target.value)}
                    required
                    style={{
                      width: '100%',
                      padding: '10px 12px',
                      border: '2px solid #e0e0e0',
                      borderRadius: '4px',
                      fontSize: '14px',
                      fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif',
                      backgroundColor: 'white',
                      cursor: 'pointer',
                      boxSizing: 'border-box'
                    }}
                  >
                    <option value="">Selecteer een autorisator</option>
                    {autorisators.map((autorisator, index) => (
                      <option key={index} value={autorisator}>
                        {autorisator}
                      </option>
                    ))}
                  </select>
                </div>
                
                <div style={{
                  backgroundColor: '#e8f5e9',
                  border: '1px solid #4caf50',
                  borderRadius: '4px',
                  padding: '12px',
                  marginBottom: '20px',
                  color: '#2e7d32',
                  fontSize: '14px'
                }}>
                  <strong style={{fontWeight: 600}}>Geselecteerde vergrendelpunten:</strong> {selectedRows.length} item(s)
                </div>
                
                <div style={{
                  display: 'flex',
                  justifyContent: 'flex-end',
                  gap: '10px',
                  paddingTop: '20px',
                  borderTop: '1px solid #e0e0e0'
                }}>
                  <button 
                    type="button" 
                    onClick={handleCloseModal}
                    style={{
                      padding: '10px 20px',
                      border: '1px solid #ddd',
                      borderRadius: '4px',
                      fontSize: '14px',
                      fontWeight: '600',
                      cursor: 'pointer',
                      backgroundColor: '#f5f5f5',
                      color: '#333',
                      transition: 'all 0.3s'
                    }}
                  >
                    Annuleren
                  </button>
                  <button 
                    type="submit"
                    style={{
                      padding: '10px 20px',
                      border: 'none',
                      borderRadius: '4px',
                      fontSize: '14px',
                      fontWeight: '600',
                      cursor: 'pointer',
                      backgroundColor: '#1a237e',
                      color: 'white',
                      transition: 'all 0.3s'
                    }}
                  >
                    Verzenden
                  </button>
                </div>
              </form>
            </div>
          </div>
        )}
        
        {/* Success Modal */}
        <SuccessModal />

        {/* About Modal */}
        <AboutModal />

        {/* Decision Result Modal */}
        <DecisionResultModal />

        {/* Empty Password Modal */}
        <EmptyPasswordModal />

        {/* Edit User Modal */}
        <EditUserModal />

        {/* Add User Modal */}
        <AddUserModal />

        {/* Delete User Confirmation Modal */}
        <DeleteUserConfirmationModal />

        {/* User Success Modal */}
        <UserSuccessModal />

        {/* User Error Modal */}
        <UserErrorModal />

        {/* Debug Panel */}
        <DebugPanel />

        {/* Delete Success Modal */}
        {isDeleteSuccessModalOpen && (
          <div 
            className="delete-success-modal-overlay"
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              backgroundColor: 'rgba(0, 0, 0, 0.5)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 999999,
              padding: '20px',
              animation: 'fadeIn 0.3s ease-out'
            }}
            onClick={() => setIsDeleteSuccessModalOpen(false)}
          >
            <div 
              className="delete-success-modal-container"
              onClick={(e) => e.stopPropagation()}
              style={{
                backgroundColor: 'white',
                borderRadius: '12px',
                boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
                maxWidth: '450px',
                width: '100%',
                animation: 'slideUp 0.4s ease-out',
                overflow: 'hidden'
              }}
            >
              <div style={{
                background: 'linear-gradient(135deg, #4caf50 0%, #2e7d32 100%)',
                padding: '30px 25px',
                position: 'relative',
                overflow: 'hidden'
              }}>
                <div style={{
                  width: '80px',
                  height: '80px',
                  margin: '0 auto 20px',
                  backgroundColor: 'white',
                  borderRadius: '50%',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  position: 'relative'
                }}>
                  <div style={{
                    width: '35px',
                    height: '70px',
                    borderBottom: '8px solid #4caf50',
                    borderRight: '8px solid #4caf50',
                    transform: 'rotate(45deg)',
                    marginBottom: '15px',
                    marginLeft: '5px'
                  }}></div>
                </div>

                <h2 style={{
                  margin: 0,
                  color: 'white',
                  fontSize: '26px',
                  fontWeight: '700',
                  textAlign: 'center',
                  textShadow: '0 2px 4px rgba(0,0,0,0.1)',
                  position: 'relative',
                  zIndex: 1
                }}>
                  Aanvraag Verwijderd!
                </h2>
              </div>

              <div style={{ padding: '30px 25px' }}>
                <div style={{
                  backgroundColor: '#e8f5e9',
                  border: '2px solid #4caf50',
                  borderRadius: '8px',
                  padding: '16px',
                  marginBottom: '20px'
                }}>
                  <p style={{
                    margin: 0,
                    color: '#2e7d32',
                    fontSize: '15px',
                    fontWeight: '600',
                    lineHeight: '1.5',
                    textAlign: 'center'
                  }}>
                    De aanvraag is succesvol verwijderd uit de database.
                  </p>
                </div>

                <div style={{
                  padding: '12px',
                  backgroundColor: '#e3f2fd',
                  borderRadius: '6px',
                  border: '1px solid #90caf9',
                  textAlign: 'center'
                }}>
                  <p style={{
                    margin: 0,
                    color: '#1565c0',
                    fontSize: '13px',
                    lineHeight: '1.5'
                  }}>
                    De aanvraag is permanent verwijderd en kan niet meer worden hersteld.
                  </p>
                </div>
              </div>

              <div style={{
                padding: '20px 25px',
                backgroundColor: '#fafafa',
                borderTop: '1px solid #e0e0e0',
                display: 'flex',
                justifyContent: 'center'
              }}>
                <button
                  onClick={() => setIsDeleteSuccessModalOpen(false)}
                  style={{
                    padding: '12px 40px',
                    backgroundColor: '#4caf50',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '15px',
                    fontWeight: '700',
                    cursor: 'pointer',
                    transition: 'all 0.3s',
                    boxShadow: '0 4px 12px rgba(76, 175, 80, 0.3)',
                    textTransform: 'uppercase',
                    letterSpacing: '0.5px'
                  }}
                >
                  Begrepen
                </button>
              </div>
            </div>
          </div>
        )}
		{/* Delete Confirmation Modal */}
        {isDeleteModalOpen && aanvraagToDelete && (
          <div 
            className="delete-modal-overlay"
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              backgroundColor: 'rgba(0, 0, 0, 0.6)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 999999,
              padding: '20px',
              animation: 'fadeIn 0.3s ease-out'
            }}
            onClick={handleCloseDeleteModal}
          >
            <style>{`
              @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
              }
              @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
              }
            `}</style>
            
            <div 
              className="delete-modal-container"
              onClick={(e) => e.stopPropagation()}
              style={{
                backgroundColor: 'white',
                borderRadius: '12px',
                boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
                maxWidth: '500px',
                width: '100%',
                animation: 'slideUp 0.4s ease-out',
                overflow: 'hidden'
              }}
            >
              {/* Header */}
              <div style={{
                background: 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)',
                padding: '25px',
                position: 'relative',
                overflow: 'hidden'
              }}>
                <div style={{
                  position: 'absolute',
                  top: '-30px',
                  right: '-30px',
                  width: '100px',
                  height: '100px',
                  borderRadius: '50%',
                  backgroundColor: 'rgba(255, 255, 255, 0.1)',
                }}></div>
                
                {/* Warning Icon */}
                <div style={{
                  width: '70px',
                  height: '70px',
                  margin: '0 auto 15px',
                  backgroundColor: 'white',
                  borderRadius: '50%',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  position: 'relative',
                  animation: 'shake 0.5s ease-in-out'
                }}>
                  <div style={{
                    fontSize: '40px',
                    color: '#f44336',
                    fontWeight: 'bold'
                  }}>‚ö†</div>
                </div>

                <h2 style={{
                  margin: 0,
                  color: 'white',
                  fontSize: '24px',
                  fontWeight: '700',
                  textAlign: 'center',
                  textShadow: '0 2px 4px rgba(0,0,0,0.1)',
                  position: 'relative',
                  zIndex: 1
                }}>
                  Aanvraag Verwijderen?
                </h2>
              </div>

              {/* Content */}
              <div style={{ padding: '25px' }}>
                {(() => {
                  const formData = parseFormData(aanvraagToDelete['Form Data'] || '{}');
                  const aanvragerNaam = getNameFromEmail(aanvraagToDelete['Requester Email']);
                  
                  return (
                    <React.Fragment>
                      <p style={{
                        margin: '0 0 20px 0',
                        fontSize: '15px',
                        color: '#333',
                        lineHeight: '1.6',
                        textAlign: 'center'
                      }}>
                        Weet je zeker dat je deze aanvraag wilt verwijderen? Deze actie kan niet ongedaan gemaakt worden.
                      </p>

                      {/* Aanvraag info */}
                      <div style={{
                        backgroundColor: '#fff3cd',
                        border: '2px solid #ffc107',
                        borderRadius: '8px',
                        padding: '15px',
                        marginBottom: '20px'
                      }}>
                        <div style={{
                          fontSize: '11px',
                          color: '#856404',
                          fontWeight: '600',
                          marginBottom: '8px',
                          textTransform: 'uppercase',
                          letterSpacing: '0.5px'
                        }}>
                          Te verwijderen aanvraag
                        </div>
                        
                        <div style={{marginBottom: '8px'}}>
                          <span style={{fontSize: '12px', color: '#666', fontWeight: '600'}}>Aanvraag: </span>
                          <span style={{fontSize: '13px', color: '#333', fontWeight: '500'}}>{formData.naam || '-'}</span>
                        </div>
                        
                        <div style={{marginBottom: '8px'}}>
                          <span style={{fontSize: '12px', color: '#666', fontWeight: '600'}}>Installatie: </span>
                          <span style={{fontSize: '13px', color: '#333', fontWeight: '500'}}>{formData.installatie || '-'}</span>
                        </div>
                        
                        <div>
                          <span style={{fontSize: '12px', color: '#666', fontWeight: '600'}}>Aanvrager: </span>
                          <span style={{fontSize: '13px', color: '#333', fontWeight: '500'}}>{aanvragerNaam}</span>
                        </div>
                      </div>

                      {/* Warning message */}
                      <div style={{
                        backgroundColor: '#ffebee',
                        border: '1px solid #ef5350',
                        borderRadius: '6px',
                        padding: '12px',
                        marginBottom: '20px',
                        display: 'flex',
                        alignItems: 'flex-start',
                        gap: '10px'
                      }}>
                        <div style={{fontSize: '18px', flexShrink: 0}}>‚ö†Ô∏è</div>
                        <div>
                          <p style={{
                            margin: 0,
                            fontSize: '12px',
                            color: '#c62828',
                            fontWeight: '600',
                            lineHeight: '1.5'
                          }}>
                            Let op: Deze aanvraag wordt permanent verwijderd uit de database. Alle bijbehorende data gaat verloren.
                          </p>
                        </div>
                      </div>
                    </React.Fragment>
                  );
                })()}
              </div>

              {/* Footer */}
              <div style={{
                padding: '20px 25px',
                backgroundColor: '#fafafa',
                borderTop: '1px solid #e0e0e0',
                display: 'flex',
                justifyContent: 'flex-end',
                gap: '10px'
              }}>
                <button
                  onClick={handleCloseDeleteModal}
                  disabled={isDeleting}
                  style={{
                    padding: '10px 20px',
                    backgroundColor: '#f5f5f5',
                    color: '#333',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    fontSize: '14px',
                    fontWeight: '600',
                    cursor: isDeleting ? 'not-allowed' : 'pointer',
                    transition: 'all 0.3s',
                    opacity: isDeleting ? 0.5 : 1
                  }}
                >
                  Annuleren
                </button>
                <button
                  onClick={handleConfirmDelete}
                  disabled={isDeleting}
                  style={{
                    padding: '10px 20px',
                    backgroundColor: '#f44336',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '14px',
                    fontWeight: '700',
                    cursor: isDeleting ? 'not-allowed' : 'pointer',
                    transition: 'all 0.3s',
                    boxShadow: '0 4px 12px rgba(244, 67, 54, 0.3)',
                    opacity: isDeleting ? 0.7 : 1,
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}
                >
                  {isDeleting ? (
                    <React.Fragment>
                      <div style={{
                        width: '14px',
                        height: '14px',
                        border: '2px solid white',
                        borderTopColor: 'transparent',
                        borderRadius: '50%',
                        animation: 'spin 0.8s linear infinite'
                      }}></div>
                      Bezig met verwijderen...
                    </React.Fragment>
                  ) : (
                    <React.Fragment>
                      <span>‚úï</span>
                      Ja, Verwijderen
                    </React.Fragment>
                  )}
                </button>
              </div>
            </div>
          </div>
        )}
        
        {/* Detail Modal - Aanvraag bekijken */}
        {isDetailModalOpen && selectedAanvraag && (
          <div 
            className="detail-modal-overlay"
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              backgroundColor: 'rgba(0, 0, 0, 0.6)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 999999,
              padding: '20px',
              overflowY: 'auto'
            }}
            onClick={handleCloseDetailModal}
          >
            <div 
              className="detail-modal-container"
              onClick={(e) => e.stopPropagation()}
              style={{
                backgroundColor: 'white',
                borderRadius: '12px',
                boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
                maxWidth: '800px',
                width: '95%',
                maxHeight: '90vh',
                overflowY: 'auto',
                margin: 'auto'
              }}
            >
              {/* Header */}
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                padding: '20px 25px',
                borderBottom: '2px solid #e0e0e0',
                backgroundColor: '#f9f9f9',
                borderRadius: '12px 12px 0 0',
                position: 'sticky',
                top: 0,
                zIndex: 1,
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
              }}>
                <h2 style={{margin: 0, color: 'white', fontSize: '20px', fontWeight: '700'}}>
                  Aanvraag Details
                </h2>
                <button
                  onClick={handleCloseDetailModal}
                  title="Sluiten"
                  style={{
                    background: 'rgba(255, 255, 255, 0.2)',
                    border: '1px solid rgba(255, 255, 255, 0.3)',
                    fontSize: '24px',
                    color: 'white',
                    cursor: 'pointer',
                    padding: 0,
                    width: '32px',
                    height: '32px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    borderRadius: '50%',
                    transition: 'all 0.2s',
                    fontWeight: 'bold'
                  }}
                >
                  ‚úï
                </button>
              </div>

              {/* Content */}
              <div style={{padding: '25px'}}>
                {(() => {
                  const formData = parseFormData(selectedAanvraag['Form Data'] || '{}');
                  const aanvragerNaam = getNameFromEmail(selectedAanvraag['Requester Email']);
                  const datum = formatDate(selectedAanvraag['Timestamp']);
                  const beslissingDatum = selectedAanvraag['Decision Timestamp'] ? formatDate(selectedAanvraag['Decision Timestamp']) : null;
                  
                  // Verzamelmandje Data - ensure it's always an array
                  let verzamelmandjeData = selectedAanvraag['Verzamelmandje Data'] || [];
                  if (!Array.isArray(verzamelmandjeData)) {
                    // If it's an object, convert to array
                    if (typeof verzamelmandjeData === 'object') {
                      verzamelmandjeData = Object.values(verzamelmandjeData);
                    } else {
                      verzamelmandjeData = [];
                    }
                  }
                  
                  return (
                    <React.Fragment>
                      {/* Status Badge */}
                      <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '20px',
                        padding: '15px',
                        backgroundColor: selectedAanvraag['Status'] === 'Pending' ? '#fff3cd' : 
                                        selectedAanvraag['Status'] === 'Approved' ? '#d4edda' : '#f8d7da',
                        borderRadius: '8px',
                        border: '2px solid',
                        borderColor: selectedAanvraag['Status'] === 'Pending' ? '#ffc107' : 
                                    selectedAanvraag['Status'] === 'Approved' ? '#28a745' : '#dc3545'
                      }}>
                        <div>
                          <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '4px'}}>
                            STATUS
                          </div>
                          <div style={{
                            fontSize: '18px',
                            fontWeight: '700',
                            color: selectedAanvraag['Status'] === 'Pending' ? '#856404' :
                                   selectedAanvraag['Status'] === 'Approved' ? '#155724' : '#721c24'
                          }}>
                            {translateStatus(selectedAanvraag['Status'] || 'Pending')}
                          </div>
                        </div>
                        <div style={{textAlign: 'right'}}>
                          <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '4px'}}>
                            AANVRAAG DATUM
                          </div>
                          <div style={{fontSize: '14px', fontWeight: '600', color: '#333'}}>
                            {datum}
                          </div>
                          {beslissingDatum && selectedAanvraag['Status'] !== 'Pending' && (
                            <React.Fragment>
                              <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginTop: '12px', marginBottom: '4px'}}>
                                {selectedAanvraag['Status'] === 'Approved' ? 'GOEDKEUR DATUM' : 'AFKEUR DATUM'}
                              </div>
                              <div style={{
                                fontSize: '14px',
                                fontWeight: '600',
                                color: selectedAanvraag['Status'] === 'Approved' ? '#155724' : '#721c24'
                              }}>
                                {beslissingDatum}
                              </div>
                            </React.Fragment>
                          )}
                        </div>
                      </div>

                      {/* Approve/Reject Buttons - Only for Role B, C or D when status is Pending */}
                      {(userRole === 'B' || userRole === 'C' || userRole === 'D') && selectedAanvraag['Status'] === 'Pending' && (
                        <div style={{marginBottom: '25px'}}>
                          <div style={{
                            padding: '15px',
                            backgroundColor: '#f9f9f9',
                            borderRadius: '8px',
                            border: '1px solid #e0e0e0'
                          }}>
                            <div style={{marginBottom: '15px'}}>
                              <label style={{
                                display: 'block',
                                fontSize: '12px',
                                fontWeight: '600',
                                color: '#666',
                                marginBottom: '8px'
                              }}>
                                Opmerking Autorisator (optioneel):
                              </label>
                              <textarea
                                value={approverRemark}
                                onChange={(e) => setApproverRemark(e.target.value)}
                                placeholder="Voeg een opmerking toe..."
                                disabled={isProcessingDecision}
                                style={{
                                  width: '100%',
                                  minHeight: '80px',
                                  padding: '10px',
                                  fontSize: '13px',
                                  border: '1px solid #c5cae9',
                                  borderRadius: '6px',
                                  outline: 'none',
                                  resize: 'vertical',
                                  fontFamily: 'inherit',
                                  boxSizing: 'border-box'
                                }}
                              />
                            </div>

                            <div style={{
                              display: 'flex',
                              gap: '12px',
                              justifyContent: 'flex-end'
                            }}>
                              <button
                                onClick={() => handleApproveAanvraag('Rejected')}
                                disabled={isProcessingDecision}
                                style={{
                                  padding: '10px 20px',
                                  fontSize: '14px',
                                  fontWeight: '600',
                                  border: 'none',
                                  borderRadius: '6px',
                                  cursor: isProcessingDecision ? 'not-allowed' : 'pointer',
                                  transition: 'all 0.2s',
                                  backgroundColor: isProcessingDecision ? '#ccc' : '#f44336',
                                  color: 'white',
                                  opacity: isProcessingDecision ? 0.6 : 1
                                }}
                                onMouseEnter={(e) => {
                                  if (!isProcessingDecision) {
                                    e.target.style.backgroundColor = '#d32f2f';
                                    e.target.style.boxShadow = '0 4px 8px rgba(244, 67, 54, 0.3)';
                                  }
                                }}
                                onMouseLeave={(e) => {
                                  if (!isProcessingDecision) {
                                    e.target.style.backgroundColor = '#f44336';
                                    e.target.style.boxShadow = 'none';
                                  }
                                }}
                              >
                                {isProcessingDecision ? 'Bezig...' : 'Afkeuren'}
                              </button>

                              <button
                                onClick={() => handleApproveAanvraag('Approved')}
                                disabled={isProcessingDecision}
                                style={{
                                  padding: '10px 20px',
                                  fontSize: '14px',
                                  fontWeight: '600',
                                  border: 'none',
                                  borderRadius: '6px',
                                  cursor: isProcessingDecision ? 'not-allowed' : 'pointer',
                                  transition: 'all 0.2s',
                                  backgroundColor: isProcessingDecision ? '#ccc' : '#4CAF50',
                                  color: 'white',
                                  opacity: isProcessingDecision ? 0.6 : 1
                                }}
                                onMouseEnter={(e) => {
                                  if (!isProcessingDecision) {
                                    e.target.style.backgroundColor = '#388E3C';
                                    e.target.style.boxShadow = '0 4px 8px rgba(76, 175, 80, 0.3)';
                                  }
                                }}
                                onMouseLeave={(e) => {
                                  if (!isProcessingDecision) {
                                    e.target.style.backgroundColor = '#4CAF50';
                                    e.target.style.boxShadow = 'none';
                                  }
                                }}
                              >
                                {isProcessingDecision ? 'Bezig...' : 'Goedkeuren'}
                              </button>
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Aanvraag Info */}
                      <div style={{marginBottom: '25px'}}>
                        <h3 style={{
                          margin: '0 0 15px 0',
                          color: '#1a237e',
                          fontSize: '16px',
                          paddingBottom: '10px',
                          borderBottom: '2px solid #e0e0e0'
                        }}>
                          Aanvraag Informatie
                        </h3>
                        
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'}}>
                          <div style={{
                            padding: '12px',
                            backgroundColor: '#f9f9f9',
                            borderRadius: '6px',
                            border: '1px solid #e0e0e0'
                          }}>
                            <div style={{fontSize: '11px', color: '#666', fontWeight: '600', marginBottom: '4px'}}>
                              AANVRAAG TEKST
                            </div>
                            <div style={{fontSize: '14px', fontWeight: '500', color: '#333'}}>
                              {formData.naam || '-'}
                            </div>
                          </div>
                          
                          <div style={{
                            padding: '12px',
                            backgroundColor: '#f9f9f9',
                            borderRadius: '6px',
                            border: '1px solid #e0e0e0'
                          }}>
                            <div style={{fontSize: '11px', color: '#666', fontWeight: '600', marginBottom: '4px'}}>
                              INSTALLATIE
                            </div>
                            <div style={{fontSize: '14px', fontWeight: '500', color: '#333'}}>
                              {formData.installatie || '-'}
                            </div>
                          </div>
                          
                          <div style={{
                            padding: '12px',
                            backgroundColor: '#f9f9f9',
                            borderRadius: '6px',
                            border: '1px solid #e0e0e0'
                          }}>
                            <div style={{fontSize: '11px', color: '#666', fontWeight: '600', marginBottom: '4px'}}>
                              AANVRAGER
                            </div>
                            <div style={{fontSize: '14px', fontWeight: '500', color: '#333'}}>
                              {aanvragerNaam}
                            </div>
                            <div style={{fontSize: '11px', color: '#999', marginTop: '2px'}}>
                              {selectedAanvraag['Requester Email']}
                            </div>
                          </div>
                          
                          <div style={{
                            padding: '12px',
                            backgroundColor: '#f9f9f9',
                            borderRadius: '6px',
                            border: '1px solid #e0e0e0'
                          }}>
                            <div style={{fontSize: '11px', color: '#666', fontWeight: '600', marginBottom: '4px'}}>
                              AUTORISATOR
                            </div>
                            <div style={{fontSize: '14px', fontWeight: '500', color: '#333'}}>
                              {getNameFromEmail(selectedAanvraag['Approver Email'])}
                            </div>
                            <div style={{fontSize: '11px', color: '#999', marginTop: '2px'}}>
                              {selectedAanvraag['Approver Email']}
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Opmerkingen */}
                      {(formData.interneOpmerking || formData.externeOpmerking || formData.opmerkingen) && (
                        <div style={{marginBottom: '25px'}}>
                          <h3 style={{
                            margin: '0 0 15px 0',
                            color: '#1a237e',
                            fontSize: '16px',
                            paddingBottom: '10px',
                            borderBottom: '2px solid #e0e0e0'
                          }}>
                            Opmerkingen
                          </h3>
                          
                          {formData.interneOpmerking && (
                            <div style={{marginBottom: '12px'}}>
                              <div style={{
                                fontSize: '11px',
                                color: '#666',
                                fontWeight: '600',
                                marginBottom: '4px'
                              }}>
                                Interne opmerking
                              </div>
                              <div style={{
                                padding: '10px',
                                backgroundColor: '#f9f9f9',
                                borderRadius: '4px',
                                fontSize: '13px',
                                color: '#333',
                                border: '1px solid #e0e0e0',
                                whiteSpace: 'pre-wrap'
                              }}>
                                {formData.interneOpmerking}
                              </div>
                            </div>
                          )}
                          
                          {formData.externeOpmerking && (
                            <div style={{marginBottom: '12px'}}>
                              <div style={{
                                fontSize: '11px',
                                color: '#666',
                                fontWeight: '600',
                                marginBottom: '4px'
                              }}>
                                Externe opmerking
                              </div>
                              <div style={{
                                padding: '10px',
                                backgroundColor: '#f9f9f9',
                                borderRadius: '4px',
                                fontSize: '13px',
                                color: '#333',
                                border: '1px solid #e0e0e0',
                                whiteSpace: 'pre-wrap'
                              }}>
                                {formData.externeOpmerking}
                              </div>
                            </div>
                          )}
                          
                          {formData.opmerkingen && (
                            <div style={{marginBottom: '12px'}}>
                              <div style={{
                                fontSize: '11px',
                                color: '#666',
                                fontWeight: '600',
                                marginBottom: '4px'
                              }}>
                                Opmerkingen aanvrager
                              </div>
                              <div style={{
                                padding: '10px',
                                backgroundColor: '#f9f9f9',
                                borderRadius: '4px',
                                fontSize: '13px',
                                color: '#333',
                                border: '1px solid #e0e0e0',
                                whiteSpace: 'pre-wrap'
                              }}>
                                {formData.opmerkingen}
                              </div>
                            </div>
                          )}
                        </div>
                      )}

                      {/* Verzamelmandje Data */}
                      <div style={{marginBottom: '20px'}}>
                        <h3 style={{
                          margin: '0 0 15px 0',
                          color: '#1a237e',
                          fontSize: '16px',
                          paddingBottom: '10px',
                          borderBottom: '2px solid #e0e0e0'
                        }}>
                          Geselecteerde Vergrendelpunten ({verzamelmandjeData.length})
                        </h3>
                        
                        {verzamelmandjeData.length > 0 ? (
                          <div style={{
                            maxHeight: '300px',
                            overflowY: 'auto',
                            border: '1px solid #e0e0e0',
                            borderRadius: '6px'
                          }}>
                            <table style={{
                              width: '100%',
                              borderCollapse: 'collapse',
                              fontSize: '12px'
                            }}>
                              <thead>
                                <tr style={{backgroundColor: '#f5f5f5'}}>
                                  <th style={{
                                    padding: '10px',
                                    textAlign: 'left',
                                    borderBottom: '2px solid #e0e0e0',
                                    position: 'sticky',
                                    top: 0,
                                    backgroundColor: '#f5f5f5',
                                    zIndex: 1
                                  }}>Data</th>
                                </tr>
                              </thead>
                              <tbody>
                                {verzamelmandjeData.map((item, index) => (
                                  <tr key={index} style={{
                                    backgroundColor: index % 2 === 0 ? 'white' : '#fafafa'
                                  }}>
                                    <td style={{
                                      padding: '10px',
                                      borderBottom: '1px solid #e0e0e0',
                                      fontFamily: 'monospace',
                                      fontSize: '11px'
                                    }}>
                                      {item}
                                    </td>
                                  </tr>
                                ))}
                              </tbody>
                            </table>
                          </div>
                        ) : (
                          <div style={{
                            padding: '20px',
                            textAlign: 'center',
                            color: '#999',
                            backgroundColor: '#f9f9f9',
                            borderRadius: '6px',
                            border: '1px dashed #ddd'
                          }}>
                            Geen vergrendelpunten geselecteerd
                          </div>
                        )}
                      </div>
                    </React.Fragment>
                  );
                })()}
              </div>

              {/* Footer */}
              <div style={{
                padding: '15px 25px',
                backgroundColor: '#f9f9f9',
                borderTop: '1px solid #e0e0e0',
                borderRadius: '0 0 12px 12px',
                display: 'flex',
                justifyContent: 'flex-end'
              }}>
                <button
                  onClick={handleCloseDetailModal}
                  style={{
                    padding: '10px 30px',
                    backgroundColor: '#667eea',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    fontSize: '14px',
                    fontWeight: '600',
                    cursor: 'pointer',
                    transition: 'all 0.3s'
                  }}
                >
                  Sluiten
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Draggable Test Modal */}
        <DraggableTestModal />

        {/* Criticaliteit Detail Modal */}
        {isCriticalityDetailModalOpen && selectedCriticalityItem && (
          <div
            className="detail-modal-overlay"
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              backgroundColor: 'rgba(0, 0, 0, 0.6)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 999999,
              padding: '20px',
              overflowY: 'auto'
            }}
            onClick={handleCloseCriticalityDetail}
          >
            <div
              className="detail-modal-container"
              onClick={(e) => e.stopPropagation()}
              style={{
                backgroundColor: 'white',
                borderRadius: '12px',
                boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
                maxWidth: '700px',
                width: '95%',
                maxHeight: '90vh',
                overflowY: 'auto',
                margin: 'auto'
              }}
            >
              {/* Header */}
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                padding: '20px 25px',
                borderBottom: '2px solid #e0e0e0',
                backgroundColor: '#f9f9f9',
                borderRadius: '12px 12px 0 0',
                position: 'sticky',
                top: 0,
                zIndex: 1,
                background: 'linear-gradient(135deg, #ff9800 0%, #f57c00 100%)'
              }}>
                <h2 style={{margin: 0, color: 'white', fontSize: '20px', fontWeight: '700'}}>
                  Criticaliteit Details
                </h2>
                <button
                  onClick={handleCloseCriticalityDetail}
                  title="Sluiten"
                  style={{
                    background: 'rgba(255, 255, 255, 0.2)',
                    border: '1px solid rgba(255, 255, 255, 0.3)',
                    fontSize: '24px',
                    color: 'white',
                    cursor: 'pointer',
                    padding: 0,
                    width: '32px',
                    height: '32px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    borderRadius: '50%',
                    transition: 'all 0.2s',
                    fontWeight: 'bold'
                  }}
                >
                  ‚úï
                </button>
              </div>

              {/* Content */}
              <div style={{padding: '25px'}}>
                {/* Main Info Grid */}
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: '1fr 1fr',
                  gap: '20px',
                  marginBottom: '25px'
                }}>
                  {/* ID & Naam */}
                  <div style={{
                    padding: '15px',
                    backgroundColor: '#f5f5f5',
                    borderRadius: '8px',
                    gridColumn: '1 / -1'
                  }}>
                    <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '8px'}}>
                      ID & NAAM
                    </div>
                    <div style={{fontSize: '18px', fontWeight: '700', color: '#333', marginBottom: '5px'}}>
                      ID: {selectedCriticalityItem.ID || '-'}
                    </div>
                    <div style={{fontSize: '16px', fontWeight: '600', color: '#555'}}>
                      {selectedCriticalityItem.Naam || '-'}
                    </div>
                  </div>

                  {/* Remax Nummer */}
                  <div style={{
                    padding: '15px',
                    backgroundColor: '#f5f5f5',
                    borderRadius: '8px'
                  }}>
                    <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '8px'}}>
                      REMAX NUMMER
                    </div>
                    <div style={{fontSize: '16px', fontWeight: '600', color: '#333'}}>
                      {selectedCriticalityItem.RemaxNummer || '-'}
                    </div>
                  </div>

                  {/* Categorie */}
                  <div style={{
                    padding: '15px',
                    backgroundColor: '#f5f5f5',
                    borderRadius: '8px'
                  }}>
                    <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '8px'}}>
                      CATEGORIE
                    </div>
                    <span style={{
                      backgroundColor: selectedCriticalityItem.Categorie === 'QS0' ? '#bbdefb' : selectedCriticalityItem.Categorie === 'QS2' ? '#1976d2' : selectedCriticalityItem.Categorie === 'QS3' ? '#ff9800' : '#e0e0e0',
                      color: selectedCriticalityItem.Categorie === 'QS0' ? '#0d47a1' : selectedCriticalityItem.Categorie === 'QS2' ? '#ffffff' : selectedCriticalityItem.Categorie === 'QS3' ? '#ffffff' : '#666',
                      padding: '6px 12px',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '700',
                      display: 'inline-block'
                    }}>
                      {selectedCriticalityItem.Categorie || '-'}
                    </span>
                  </div>

                  {/* Machine Criticality */}
                  <div style={{
                    padding: '15px',
                    backgroundColor: '#f5f5f5',
                    borderRadius: '8px'
                  }}>
                    <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '8px'}}>
                      MACHINE CRITICALITEIT
                    </div>
                    <span style={{
                      backgroundColor: selectedCriticalityItem.MachineCrit === 'AA' ? '#c8e6c9' : selectedCriticalityItem.MachineCrit === 'A' ? '#fff3cd' : '#f8d7da',
                      color: selectedCriticalityItem.MachineCrit === 'AA' ? '#2e7d32' : selectedCriticalityItem.MachineCrit === 'A' ? '#856404' : '#721c24',
                      padding: '6px 12px',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '700',
                      display: 'inline-block'
                    }}>
                      {selectedCriticalityItem.MachineCrit || '-'}
                    </span>
                  </div>

                  {/* Risico */}
                  <div style={{
                    padding: '15px',
                    backgroundColor: '#f5f5f5',
                    borderRadius: '8px'
                  }}>
                    <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '8px'}}>
                      RISICO
                    </div>
                    <span style={{
                      backgroundColor: selectedCriticalityItem.Risico === 'A' ? '#c8e6c9' : selectedCriticalityItem.Risico === 'B' ? '#fff3cd' : '#f8d7da',
                      color: selectedCriticalityItem.Risico === 'A' ? '#2e7d32' : selectedCriticalityItem.Risico === 'B' ? '#856404' : '#721c24',
                      padding: '6px 12px',
                      borderRadius: '6px',
                      fontSize: '14px',
                      fontWeight: '700',
                      display: 'inline-block'
                    }}>
                      {selectedCriticalityItem.Risico || '-'}
                    </span>
                  </div>
                </div>

                {/* Additional Details */}
                <div style={{
                  border: '1px solid #e0e0e0',
                  borderRadius: '8px',
                  overflow: 'hidden',
                  marginBottom: '20px'
                }}>
                  <div style={{
                    padding: '12px 15px',
                    backgroundColor: '#f9f9f9',
                    borderBottom: '1px solid #e0e0e0',
                    fontWeight: '700',
                    fontSize: '14px',
                    color: '#333'
                  }}>
                    AANVULLENDE INFORMATIE
                  </div>
                  <div style={{padding: '15px'}}>
                    <div style={{
                      display: 'grid',
                      gridTemplateColumns: '1fr 1fr',
                      gap: '15px'
                    }}>
                      <div>
                        <div style={{fontSize: '12px', color: '#666', marginBottom: '4px'}}>Falen Frequentie</div>
                        <div style={{fontSize: '14px', fontWeight: '600'}}>{selectedCriticalityItem.FalenFreq || '-'}</div>
                      </div>
                      <div>
                        <div style={{fontSize: '12px', color: '#666', marginBottom: '4px'}}>Falen Severity</div>
                        <div style={{fontSize: '14px', fontWeight: '600'}}>{selectedCriticalityItem.FalenSeverity || '-'}</div>
                      </div>
                      <div>
                        <div style={{fontSize: '12px', color: '#666', marginBottom: '4px'}}>Functie Criticiteit</div>
                        <div style={{fontSize: '14px', fontWeight: '600'}}>{selectedCriticalityItem.FunctieCrit || '-'}</div>
                      </div>
                      <div>
                        <div style={{fontSize: '12px', color: '#666', marginBottom: '4px'}}>Levertijd</div>
                        <div style={{fontSize: '14px', fontWeight: '600'}}>{selectedCriticalityItem.Levertijd || '-'}</div>
                      </div>
                      <div>
                        <div style={{fontSize: '12px', color: '#666', marginBottom: '4px'}}>Kosten</div>
                        <div style={{fontSize: '14px', fontWeight: '600'}}>{selectedCriticalityItem.Kosten || '-'}</div>
                      </div>
                      <div>
                        <div style={{fontSize: '12px', color: '#666', marginBottom: '4px'}}>Aankoop Factor</div>
                        <div style={{fontSize: '14px', fontWeight: '600'}}>{selectedCriticalityItem.AankoopFactor || '-'}</div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Status & Metadata */}
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: '1fr 1fr 1fr',
                  gap: '15px'
                }}>
                  <div style={{
                    padding: '15px',
                    backgroundColor: '#f5f5f5',
                    borderRadius: '8px'
                  }}>
                    <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '8px'}}>
                      STATUS
                    </div>
                    <span style={{
                      backgroundColor: selectedCriticalityItem.Status === 'Voltooid' ? '#c8e6c9' : selectedCriticalityItem.Status === 'In behandeling' ? '#fff3cd' : '#e0e0e0',
                      color: selectedCriticalityItem.Status === 'Voltooid' ? '#2e7d32' : selectedCriticalityItem.Status === 'In behandeling' ? '#856404' : '#666',
                      padding: '6px 12px',
                      borderRadius: '6px',
                      fontSize: '12px',
                      fontWeight: '700',
                      display: 'inline-block'
                    }}>
                      {selectedCriticalityItem.Status || '-'}
                    </span>
                  </div>
                  <div style={{
                    padding: '15px',
                    backgroundColor: '#f5f5f5',
                    borderRadius: '8px'
                  }}>
                    <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '8px'}}>
                      DATUM
                    </div>
                    <div style={{fontSize: '14px', fontWeight: '600', color: '#333'}}>
                      {formatCriticalityDate(selectedCriticalityItem.Datum)}
                    </div>
                  </div>
                  <div style={{
                    padding: '15px',
                    backgroundColor: '#f5f5f5',
                    borderRadius: '8px'
                  }}>
                    <div style={{fontSize: '12px', color: '#666', fontWeight: '600', marginBottom: '8px'}}>
                      GEBRUIKER
                    </div>
                    <div style={{fontSize: '13px', fontWeight: '600', color: '#555', wordBreak: 'break-word'}}>
                      {selectedCriticalityItem.User || '-'}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}
      </React.Fragment>
    );
  }

  ReactDOM.render(<App />, document.getElementById('root'));
</script>
